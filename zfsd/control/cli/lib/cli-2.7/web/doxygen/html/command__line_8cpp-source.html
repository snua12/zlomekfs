<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>CLI: command_line.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-20981143-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_7ca5e860cc97c111944d6d090aaeaed5.html">cpp</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_909ff1c5a0fe7ebd415c9e08d3a715b8.html">src</a></div>
<h1>command_line.cpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">    Copyright (c) 2006-2011, Alexis Royer, http://alexis.royer.free.fr/CLI</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">    All rights reserved.</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">    Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">        * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00009"></a>00009 <span class="comment">        * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00010"></a>00010 <span class="comment">        * Neither the name of the CLI library project nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00013"></a>00013 <span class="comment">    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00014"></a>00014 <span class="comment">    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00015"></a>00015 <span class="comment">    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR</span>
<a name="l00016"></a>00016 <span class="comment">    CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span>
<a name="l00017"></a>00017 <span class="comment">    EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
<a name="l00018"></a>00018 <span class="comment">    PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
<a name="l00019"></a>00019 <span class="comment">    PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
<a name="l00020"></a>00020 <span class="comment">    LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
<a name="l00021"></a>00021 <span class="comment">    NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<a name="l00022"></a>00022 <span class="comment">    SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00023"></a>00023 <span class="comment">*/</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="pch_8h.html">cli/pch.h</a>"</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#include "<a class="code" href="command__line_8h.html">cli/command_line.h</a>"</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include "<a class="code" href="io__device_8h.html">cli/io_device.h</a>"</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include "<a class="code" href="menu_8h.html">cli/menu.h</a>"</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include "<a class="code" href="syntax__node_8h.html">cli/syntax_node.h</a>"</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include "<a class="code" href="endl_8h.html">cli/endl.h</a>"</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include "<a class="code" href="param_8h.html">cli/param.h</a>"</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include "<a class="code" href="traces_8h.html">cli/traces.h</a>"</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include "<a class="code" href="assert_8h.html">cli/assert.h</a>"</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include "<a class="code" href="consistency_8h.html">consistency.h</a>"</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include "<a class="code" href="constraints_8h.html">constraints.h</a>"</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <a class="code" href="namespace_8h.html#965caf70ca576c007bee150001248651">CLI_NS_USE</a>(cli)
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#define TRACE_CMD_LINE GetCmdLineTraceClass()</span>
<a name="l00047"></a>00047 <span class="preprocessor">static const TraceClass&amp; GetCmdLineTraceClass(void)</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>{
<a name="l00049"></a>00049     <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classTraceClass.html">TraceClass</a> cli_CmdLineTraceClass(<span class="stringliteral">"CLI_CMD_LINE"</span>, <a class="code" href="classHelp.html">Help</a>()
<a name="l00050"></a>00050         .AddHelp(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df">Help::LANG_EN</a>, <span class="stringliteral">"Command line parsing"</span>)
<a name="l00051"></a>00051         .AddHelp(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f">Help::LANG_FR</a>, <span class="stringliteral">"Analyse de lignes de commande"</span>));
<a name="l00052"></a>00052     <span class="keywordflow">return</span> cli_CmdLineTraceClass;
<a name="l00053"></a>00053 }
<a name="l00055"></a>00055 <span class="preprocessor">#define TRACE_CMD_LINE_SPLIT GetCmdLineSplitTraceClass()</span>
<a name="l00057"></a>00057 <span class="preprocessor">static const TraceClass&amp; GetCmdLineSplitTraceClass(void)</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span>{
<a name="l00059"></a>00059     <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classTraceClass.html">TraceClass</a> cli_CmdLineSplitTraceClass(<span class="stringliteral">"CLI_CMD_LINE_SPLIT"</span>, <a class="code" href="classHelp.html">Help</a>()
<a name="l00060"></a>00060         .AddHelp(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df">Help::LANG_EN</a>, <span class="stringliteral">"Split of command lines"</span>)
<a name="l00061"></a>00061         .AddHelp(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f">Help::LANG_FR</a>, <span class="stringliteral">"Césure de mots sur analyse de lignes de commande"</span>));
<a name="l00062"></a>00062     <span class="keywordflow">return</span> cli_CmdLineSplitTraceClass;
<a name="l00063"></a>00063 }
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <a class="code" href="classCommandLine.html#04ec8f6cd620e7acb5ca469cf6df15a3">CommandLine::CommandLine</a>(<span class="keywordtype">void</span>)
<a name="l00067"></a>00067   : m_cliElements(MAX_CMD_LINE_WORD_COUNT), m_cliAutoDelete(MAX_CMD_LINE_WORD_COUNT),
<a name="l00068"></a>00068     m_pcliMenu(NULL),
<a name="l00069"></a>00069     m_strLastWord(MAX_WORD_LENGTH), m_bLastWordValid(false),
<a name="l00070"></a>00070     m_iNumBackspacesForCompletion(0)
<a name="l00071"></a>00071 {
<a name="l00072"></a>00072     <a class="code" href="consistency_8h.html#ed1a89fb454edbbeb912461221e72014">EnsureTraces</a>();
<a name="l00073"></a>00073 }
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <a class="code" href="classCommandLine.html#5ddd25be6322575f4417ff02a8e6972c">CommandLine::~CommandLine</a>(<span class="keywordtype">void</span>)
<a name="l00076"></a>00076 {
<a name="l00077"></a>00077     <span class="comment">// Auto-deletion list.</span>
<a name="l00078"></a>00078     <span class="keywordflow">while</span> (! m_cliAutoDelete.IsEmpty())
<a name="l00079"></a>00079     {
<a name="l00080"></a>00080         <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classElement.html">Element</a>* <span class="keyword">const</span> pcli_Element = m_cliAutoDelete.RemoveHead())
<a name="l00081"></a>00081         {
<a name="l00082"></a>00082             <span class="keyword">delete</span> pcli_Element;
<a name="l00083"></a>00083         }
<a name="l00084"></a>00084     }
<a name="l00085"></a>00085 }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classCommandLine.html#c58a33a052647d5cf76b017f18c0738a">CommandLine::Parse</a>(
<a name="l00088"></a>00088         <span class="keyword">const</span> <a class="code" href="classMenu.html">Menu</a>&amp; CLI_Menu,
<a name="l00089"></a>00089         <span class="keyword">const</span> tk::String&amp; STR_Line,
<a name="l00090"></a>00090         <span class="keyword">const</span> <span class="keywordtype">bool</span> B_Execution
<a name="l00091"></a>00091         )
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093     m_pcliMenu = &amp; CLI_Menu;
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     <span class="comment">// Reset the error message.</span>
<a name="l00096"></a>00096     m_cliError = <a class="code" href="classResourceString.html">ResourceString</a>();
<a name="l00097"></a>00097 
<a name="l00098"></a>00098     <span class="comment">// Split the line into words.</span>
<a name="l00099"></a>00099     <span class="keyword">const</span> <a class="code" href="classElement.html">Element</a>* pcli_Node = &amp; CLI_Menu;
<a name="l00100"></a>00100     tk::Queue&lt;tk::String&gt; vstr_Words(MAX_CMD_LINE_WORD_COUNT);
<a name="l00101"></a>00101     <span class="keywordtype">int</span> i_LastWordPosition = -1;
<a name="l00102"></a>00102     <span class="keywordflow">if</span> (! Split(STR_Line, vstr_Words, i_LastWordPosition))
<a name="l00103"></a>00103     {
<a name="l00104"></a>00104         <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE) &lt;&lt; <span class="stringliteral">"Could not split '"</span> &lt;&lt; STR_Line &lt;&lt; <span class="stringliteral">"' ("</span> &lt;&lt; m_cliError.<a class="code" href="classResourceString.html#9810e21c1e7ec3ab7f45c099f15fd7f7">GetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df">ResourceString::LANG_EN</a>) &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; <a class="code" href="io__device_8h.html#d6d7d55b8cc249130097ce4007a1162a">endl</a>;
<a name="l00105"></a>00105         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00106"></a>00106     }
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     <span class="comment">// Determine whether the last word should be parsed.</span>
<a name="l00109"></a>00109     <span class="keywordtype">int</span> i_WordCount = vstr_Words.GetCount();
<a name="l00110"></a>00110     <span class="keywordflow">if</span> ((! B_Execution)
<a name="l00111"></a>00111         &amp;&amp; (! vstr_Words.IsEmpty())
<a name="l00112"></a>00112         &amp;&amp; (i_LastWordPosition &gt;= 0))
<a name="l00113"></a>00113     {
<a name="l00114"></a>00114         i_WordCount --;
<a name="l00115"></a>00115         <span class="keywordflow">if</span> (! m_strLastWord.Set(vstr_Words.GetTail()))
<a name="l00116"></a>00116         {
<a name="l00117"></a>00117             <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(<a class="code" href="traces_8h.html#243b1b1f8ca7e7e98ac73a2d115256f4">INTERNAL_ERROR</a>)
<a name="l00118"></a>00118                 &lt;&lt; <span class="stringliteral">"CommandLine::Parse(): "</span>
<a name="l00119"></a>00119                 &lt;&lt; <span class="stringliteral">"Not enough space in m_strLastWord for the word '"</span> &lt;&lt; vstr_Words.GetTail() &lt;&lt; <span class="stringliteral">"'"</span>
<a name="l00120"></a>00120                 &lt;&lt; <a class="code" href="io__device_8h.html#d6d7d55b8cc249130097ce4007a1162a">endl</a>;
<a name="l00121"></a>00121         }
<a name="l00122"></a>00122         m_bLastWordValid = <span class="keyword">true</span>;
<a name="l00123"></a>00123         m_iNumBackspacesForCompletion = (STR_Line.GetLength() - i_LastWordPosition);
<a name="l00124"></a>00124     }
<a name="l00125"></a>00125     <span class="keywordflow">else</span>
<a name="l00126"></a>00126     {
<a name="l00127"></a>00127         m_strLastWord.Set(<span class="stringliteral">""</span>);
<a name="l00128"></a>00128         m_bLastWordValid = <span class="keyword">false</span>;
<a name="l00129"></a>00129         m_iNumBackspacesForCompletion = 0;
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131 
<a name="l00132"></a>00132     <span class="comment">// For each word, match the right element.</span>
<a name="l00133"></a>00133     tk::Queue&lt;tk::String&gt;::Iterator it = vstr_Words.GetIterator();
<a name="l00134"></a>00134     <span class="keywordflow">for</span> (   <span class="keywordtype">int</span> i=0;
<a name="l00135"></a>00135             vstr_Words.IsValid(it) &amp;&amp; (i &lt; i_WordCount);
<a name="l00136"></a>00136             i ++)
<a name="l00137"></a>00137     {
<a name="l00138"></a>00138         <span class="comment">// Search for elements that match the current word.</span>
<a name="l00139"></a>00139         <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE) &lt;&lt; <span class="stringliteral">"Word "</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">" '"</span> &lt;&lt; vstr_Words.GetAt(it) &lt;&lt; <span class="stringliteral">"'"</span> &lt;&lt; <a class="code" href="io__device_8h.html#d6d7d55b8cc249130097ce4007a1162a">endl</a>;
<a name="l00140"></a>00140         <a class="code" href="classElement.html#ab78652ce32d1c7cbdd83980653322b0">Element::List</a> cli_ExactList(MAX_CMD_LINE_WORD_COUNT), cli_NearList(MAX_CMD_LINE_WORD_COUNT);
<a name="l00141"></a>00141         <span class="keywordflow">if</span> (! pcli_Node-&gt;<a class="code" href="classElement.html#8c27c074ba2b640795ca3657eccf3dae">FindElements</a>(cli_ExactList, cli_NearList, vstr_Words.GetAt(it)))
<a name="l00142"></a>00142         {
<a name="l00143"></a>00143             m_cliError
<a name="l00144"></a>00144                 .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df">ResourceString::LANG_EN</a>, <span class="stringliteral">"Internal error"</span>)
<a name="l00145"></a>00145                 .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f">ResourceString::LANG_FR</a>, <span class="stringliteral">"Erreur interne"</span>);
<a name="l00146"></a>00146             <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE) &lt;&lt; m_cliError.<a class="code" href="classResourceString.html#9810e21c1e7ec3ab7f45c099f15fd7f7">GetString</a>(ResourceString::LANG_EN) &lt;&lt; <a class="code" href="io__device_8h.html#d6d7d55b8cc249130097ce4007a1162a">endl</a>;
<a name="l00147"></a>00147             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00148"></a>00148         }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150         <span class="keywordflow">if</span> (cli_NearList.GetCount() == 0)
<a name="l00151"></a>00151         {
<a name="l00152"></a>00152             <span class="keywordflow">if</span> (vstr_Words.GetAt(it) == <span class="stringliteral">"\n"</span>)
<a name="l00153"></a>00153             {
<a name="l00154"></a>00154                 <span class="keywordflow">if</span> (i == 0)
<a name="l00155"></a>00155                 {
<a name="l00156"></a>00156                     <span class="comment">// End of line</span>
<a name="l00157"></a>00157                     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00158"></a>00158                 }
<a name="l00159"></a>00159                 <span class="keywordflow">else</span>
<a name="l00160"></a>00160                 {
<a name="l00161"></a>00161                     <span class="comment">// Incomplete command</span>
<a name="l00162"></a>00162                     m_cliError
<a name="l00163"></a>00163                         .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(ResourceString::LANG_EN, <span class="stringliteral">"Incomplete command"</span>)
<a name="l00164"></a>00164                         .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f">ResourceString::LANG_FR</a>, <span class="stringliteral">"Command incomplète"</span>);
<a name="l00165"></a>00165                     <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE) &lt;&lt; m_cliError.<a class="code" href="classResourceString.html#9810e21c1e7ec3ab7f45c099f15fd7f7">GetString</a>(ResourceString::LANG_EN) &lt;&lt; <a class="code" href="io__device_8h.html#d6d7d55b8cc249130097ce4007a1162a">endl</a>;
<a name="l00166"></a>00166                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00167"></a>00167                 }
<a name="l00168"></a>00168             }
<a name="l00169"></a>00169             <span class="keywordflow">else</span>
<a name="l00170"></a>00170             {
<a name="l00171"></a>00171                 <span class="comment">// No matching element.</span>
<a name="l00172"></a>00172                 <span class="comment">// Syntax error.</span>
<a name="l00173"></a>00173                 m_cliError
<a name="l00174"></a>00174                     .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(ResourceString::LANG_EN, <a class="code" href="classResourceString.html#ddf08a16467dbccd52cfa8e73d0aa95d">ResourceString::Concat</a>(<span class="stringliteral">"Syntax error next to '"</span>, vstr_Words.GetAt(it), <span class="stringliteral">"'"</span>))
<a name="l00175"></a>00175                     .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f">ResourceString::LANG_FR</a>, <a class="code" href="classResourceString.html#ddf08a16467dbccd52cfa8e73d0aa95d">ResourceString::Concat</a>(<span class="stringliteral">"Erreur de syntaxe près de '"</span>, vstr_Words.GetAt(it), <span class="stringliteral">"'"</span>));
<a name="l00176"></a>00176                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE) &lt;&lt; m_cliError.<a class="code" href="classResourceString.html#9810e21c1e7ec3ab7f45c099f15fd7f7">GetString</a>(ResourceString::LANG_EN) &lt;&lt; <a class="code" href="io__device_8h.html#d6d7d55b8cc249130097ce4007a1162a">endl</a>;
<a name="l00177"></a>00177                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00178"></a>00178             }
<a name="l00179"></a>00179         }
<a name="l00180"></a>00180         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((cli_ExactList.GetCount() &gt; 1)
<a name="l00181"></a>00181                 || ((cli_ExactList.GetCount() == 0) &amp;&amp; (cli_NearList.GetCount() &gt; 1)))
<a name="l00182"></a>00182         {
<a name="l00183"></a>00183             <span class="comment">// Ambiguous syntax</span>
<a name="l00184"></a>00184             m_cliError
<a name="l00185"></a>00185                 .SetString(ResourceString::LANG_EN, <a class="code" href="classResourceString.html#ddf08a16467dbccd52cfa8e73d0aa95d">ResourceString::Concat</a>(<span class="stringliteral">"Ambiguous syntax next to '"</span>, vstr_Words.GetAt(it), <span class="stringliteral">"'"</span>))
<a name="l00186"></a>00186                 .SetString(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f">ResourceString::LANG_FR</a>, <a class="code" href="classResourceString.html#ddf08a16467dbccd52cfa8e73d0aa95d">ResourceString::Concat</a>(<span class="stringliteral">"Ambiguïté de syntaxe près de '"</span>, vstr_Words.GetAt(it), <span class="stringliteral">"'"</span>));
<a name="l00187"></a>00187             <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE) &lt;&lt; m_cliError.<a class="code" href="classResourceString.html#9810e21c1e7ec3ab7f45c099f15fd7f7">GetString</a>(ResourceString::LANG_EN) &lt;&lt; <a class="code" href="io__device_8h.html#d6d7d55b8cc249130097ce4007a1162a">endl</a>;
<a name="l00188"></a>00188             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00189"></a>00189         }
<a name="l00190"></a>00190         <span class="keywordflow">else</span>
<a name="l00191"></a>00191         {
<a name="l00192"></a>00192             <span class="comment">// Element found.</span>
<a name="l00193"></a>00193             <span class="keywordflow">if</span> (! cli_ExactList.IsEmpty())
<a name="l00194"></a>00194             {
<a name="l00195"></a>00195                 <span class="comment">// Prefer exactly matching elements if any.</span>
<a name="l00196"></a>00196                 pcli_Node = cli_ExactList.GetHead();
<a name="l00197"></a>00197             }
<a name="l00198"></a>00198             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! cli_NearList.IsEmpty())
<a name="l00199"></a>00199             {
<a name="l00200"></a>00200                 <span class="comment">// First of the near elements otherwise.</span>
<a name="l00201"></a>00201                 pcli_Node = cli_NearList.GetHead();
<a name="l00202"></a>00202             }
<a name="l00203"></a>00203             <span class="keywordflow">else</span>
<a name="l00204"></a>00204             {
<a name="l00205"></a>00205                 <a class="code" href="assert_8h.html#1fe8f84b5d89ceccc07361b1d0da0144">CLI_ASSERT</a>(<span class="keyword">false</span>);
<a name="l00206"></a>00206             }
<a name="l00207"></a>00207             <span class="comment">// Add it to the command line.</span>
<a name="l00208"></a>00208             AddElement(pcli_Node);
<a name="l00209"></a>00209         }
<a name="l00210"></a>00210 
<a name="l00211"></a>00211         vstr_Words.MoveNext(it);
<a name="l00212"></a>00212     }
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     <span class="comment">// Check for final endl element.</span>
<a name="l00215"></a>00215     <span class="keywordflow">if</span> (B_Execution &amp;&amp; (i_WordCount &gt; 0)
<a name="l00216"></a>00216         &amp;&amp; (! dynamic_cast&lt;const Endl*&gt;(&amp; <a class="code" href="classCommandLine.html#6ca91ca4b454a281bbba1b221081347a">GetLastElement</a>())))
<a name="l00217"></a>00217     {
<a name="l00218"></a>00218         m_cliError
<a name="l00219"></a>00219             .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(ResourceString::LANG_EN, <span class="stringliteral">"Incomplete command"</span>)
<a name="l00220"></a>00220             .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f">ResourceString::LANG_FR</a>, <span class="stringliteral">"Commande incomplète"</span>);
<a name="l00221"></a>00221         <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE) &lt;&lt; m_cliError.<a class="code" href="classResourceString.html#9810e21c1e7ec3ab7f45c099f15fd7f7">GetString</a>(ResourceString::LANG_EN) &lt;&lt; <a class="code" href="io__device_8h.html#d6d7d55b8cc249130097ce4007a1162a">endl</a>;
<a name="l00222"></a>00222         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00223"></a>00223     }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225     <span class="keywordflow">if</span> (<a class="code" href="classCommandLine.html#9d6cf46a0e4c40a775e27f131de2eb51">GetLastWord</a>() != NULL)
<a name="l00226"></a>00226     {
<a name="l00227"></a>00227         <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE) &lt;&lt; <span class="stringliteral">"Last word '"</span> &lt;&lt; <a class="code" href="classCommandLine.html#9d6cf46a0e4c40a775e27f131de2eb51">GetLastWord</a>() &lt;&lt; <span class="stringliteral">"'..."</span> &lt;&lt; <a class="code" href="io__device_8h.html#d6d7d55b8cc249130097ce4007a1162a">endl</a>;
<a name="l00228"></a>00228     }
<a name="l00229"></a>00229     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 <span class="keyword">const</span> <a class="code" href="classElement.html">Element</a>&amp; <a class="code" href="classCommandLine.html#6ca91ca4b454a281bbba1b221081347a">CommandLine::GetLastElement</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00233"></a>00233 <span class="keyword"></span>{
<a name="l00234"></a>00234     <span class="keywordflow">if</span> (m_cliElements.IsEmpty())
<a name="l00235"></a>00235     {
<a name="l00236"></a>00236         <span class="keywordflow">return</span> *m_pcliMenu;
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238     <span class="keywordflow">else</span>
<a name="l00239"></a>00239     {
<a name="l00240"></a>00240         <span class="keywordflow">return</span> *m_cliElements.GetTail();
<a name="l00241"></a>00241     }
<a name="l00242"></a>00242 }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> <a class="code" href="classCommandLine.html#9d6cf46a0e4c40a775e27f131de2eb51">CommandLine::GetLastWord</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00245"></a>00245 <span class="keyword"></span>{
<a name="l00246"></a>00246     <span class="keywordflow">if</span> (m_bLastWordValid)
<a name="l00247"></a>00247     {
<a name="l00248"></a>00248         <span class="keywordflow">return</span> m_strLastWord;
<a name="l00249"></a>00249     }
<a name="l00250"></a>00250     <span class="keywordflow">else</span>
<a name="l00251"></a>00251     {
<a name="l00252"></a>00252         <span class="keywordflow">return</span> NULL;
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254 }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classCommandLine.html#fd61a82e1157a7767e2a52d89b770c96">CommandLine::GetNumBackspacesForCompletion</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00257"></a>00257 <span class="keyword"></span>{
<a name="l00258"></a>00258     <span class="keywordflow">return</span> m_iNumBackspacesForCompletion;
<a name="l00259"></a>00259 }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 <span class="keyword">const</span> <a class="code" href="classResourceString.html">ResourceString</a>&amp; <a class="code" href="classCommandLine.html#e6af7c2f1ebc3b31be87490be4d1fb2e">CommandLine::GetLastError</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00262"></a>00262 <span class="keyword"></span>{
<a name="l00263"></a>00263     <span class="keywordflow">return</span> m_cliError;
<a name="l00264"></a>00264 }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266 <span class="keyword">const</span> <span class="keywordtype">bool</span> CommandLine::Split(
<a name="l00267"></a>00267         <span class="keyword">const</span> tk::String&amp; STR_Line,
<a name="l00268"></a>00268         tk::Queue&lt;tk::String&gt;&amp; VSTR_Words,
<a name="l00269"></a>00269         <span class="keywordtype">int</span>&amp; I_LastWordPosition
<a name="l00270"></a>00270         )
<a name="l00271"></a>00271 {
<a name="l00272"></a>00272     I_LastWordPosition = -1;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     <span class="keyword">class </span>Do { <span class="keyword">public</span>:
<a name="l00275"></a>00275         <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> PushWord(
<a name="l00276"></a>00276             <span class="keyword">const</span> <a class="code" href="classElement.html">Element</a>&amp; CLI_Element, tk::Queue&lt;tk::String&gt;&amp; VSTR_Words,
<a name="l00277"></a>00277             <span class="keyword">const</span> <span class="keywordtype">int</span> I_Position, tk::String&amp; STR_Word,
<a name="l00278"></a>00278             <a class="code" href="classResourceString.html">ResourceString</a>&amp; CLI_Error)
<a name="l00279"></a>00279         {
<a name="l00280"></a>00280             <span class="keywordflow">if</span> (VSTR_Words.AddTail(STR_Word))
<a name="l00281"></a>00281             {
<a name="l00282"></a>00282                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; <span class="stringliteral">"Word '"</span> &lt;&lt; STR_Word &lt;&lt; <span class="stringliteral">"' pushed at "</span> &lt;&lt; I_Position &lt;&lt; <a class="code" href="io__device_8h.html#d6d7d55b8cc249130097ce4007a1162a">endl</a>;
<a name="l00283"></a>00283                 STR_Word.Set(<span class="stringliteral">""</span>);
<a name="l00284"></a>00284                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00285"></a>00285             }
<a name="l00286"></a>00286             <span class="keywordflow">else</span>
<a name="l00287"></a>00287             {
<a name="l00288"></a>00288                 CLI_Error
<a name="l00289"></a>00289                     .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(ResourceString::LANG_EN, <span class="stringliteral">"Too many words in command line"</span>)
<a name="l00290"></a>00290                     .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f">ResourceString::LANG_FR</a>, <span class="stringliteral">"Trop de mots dans la ligne de commande"</span>);
<a name="l00291"></a>00291                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; CLI_Error.<a class="code" href="classResourceString.html#9810e21c1e7ec3ab7f45c099f15fd7f7">GetString</a>(ResourceString::LANG_EN) &lt;&lt; <span class="stringliteral">" on '"</span> &lt;&lt; STR_Word &lt;&lt; <span class="stringliteral">"'"</span> &lt;&lt; endl;
<a name="l00292"></a>00292                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00293"></a>00293             }
<a name="l00294"></a>00294         }
<a name="l00295"></a>00295     };
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     tk::String str_Word(MAX_WORD_LENGTH);
<a name="l00298"></a>00298     <span class="keywordtype">bool</span> b_EscapeMode = <span class="keyword">false</span>;
<a name="l00299"></a>00299     <span class="keywordtype">bool</span> b_QuotedWord = <span class="keyword">false</span>;
<a name="l00300"></a>00300     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;STR_Line.GetLength(); i++)
<a name="l00301"></a>00301     {
<a name="l00302"></a>00302         <span class="keyword">const</span> <span class="keywordtype">char</span> c = STR_Line[i];
<a name="l00303"></a>00303 
<a name="l00304"></a>00304         <span class="comment">// End of line.</span>
<a name="l00305"></a>00305         <span class="keywordflow">if</span> (c == <span class="charliteral">'\n'</span>)
<a name="l00306"></a>00306         {
<a name="l00307"></a>00307             <span class="keywordflow">if</span> (b_EscapeMode)
<a name="l00308"></a>00308             {
<a name="l00309"></a>00309                 m_cliError
<a name="l00310"></a>00310                     .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(ResourceString::LANG_EN, <span class="stringliteral">"Unterminated escape sequence"</span>)
<a name="l00311"></a>00311                     .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f">ResourceString::LANG_FR</a>, <span class="stringliteral">"Séquence d'échappement incomplète"</span>);
<a name="l00312"></a>00312                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; m_cliError.<a class="code" href="classResourceString.html#9810e21c1e7ec3ab7f45c099f15fd7f7">GetString</a>(ResourceString::LANG_EN) &lt;&lt; <span class="stringliteral">" on \\n"</span> &lt;&lt; endl;
<a name="l00313"></a>00313                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00314"></a>00314             }
<a name="l00315"></a>00315             <span class="keywordflow">if</span> (b_QuotedWord)
<a name="l00316"></a>00316             {
<a name="l00317"></a>00317                 m_cliError
<a name="l00318"></a>00318                     .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(ResourceString::LANG_EN, <span class="stringliteral">"Unterminated quoted string"</span>)
<a name="l00319"></a>00319                     .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f">ResourceString::LANG_FR</a>, <span class="stringliteral">"Guillemets non fermés"</span>);
<a name="l00320"></a>00320                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; m_cliError.<a class="code" href="classResourceString.html#9810e21c1e7ec3ab7f45c099f15fd7f7">GetString</a>(ResourceString::LANG_EN) &lt;&lt; <span class="stringliteral">" on \\n"</span> &lt;&lt; endl;
<a name="l00321"></a>00321                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00322"></a>00322             }
<a name="l00323"></a>00323             <span class="keywordflow">if</span> (! str_Word.IsEmpty())
<a name="l00324"></a>00324             {
<a name="l00325"></a>00325                 <span class="keywordflow">if</span> (! Do::PushWord(*m_pcliMenu, VSTR_Words, i, str_Word, m_cliError)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00326"></a>00326                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; <span class="stringliteral">"LastWordPosition set to -1 on \\n"</span> &lt;&lt; endl;
<a name="l00327"></a>00327                 I_LastWordPosition = -1;
<a name="l00328"></a>00328             }
<a name="l00329"></a>00329         }
<a name="l00330"></a>00330         <span class="comment">// Quote</span>
<a name="l00331"></a>00331         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((c == <span class="charliteral">'"'</span>) &amp;&amp; (! b_EscapeMode))
<a name="l00332"></a>00332         {
<a name="l00333"></a>00333             <span class="keywordflow">if</span> (! b_QuotedWord)
<a name="l00334"></a>00334             {
<a name="l00335"></a>00335                 <span class="comment">// Beginning of quoted string.</span>
<a name="l00336"></a>00336                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; <span class="stringliteral">"Quoted string starting at "</span> &lt;&lt; i &lt;&lt; endl;
<a name="l00337"></a>00337                 b_QuotedWord = <span class="keyword">true</span>;
<a name="l00338"></a>00338                 <span class="comment">// Push previous word if any.</span>
<a name="l00339"></a>00339                 <span class="keywordflow">if</span> (! str_Word.IsEmpty())
<a name="l00340"></a>00340                 {
<a name="l00341"></a>00341                     <span class="keywordflow">if</span> (! Do::PushWord(*m_pcliMenu, VSTR_Words, i, str_Word, m_cliError)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00342"></a>00342                 }
<a name="l00343"></a>00343                 <span class="comment">// Completion management.</span>
<a name="l00344"></a>00344                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; <span class="stringliteral">"LastWordPosition set to "</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">" on \""</span> &lt;&lt; endl;
<a name="l00345"></a>00345                 I_LastWordPosition = i;
<a name="l00346"></a>00346             }
<a name="l00347"></a>00347             <span class="keywordflow">else</span>
<a name="l00348"></a>00348             {
<a name="l00349"></a>00349                 <span class="comment">// End of quoted string.</span>
<a name="l00350"></a>00350                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; <span class="stringliteral">"Quoted string ending at "</span> &lt;&lt; i &lt;&lt; endl;
<a name="l00351"></a>00351                 b_QuotedWord = <span class="keyword">false</span>;
<a name="l00352"></a>00352                 <span class="comment">// Push the word whatever.</span>
<a name="l00353"></a>00353                 <span class="keywordflow">if</span> (! Do::PushWord(*m_pcliMenu, VSTR_Words, i, str_Word, m_cliError)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00354"></a>00354                 <span class="comment">// No completion on quoted strings.</span>
<a name="l00355"></a>00355                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; <span class="stringliteral">"LastWordPosition set to -1 on \""</span> &lt;&lt; endl;
<a name="l00356"></a>00356                 I_LastWordPosition = -1;
<a name="l00357"></a>00357             }
<a name="l00358"></a>00358         }
<a name="l00359"></a>00359         <span class="comment">// Blank characters.</span>
<a name="l00360"></a>00360         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((c == <span class="charliteral">' '</span>) || (c == <span class="charliteral">'\t'</span>)) &amp;&amp; (! b_EscapeMode) &amp;&amp; (! b_QuotedWord))
<a name="l00361"></a>00361         {
<a name="l00362"></a>00362             <span class="keywordflow">if</span> (! str_Word.IsEmpty())
<a name="l00363"></a>00363             {
<a name="l00364"></a>00364                 <span class="keywordflow">if</span> (! Do::PushWord(*m_pcliMenu, VSTR_Words, i, str_Word, m_cliError)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00365"></a>00365                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; <span class="stringliteral">"LastWordPosition set to -1 on blank character"</span> &lt;&lt; endl;
<a name="l00366"></a>00366                 I_LastWordPosition = -1;
<a name="l00367"></a>00367             }
<a name="l00368"></a>00368         }
<a name="l00369"></a>00369         <span class="comment">// Escape character.</span>
<a name="l00370"></a>00370         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((c == <span class="charliteral">'\\'</span>) &amp;&amp; (! b_EscapeMode) &amp;&amp; (i &lt; STR_Line.GetLength() - 1))
<a name="l00371"></a>00371         {
<a name="l00372"></a>00372             <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; <span class="stringliteral">"Escape mode starting at "</span> &lt;&lt; i &lt;&lt; endl;
<a name="l00373"></a>00373             b_EscapeMode = <span class="keyword">true</span>;
<a name="l00374"></a>00374             <span class="keywordflow">if</span> (I_LastWordPosition &lt; 0)
<a name="l00375"></a>00375             {
<a name="l00376"></a>00376                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; <span class="stringliteral">"LastWordPosition set to "</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">" on \\"</span> &lt;&lt; endl;
<a name="l00377"></a>00377                 I_LastWordPosition = i;
<a name="l00378"></a>00378             }
<a name="l00379"></a>00379         }
<a name="l00380"></a>00380         <span class="comment">// Non blank character.</span>
<a name="l00381"></a>00381         <span class="keywordflow">else</span>
<a name="l00382"></a>00382         {
<a name="l00383"></a>00383             <span class="comment">// Word expansion.</span>
<a name="l00384"></a>00384             <span class="keywordflow">if</span> (! str_Word.Append(c))
<a name="l00385"></a>00385             {
<a name="l00386"></a>00386                 <span class="comment">// Internal error.</span>
<a name="l00387"></a>00387                 m_cliError
<a name="l00388"></a>00388                     .SetString(ResourceString::LANG_EN, <a class="code" href="classResourceString.html#ddf08a16467dbccd52cfa8e73d0aa95d">ResourceString::Concat</a>(<span class="stringliteral">"Too long word '"</span>, str_Word.SubString(0, 10), <span class="stringliteral">"...'"</span>))
<a name="l00389"></a>00389                     .SetString(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f">ResourceString::LANG_FR</a>, <a class="code" href="classResourceString.html#ddf08a16467dbccd52cfa8e73d0aa95d">ResourceString::Concat</a>(<span class="stringliteral">"Mot trop long '"</span>, str_Word.SubString(0, 10), <span class="stringliteral">"...'"</span>));
<a name="l00390"></a>00390                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; m_cliError.<a class="code" href="classResourceString.html#9810e21c1e7ec3ab7f45c099f15fd7f7">GetString</a>(ResourceString::LANG_EN) &lt;&lt; <span class="stringliteral">" on "</span> &lt;&lt; c &lt;&lt; endl;
<a name="l00391"></a>00391                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00392"></a>00392             }
<a name="l00393"></a>00393             <span class="keywordflow">if</span> (I_LastWordPosition &lt; 0)
<a name="l00394"></a>00394             {
<a name="l00395"></a>00395                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; <span class="stringliteral">"LastWordPosition set to "</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">" on non-blank character"</span> &lt;&lt; endl;
<a name="l00396"></a>00396                 I_LastWordPosition = i;
<a name="l00397"></a>00397             }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399             <span class="comment">// Escape mode reset.</span>
<a name="l00400"></a>00400             <span class="keywordflow">if</span> (b_EscapeMode)
<a name="l00401"></a>00401             {
<a name="l00402"></a>00402                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; <span class="stringliteral">"Escape mode ending at "</span> &lt;&lt; i &lt;&lt; endl;
<a name="l00403"></a>00403                 b_EscapeMode = <span class="keyword">false</span>;
<a name="l00404"></a>00404             }
<a name="l00405"></a>00405         }
<a name="l00406"></a>00406 
<a name="l00407"></a>00407         <span class="comment">// End of line management.</span>
<a name="l00408"></a>00408         <span class="keywordflow">if</span> (i &gt;= STR_Line.GetLength() - 1)
<a name="l00409"></a>00409         {
<a name="l00410"></a>00410             <span class="keywordflow">if</span> (! str_Word.IsEmpty())
<a name="l00411"></a>00411             {
<a name="l00412"></a>00412                 <span class="keywordflow">if</span> (! Do::PushWord(*m_pcliMenu, VSTR_Words, i, str_Word, m_cliError)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00413"></a>00413             }
<a name="l00414"></a>00414         }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416         <span class="keywordflow">if</span> (c == <span class="charliteral">'\n'</span>)
<a name="l00417"></a>00417         {
<a name="l00418"></a>00418             <span class="keywordflow">if</span> (VSTR_Words.AddTail(tk::String(MAX_WORD_LENGTH, <span class="stringliteral">"\n"</span>)))
<a name="l00419"></a>00419             {
<a name="l00420"></a>00420                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; <span class="stringliteral">"\\n pushed at "</span> &lt;&lt; i &lt;&lt; endl;
<a name="l00421"></a>00421                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; <span class="stringliteral">"LastWordPosition set to -1 on \\n"</span> &lt;&lt; endl;
<a name="l00422"></a>00422                 I_LastWordPosition = -1;
<a name="l00423"></a>00423                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00424"></a>00424             }
<a name="l00425"></a>00425             <span class="keywordflow">else</span>
<a name="l00426"></a>00426             {
<a name="l00427"></a>00427                 m_cliError
<a name="l00428"></a>00428                     .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(ResourceString::LANG_EN, <a class="code" href="classResourceString.html#ddf08a16467dbccd52cfa8e73d0aa95d">ResourceString::Concat</a>(<span class="stringliteral">"Too long word '"</span>, str_Word.SubString(0, 10), <span class="stringliteral">"...'"</span>))
<a name="l00429"></a>00429                     .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f">ResourceString::LANG_FR</a>, <a class="code" href="classResourceString.html#ddf08a16467dbccd52cfa8e73d0aa95d">ResourceString::Concat</a>(<span class="stringliteral">"Mot trop long '"</span>, str_Word.SubString(0, 10), <span class="stringliteral">"...'"</span>));
<a name="l00430"></a>00430                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; m_cliError.<a class="code" href="classResourceString.html#9810e21c1e7ec3ab7f45c099f15fd7f7">GetString</a>(ResourceString::LANG_EN) &lt;&lt; <span class="stringliteral">" on \\n"</span> &lt;&lt; endl;
<a name="l00431"></a>00431                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00432"></a>00432             }
<a name="l00433"></a>00433         }
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436     <span class="keywordflow">if</span> (b_EscapeMode)
<a name="l00437"></a>00437     {
<a name="l00438"></a>00438         m_cliError
<a name="l00439"></a>00439             .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(ResourceString::LANG_EN, <span class="stringliteral">"Unterminated escape sequence"</span>)
<a name="l00440"></a>00440             .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f">ResourceString::LANG_FR</a>, <span class="stringliteral">"Séquence d'échappement incomplète"</span>);
<a name="l00441"></a>00441         <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; m_cliError.<a class="code" href="classResourceString.html#9810e21c1e7ec3ab7f45c099f15fd7f7">GetString</a>(ResourceString::LANG_EN) &lt;&lt; <span class="stringliteral">" on end of line"</span> &lt;&lt; endl;
<a name="l00442"></a>00442         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00443"></a>00443     }
<a name="l00444"></a>00444     <span class="keywordflow">if</span> (b_QuotedWord)
<a name="l00445"></a>00445     {
<a name="l00446"></a>00446         m_cliError
<a name="l00447"></a>00447             .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(ResourceString::LANG_EN, <span class="stringliteral">"Unterminated quoted string"</span>)
<a name="l00448"></a>00448             .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f">ResourceString::LANG_FR</a>, <span class="stringliteral">"Guillemets non fermés"</span>);
<a name="l00449"></a>00449         <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2">Trace</a>(TRACE_CMD_LINE_SPLIT) &lt;&lt; <span class="stringliteral">"Unterminated quoted string on end of line"</span> &lt;&lt; endl;
<a name="l00450"></a>00450         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00451"></a>00451     }
<a name="l00452"></a>00452     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00453"></a>00453 }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455 <a class="code" href="classCommandLine.html">CommandLine</a>&amp; CommandLine::AddElement(<span class="keyword">const</span> <a class="code" href="classElement.html">Element</a>* <span class="keyword">const</span> PCLI_Element)
<a name="l00456"></a>00456 {
<a name="l00457"></a>00457     <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classParam.html">Param</a>* pcli_Param = dynamic_cast&lt;const Param*&gt;(PCLI_Element))
<a name="l00458"></a>00458     {
<a name="l00459"></a>00459         <span class="keyword">const</span> <a class="code" href="classParam.html">Param</a>* pcli_Clone = pcli_Param-&gt;Clone();
<a name="l00460"></a>00460         <span class="keywordflow">if</span> (! m_cliElements.AddTail(pcli_Clone))
<a name="l00461"></a>00461         {
<a name="l00462"></a>00462             <a class="code" href="assert_8h.html#1fe8f84b5d89ceccc07361b1d0da0144">CLI_ASSERT</a>(<span class="keyword">false</span>);
<a name="l00463"></a>00463         }
<a name="l00464"></a>00464         <span class="keywordflow">if</span> (! m_cliAutoDelete.AddTail(pcli_Clone))
<a name="l00465"></a>00465         {
<a name="l00466"></a>00466             <a class="code" href="assert_8h.html#1fe8f84b5d89ceccc07361b1d0da0144">CLI_ASSERT</a>(<span class="keyword">false</span>);
<a name="l00467"></a>00467         }
<a name="l00468"></a>00468     }
<a name="l00469"></a>00469     <span class="keywordflow">else</span>
<a name="l00470"></a>00470     {
<a name="l00471"></a>00471         <span class="keywordflow">if</span> (! m_cliElements.AddTail(PCLI_Element))
<a name="l00472"></a>00472         {
<a name="l00473"></a>00473             <a class="code" href="assert_8h.html#1fe8f84b5d89ceccc07361b1d0da0144">CLI_ASSERT</a>(<span class="keyword">false</span>);
<a name="l00474"></a>00474         }
<a name="l00475"></a>00475     }
<a name="l00476"></a>00476     <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00477"></a>00477 }
<a name="l00478"></a>00478 
<a name="l00479"></a>00479 
<a name="l00480"></a>00480 CommandLineIterator::CommandLineIterator(<span class="keyword">const</span> <a class="code" href="classCommandLine.html">CommandLine</a>&amp; CLI_CmdLine)
<a name="l00481"></a>00481   : m_cliCmdLine(CLI_CmdLine),
<a name="l00482"></a>00482     m_cliIterator(m_cliCmdLine.m_cliElements.GetIterator()), m_pcliCurrentElement(NULL)
<a name="l00483"></a>00483 {
<a name="l00484"></a>00484 }
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 <a class="code" href="classCommandLineIterator.html#999fa1aeeab71812f98e1f7ae009eecb">CommandLineIterator::~CommandLineIterator</a>(<span class="keywordtype">void</span>)
<a name="l00487"></a>00487 {
<a name="l00488"></a>00488 }
<a name="l00489"></a>00489 
<a name="l00490"></a>00490 <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classCommandLineIterator.html#4840f14ccad154fa837dede5c4591ca3">CommandLineIterator::StepIt</a>(<span class="keywordtype">void</span>)
<a name="l00491"></a>00491 {
<a name="l00492"></a>00492     <span class="keywordflow">if</span> (m_cliCmdLine.<a class="code" href="classCommandLine.html#e22dc329163074347a44965757e58439">m_cliElements</a>.IsValid(m_cliIterator))
<a name="l00493"></a>00493     {
<a name="l00494"></a>00494         m_pcliCurrentElement = m_cliCmdLine.<a class="code" href="classCommandLine.html#e22dc329163074347a44965757e58439">m_cliElements</a>.GetAt(m_cliIterator);
<a name="l00495"></a>00495         m_cliCmdLine.<a class="code" href="classCommandLine.html#e22dc329163074347a44965757e58439">m_cliElements</a>.MoveNext(m_cliIterator);
<a name="l00496"></a>00496         <span class="keywordflow">return</span> (m_pcliCurrentElement != NULL);
<a name="l00497"></a>00497     }
<a name="l00498"></a>00498     <span class="keywordflow">else</span>
<a name="l00499"></a>00499     {
<a name="l00500"></a>00500         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00501"></a>00501     }
<a name="l00502"></a>00502 }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504 <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classCommandLineIterator.html#3a24c70dc4137b9dca044378f938fa85">CommandLineIterator::operator==</a>(<span class="keyword">const</span> <a class="code" href="classElement.html">Element</a>&amp; CLI_Element)<span class="keyword"> const</span>
<a name="l00505"></a>00505 <span class="keyword"></span>{
<a name="l00506"></a>00506     <span class="keyword">const</span> cli::Param* <span class="keyword">const</span> pcli_RefParam = dynamic_cast&lt;const cli::Param*&gt;(&amp; CLI_Element);
<a name="l00507"></a>00507     <span class="keyword">const</span> cli::Param* <span class="keyword">const</span> pcli_CmdLineParam = dynamic_cast&lt;const cli::Param*&gt;(m_pcliCurrentElement);
<a name="l00508"></a>00508 
<a name="l00509"></a>00509     <span class="keywordflow">if</span> ((pcli_RefParam != NULL) &amp;&amp; (pcli_CmdLineParam != NULL)
<a name="l00510"></a>00510         &amp;&amp; (pcli_CmdLineParam-&gt;GetCloned() == pcli_RefParam))
<a name="l00511"></a>00511     {
<a name="l00512"></a>00512         pcli_RefParam-&gt;CopyValue(*pcli_CmdLineParam);
<a name="l00513"></a>00513         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00514"></a>00514     }
<a name="l00515"></a>00515     <span class="keywordflow">else</span>
<a name="l00516"></a>00516     {
<a name="l00517"></a>00517         <span class="keywordflow">return</span> (m_pcliCurrentElement == &amp; CLI_Element);
<a name="l00518"></a>00518     }
<a name="l00519"></a>00519 }
<a name="l00520"></a>00520 
<a name="l00521"></a>00521 <span class="keyword">const</span> <a class="code" href="classElement.html">Element</a>* <span class="keyword">const</span> <a class="code" href="classCommandLineIterator.html#8e73dfeee2727335a236ea4e265e394a">CommandLineIterator::operator*</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00522"></a>00522 <span class="keyword"></span>{
<a name="l00523"></a>00523     <span class="keywordflow">return</span> m_pcliCurrentElement;
<a name="l00524"></a>00524 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Dec 12 23:20:26 2011 for CLI by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
