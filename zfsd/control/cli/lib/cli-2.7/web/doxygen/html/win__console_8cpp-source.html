<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>CLI: win_console.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-20981143-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_7ca5e860cc97c111944d6d090aaeaed5.html">cpp</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_909ff1c5a0fe7ebd415c9e08d3a715b8.html">src</a></div>
<h1>win_console.cpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">    Copyright (c) 2006-2011, Alexis Royer, http://alexis.royer.free.fr/CLI</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">    All rights reserved.</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">    Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">        * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00009"></a>00009 <span class="comment">        * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00010"></a>00010 <span class="comment">        * Neither the name of the CLI library project nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00013"></a>00013 <span class="comment">    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00014"></a>00014 <span class="comment">    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00015"></a>00015 <span class="comment">    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR</span>
<a name="l00016"></a>00016 <span class="comment">    CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span>
<a name="l00017"></a>00017 <span class="comment">    EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
<a name="l00018"></a>00018 <span class="comment">    PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
<a name="l00019"></a>00019 <span class="comment">    PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
<a name="l00020"></a>00020 <span class="comment">    LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
<a name="l00021"></a>00021 <span class="comment">    NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<a name="l00022"></a>00022 <span class="comment">    SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00023"></a>00023 <span class="comment">*/</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="pch_8h.html">cli/pch.h</a>"</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="comment">// ifdef defined for dependency computation</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;windows.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;conio.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#undef DELETE</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>
<a name="l00035"></a>00035 <span class="preprocessor">#include "<a class="code" href="console_8h.html">cli/console.h</a>"</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include "<a class="code" href="traces_8h.html">cli/traces.h</a>"</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include "<a class="code" href="assert_8h.html">cli/assert.h</a>"</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <a class="code" href="namespace_8h.html#965caf70ca576c007bee150001248651">CLI_NS_USE</a>(cli)
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">#define CLI_WIN_CONSOLE_IN GetWinConsoleInTraceClass()</span>
<a name="l00045"></a>00045 <span class="preprocessor">static const TraceClass&amp; GetWinConsoleInTraceClass(void)</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span>{
<a name="l00047"></a>00047     <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classTraceClass.html">TraceClass</a> cli_WinConsoleInTraceClass(<span class="stringliteral">"CLI_WIN_CONSOLE_IN"</span>, <a class="code" href="classHelp.html">Help</a>()
<a name="l00048"></a>00048         .AddHelp(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df">Help::LANG_EN</a>, <span class="stringliteral">"CLI Windows console input traces"</span>)
<a name="l00049"></a>00049         .AddHelp(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f">Help::LANG_FR</a>, <span class="stringliteral">"Traces d'entrées de la console Windows du CLI"</span>));
<a name="l00050"></a>00050     <span class="keywordflow">return</span> cli_WinConsoleInTraceClass;
<a name="l00051"></a>00051 }
<a name="l00053"></a>00053 <span class="preprocessor">#define CLI_WIN_CONSOLE_OUT GetWinConsoleOutTraceClass()</span>
<a name="l00055"></a>00055 <span class="preprocessor">static const TraceClass&amp; GetWinConsoleOutTraceClass(void)</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>{
<a name="l00057"></a>00057     <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classTraceClass.html">TraceClass</a> cli_WinConsoleOutTraceClass(<span class="stringliteral">"CLI_WIN_CONSOLE_OUT"</span>, <a class="code" href="classHelp.html">Help</a>()
<a name="l00058"></a>00058         .AddHelp(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df">Help::LANG_EN</a>, <span class="stringliteral">"CLI Windows console output traces"</span>)
<a name="l00059"></a>00059         .AddHelp(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f">Help::LANG_FR</a>, <span class="stringliteral">"Traces de sorties la console Windows du CLI"</span>));
<a name="l00060"></a>00060     <span class="keywordflow">return</span> cli_WinConsoleOutTraceClass;
<a name="l00061"></a>00061 }
<a name="l00062"></a>00062 
<a name="l00065"></a>00065 <span class="keyword">static</span> <span class="keyword">const</span> HANDLE GetWinConsoleHandle(<span class="keywordtype">void</span>)
<a name="l00066"></a>00066 {
<a name="l00067"></a>00067     <span class="keywordflow">return</span> GetStdHandle(STD_OUTPUT_HANDLE);
<a name="l00068"></a>00068 }
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 Console::Console(<span class="keyword">const</span> <span class="keywordtype">bool</span> B_AutoDelete)
<a name="l00072"></a>00072   : <a class="code" href="classIODevice.html">IODevice</a>(<span class="stringliteral">"win-console"</span>, B_AutoDelete),
<a name="l00073"></a>00073     m_pData(NULL)
<a name="l00074"></a>00074 {
<a name="l00075"></a>00075     <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#6e460792b0696ff90a7d35f77a941c6d">Declare</a>(CLI_WIN_CONSOLE_IN);
<a name="l00076"></a>00076     <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#6e460792b0696ff90a7d35f77a941c6d">Declare</a>(CLI_WIN_CONSOLE_OUT);
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <a class="code" href="classConsole.html#ee0e9bafbe28a29f1b14fc8c12b57364">Console::~Console</a>(<span class="keywordtype">void</span>)
<a name="l00080"></a>00080 {
<a name="l00081"></a>00081     <a class="code" href="classConsole.html#0d8ed69f9586088160b795645347c967">Console::CloseDevice</a>();
<a name="l00082"></a>00082 }
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classConsole.html#c9353ac3f8396187a580b7647a24f8dd">Console::OpenDevice</a>(<span class="keywordtype">void</span>)
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00087"></a>00087 }
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classConsole.html#0d8ed69f9586088160b795645347c967">Console::CloseDevice</a>(<span class="keywordtype">void</span>)
<a name="l00090"></a>00090 {
<a name="l00091"></a>00091     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00092"></a>00092 }
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 <span class="keyword">const</span> <a class="code" href="io__device_8h.html#90d295cf6b6bc9873c186cc8851147f8">KEY</a> <a class="code" href="classConsole.html#cd2370429204adbe9c4e1345f7878df9">Console::GetKey</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00095"></a>00095 <span class="keyword"></span>{
<a name="l00096"></a>00096     <span class="keywordflow">while</span> (1)
<a name="l00097"></a>00097     {
<a name="l00098"></a>00098         <span class="keyword">const</span> <span class="keywordtype">int</span> i_Char = _getch(); <span class="comment">// [contrib: Oleg Smolsky, 2010, based on CLI 2.5]</span>
<a name="l00099"></a>00099         <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#99fe59fe9cb9e5183b245623c2a240a8">SafeTrace</a>(CLI_WIN_CONSOLE_IN, *<span class="keyword">this</span>) &lt;&lt; <span class="stringliteral">"i_Char = "</span> &lt;&lt; i_Char &lt;&lt; <a class="code" href="io__device_8h.html#d6d7d55b8cc249130097ce4007a1162a">endl</a>;
<a name="l00100"></a>00100         <span class="keywordflow">switch</span> (i_Char)
<a name="l00101"></a>00101         {
<a name="l00102"></a>00102             <span class="keywordflow">case</span> 0: <span class="comment">// Escaped characters</span>
<a name="l00103"></a>00103             {
<a name="l00104"></a>00104                 <span class="keyword">const</span> <span class="keywordtype">int</span> i_Char2 = _getch(); <span class="comment">// [contrib: Oleg Smolsky, 2010, based on CLI 2.5]</span>
<a name="l00105"></a>00105                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#99fe59fe9cb9e5183b245623c2a240a8">SafeTrace</a>(CLI_WIN_CONSOLE_IN, *<span class="keyword">this</span>) &lt;&lt; <span class="stringliteral">"i_Char2 = "</span> &lt;&lt; i_Char2 &lt;&lt; endl;
<a name="l00106"></a>00106                 <span class="keywordflow">switch</span> (i_Char2)
<a name="l00107"></a>00107                 {
<a name="l00108"></a>00108                 <span class="keywordflow">case</span> 17:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc27047122a937c23ef109ac28176b98dacad9c6">UNDO</a>;        <span class="comment">// CTRL+ALT+Z</span>
<a name="l00109"></a>00109                 <span class="keywordflow">case</span> 21:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471d20f1b79e9cfc073db19741638050449">REDO</a>;        <span class="comment">// CTRL+ALT+Y</span>
<a name="l00110"></a>00110                 <span class="keywordflow">case</span> 45:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc2704712ce36c09e2a0142dfc115c74cea4d486">CUT</a>;         <span class="comment">// CTRL+ALT+X</span>
<a name="l00111"></a>00111                 <span class="keywordflow">case</span> 46:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471ba6788019f0f871f0aefcd5644635785">COPY</a>;        <span class="comment">// CTRL+ALT+C</span>
<a name="l00112"></a>00112                 <span class="keywordflow">case</span> 47:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471c4f906197c73a739eeab28811ca34ee0">PASTE</a>;       <span class="comment">// CTRL+ALT+V</span>
<a name="l00113"></a>00113                 <span class="keywordflow">case</span> 59:    <span class="keywordflow">return</span> F1;
<a name="l00114"></a>00114                 <span class="keywordflow">case</span> 60:    <span class="keywordflow">return</span> F2;
<a name="l00115"></a>00115                 <span class="keywordflow">case</span> 61:    <span class="keywordflow">return</span> F3;
<a name="l00116"></a>00116                 <span class="keywordflow">case</span> 62:    <span class="keywordflow">return</span> F4;
<a name="l00117"></a>00117                 <span class="keywordflow">case</span> 63:    <span class="keywordflow">return</span> F5;
<a name="l00118"></a>00118                 <span class="keywordflow">case</span> 64:    <span class="keywordflow">return</span> F6;
<a name="l00119"></a>00119                 <span class="keywordflow">case</span> 65:    <span class="keywordflow">return</span> F7;
<a name="l00120"></a>00120                 <span class="keywordflow">case</span> 66:    <span class="keywordflow">return</span> F8;
<a name="l00121"></a>00121                 <span class="keywordflow">case</span> 67:    <span class="keywordflow">return</span> F9;
<a name="l00122"></a>00122                 <span class="keywordflow">case</span> 68:    <span class="keywordflow">return</span> F10;
<a name="l00123"></a>00123                 <span class="keywordflow">case</span> 121:   <span class="keywordflow">return</span> TILDE;
<a name="l00124"></a>00124                 <span class="keywordflow">case</span> 126:   <span class="keywordflow">return</span> BACK_QUOTE;
<a name="l00125"></a>00125                 <span class="keywordflow">case</span> 155:   <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471d9600a436d5cc272dfd53f6c45fdeca4">PREVIOUS</a>;    <span class="comment">// ALT+LEFT</span>
<a name="l00126"></a>00126                 <span class="keywordflow">case</span> 157:   <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471b13b96bf99a409e019f70dc1602532fd">NEXT</a>;        <span class="comment">// ALT+RIGHT</span>
<a name="l00127"></a>00127                 }
<a name="l00128"></a>00128                 <span class="keywordflow">break</span>;
<a name="l00129"></a>00129             }
<a name="l00130"></a>00130             <span class="keywordflow">case</span> 1:     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471eed3bac3a74a2eaf9a84d1a9774b67c1">KEY_BEGIN</a>;   <span class="comment">// CTRL+A</span>
<a name="l00131"></a>00131             <span class="keywordflow">case</span> 3:     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc2704719524d094809858b9e4f778763913568a">BREAK</a>;       <span class="comment">// CTRL+C</span>
<a name="l00132"></a>00132             <span class="keywordflow">case</span> 4:     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc27047186d6ca369e69a3a0f0c9bd063dd39a70">LOGOUT</a>;      <span class="comment">// CTRL+D</span>
<a name="l00133"></a>00133             <span class="keywordflow">case</span> 5:     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471a8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>;     <span class="comment">// CTRL+E</span>
<a name="l00134"></a>00134             <span class="keywordflow">case</span> 8:     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471d2534cebcf6f430484b7c931dd657ddc">BACKSPACE</a>;   <span class="comment">// (CTRL+H)</span>
<a name="l00135"></a>00135             <span class="keywordflow">case</span> 12:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471a5e0d06ffc1b0ee32eda539e6528a3e6">CLS</a>;         <span class="comment">// CTRL+L</span>
<a name="l00136"></a>00136             <span class="keywordflow">case</span> 14:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471b13b96bf99a409e019f70dc1602532fd">NEXT</a>;        <span class="comment">// CTRL+N</span>
<a name="l00137"></a>00137             <span class="keywordflow">case</span> 16:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471d9600a436d5cc272dfd53f6c45fdeca4">PREVIOUS</a>;    <span class="comment">// CTRL+P</span>
<a name="l00138"></a>00138             <span class="keywordflow">case</span> 25:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471d20f1b79e9cfc073db19741638050449">REDO</a>;        <span class="comment">// CTRL+Y</span>
<a name="l00139"></a>00139             <span class="keywordflow">case</span> 26:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc27047122a937c23ef109ac28176b98dacad9c6">UNDO</a>;        <span class="comment">// CTRL+Z</span>
<a name="l00140"></a>00140             <span class="keywordflow">case</span> 27:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc2704710a311695a4f6c56869245418bebeb33d">ESCAPE</a>;
<a name="l00141"></a>00141             <span class="comment">//case 63:    return EURO;        // CTRL+ALT+E, conflicts with '?'</span>
<a name="l00142"></a>00142             <span class="keywordflow">case</span> 96:    <span class="keywordflow">break</span>;              <span class="comment">// character always returned after `</span>
<a name="l00143"></a>00143             <span class="keywordflow">case</span> 126:   <span class="keywordflow">break</span>;              <span class="comment">// character always return after ~</span>
<a name="l00144"></a>00144             <span class="keywordflow">case</span> 160:   <span class="keywordflow">return</span> KEY_aacute;
<a name="l00145"></a>00145             <span class="keywordflow">case</span> 133:   <span class="keywordflow">return</span> KEY_agrave;
<a name="l00146"></a>00146             <span class="keywordflow">case</span> 132:   <span class="keywordflow">return</span> KEY_auml;
<a name="l00147"></a>00147             <span class="keywordflow">case</span> 131:   <span class="keywordflow">return</span> KEY_acirc;
<a name="l00148"></a>00148             <span class="keywordflow">case</span> 135:   <span class="keywordflow">return</span> KEY_ccedil;
<a name="l00149"></a>00149             <span class="keywordflow">case</span> 130:   <span class="keywordflow">return</span> KEY_eacute;
<a name="l00150"></a>00150             <span class="keywordflow">case</span> 138:   <span class="keywordflow">return</span> KEY_egrave;
<a name="l00151"></a>00151             <span class="keywordflow">case</span> 137:   <span class="keywordflow">return</span> KEY_euml;
<a name="l00152"></a>00152             <span class="keywordflow">case</span> 136:   <span class="keywordflow">return</span> KEY_ecirc;
<a name="l00153"></a>00153             <span class="keywordflow">case</span> 161:   <span class="keywordflow">return</span> KEY_iacute;
<a name="l00154"></a>00154             <span class="keywordflow">case</span> 141:   <span class="keywordflow">return</span> KEY_igrave;
<a name="l00155"></a>00155             <span class="keywordflow">case</span> 139:   <span class="keywordflow">return</span> KEY_iuml;
<a name="l00156"></a>00156             <span class="keywordflow">case</span> 140:   <span class="keywordflow">return</span> KEY_icirc;
<a name="l00157"></a>00157             <span class="keywordflow">case</span> 156:   <span class="keywordflow">return</span> POUND;
<a name="l00158"></a>00158             <span class="keywordflow">case</span> 162:   <span class="keywordflow">return</span> KEY_oacute;
<a name="l00159"></a>00159             <span class="keywordflow">case</span> 149:   <span class="keywordflow">return</span> KEY_ograve;
<a name="l00160"></a>00160             <span class="keywordflow">case</span> 148:   <span class="keywordflow">return</span> KEY_ouml;
<a name="l00161"></a>00161             <span class="keywordflow">case</span> 147:   <span class="keywordflow">return</span> KEY_ocirc;
<a name="l00162"></a>00162             <span class="keywordflow">case</span> 163:   <span class="keywordflow">return</span> KEY_uacute;
<a name="l00163"></a>00163             <span class="keywordflow">case</span> 151:   <span class="keywordflow">return</span> KEY_ugrave;
<a name="l00164"></a>00164             <span class="keywordflow">case</span> 129:   <span class="keywordflow">return</span> KEY_uuml;
<a name="l00165"></a>00165             <span class="keywordflow">case</span> 150:   <span class="keywordflow">return</span> KEY_ucirc;
<a name="l00166"></a>00166             <span class="keywordflow">case</span> 224: <span class="comment">// Escaped characters.</span>
<a name="l00167"></a>00167             {
<a name="l00168"></a>00168                 <span class="keyword">const</span> <span class="keywordtype">int</span> i_Char2 = _getch(); <span class="comment">// [contrib: Oleg Smolsky, 2010, based on CLI 2.5]</span>
<a name="l00169"></a>00169                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#99fe59fe9cb9e5183b245623c2a240a8">SafeTrace</a>(CLI_WIN_CONSOLE_IN, *<span class="keyword">this</span>) &lt;&lt; <span class="stringliteral">"i_Char2 = "</span> &lt;&lt; i_Char2 &lt;&lt; endl;
<a name="l00170"></a>00170                 <span class="keywordflow">switch</span> (i_Char2)
<a name="l00171"></a>00171                 {
<a name="l00172"></a>00172                     <span class="keywordflow">case</span> 71:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471eed3bac3a74a2eaf9a84d1a9774b67c1">KEY_BEGIN</a>;
<a name="l00173"></a>00173                     <span class="keywordflow">case</span> 72:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc2704710848a442d907968b211b97bc2bd88acd">KEY_UP</a>;
<a name="l00174"></a>00174                     <span class="keywordflow">case</span> 73:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc2704710442824c041b9618cd7c512205e7e6dc">PAGE_UP</a>;
<a name="l00175"></a>00175                     <span class="keywordflow">case</span> 75:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471612120b69c7dfd46086db7aaebdbcf65">KEY_LEFT</a>;
<a name="l00176"></a>00176                     <span class="keywordflow">case</span> 77:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc2704716504370d9c6391e1a9da6a1a529b089d">KEY_RIGHT</a>;
<a name="l00177"></a>00177                     <span class="keywordflow">case</span> 79:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471a8adb6fcb92dec58fb19410eacfdd403">KEY_END</a>;
<a name="l00178"></a>00178                     <span class="keywordflow">case</span> 80:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471a9cdac7967bf7d88fdb761138a2a3416">KEY_DOWN</a>;
<a name="l00179"></a>00179                     <span class="keywordflow">case</span> 81:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471714c5d27586a8bcbab274d9176da1539">PAGE_DOWN</a>;
<a name="l00180"></a>00180                     <span class="keywordflow">case</span> 82:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471a15c451953b2d2a93403afe786930d0f">INSERT</a>;
<a name="l00181"></a>00181                     <span class="keywordflow">case</span> 83:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc2704719d61e82a9a12752f10aece1b22183913">DELETE</a>;
<a name="l00182"></a>00182                     <span class="keywordflow">case</span> 115:   <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc2704711846e4603e4d87a4b4edaf95d37beb3d">PAGE_LEFT</a>;   <span class="comment">// CTRL+LEFT</span>
<a name="l00183"></a>00183                     <span class="keywordflow">case</span> 116:   <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc27047127397af39433946e64f36072d4c116e3">PAGE_RIGHT</a>;  <span class="comment">// CTRL+RIGHT</span>
<a name="l00184"></a>00184                     <span class="keywordflow">case</span> 133:   <span class="keywordflow">return</span> F11;
<a name="l00185"></a>00185                     <span class="keywordflow">case</span> 134:   <span class="keywordflow">return</span> F12;
<a name="l00186"></a>00186                     <span class="keywordflow">case</span> 141:   <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc2704710442824c041b9618cd7c512205e7e6dc">PAGE_UP</a>;     <span class="comment">// CTRL+UP</span>
<a name="l00187"></a>00187                     <span class="keywordflow">case</span> 145:   <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471714c5d27586a8bcbab274d9176da1539">PAGE_DOWN</a>;   <span class="comment">// CTRL+DOWN</span>
<a name="l00188"></a>00188                     <span class="keywordflow">case</span> 146:   <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471ba6788019f0f871f0aefcd5644635785">COPY</a>;        <span class="comment">// CTRL+INS</span>
<a name="l00189"></a>00189                 }
<a name="l00190"></a>00190                 <span class="keywordflow">break</span>;
<a name="l00191"></a>00191             }
<a name="l00192"></a>00192             <span class="keywordflow">case</span> 230:   <span class="keywordflow">return</span> MICRO;
<a name="l00193"></a>00193             <span class="keywordflow">case</span> 245:   <span class="keywordflow">return</span> PARAGRAPH;
<a name="l00194"></a>00194             <span class="keywordflow">case</span> 248:   <span class="keywordflow">return</span> DEGREE;
<a name="l00195"></a>00195             <span class="keywordflow">case</span> 184:   <span class="keywordflow">return</span> COPYRIGHT;
<a name="l00196"></a>00196             <span class="keywordflow">case</span> 253:   <span class="keywordflow">return</span> SQUARE;
<a name="l00197"></a>00197             <span class="keywordflow">default</span>:
<a name="l00198"></a>00198             {
<a name="l00199"></a>00199                 <span class="keyword">const</span> <a class="code" href="io__device_8h.html#90d295cf6b6bc9873c186cc8851147f8">KEY</a> e_Char = <a class="code" href="classIODevice.html#7bafac5c500746f742aa289f33e38feb">IODevice::GetKey</a>(i_Char);
<a name="l00200"></a>00200                 <span class="keywordflow">if</span> (e_Char != <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471e42682039e1a584113718465a202d0c0">NULL_KEY</a>)
<a name="l00201"></a>00201                 {
<a name="l00202"></a>00202                     <span class="keywordflow">return</span> e_Char;
<a name="l00203"></a>00203                 }
<a name="l00204"></a>00204             }
<a name="l00205"></a>00205         }
<a name="l00206"></a>00206     }
<a name="l00207"></a>00207 }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 <span class="keywordtype">void</span> <a class="code" href="classConsole.html#a8455649269c200fa787c26a36e2ea2d">Console::PutString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> STR_Out)<span class="keyword"> const</span>
<a name="l00210"></a>00210 <span class="keyword"></span>{
<a name="l00211"></a>00211     <span class="keywordflow">if</span> (STR_Out != NULL)
<a name="l00212"></a>00212     {
<a name="l00213"></a>00213         <span class="comment">// Create a buffer that will optimize display</span>
<a name="l00214"></a>00214         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ui_BufferSize = (<a class="code" href="classConsole.html#246d6e798d44b97ec8ec28495444f385">GetScreenInfo</a>().GetSafeWidth() + 1) * <a class="code" href="classConsole.html#246d6e798d44b97ec8ec28495444f385">GetScreenInfo</a>().GetSafeHeight();
<a name="l00215"></a>00215         tk::String tk_Out(ui_BufferSize);
<a name="l00216"></a>00216 
<a name="l00217"></a>00217         <span class="keywordflow">for</span> (   <span class="keyword">const</span> <span class="keywordtype">char</span>* pc_Out = STR_Out;
<a name="l00218"></a>00218                 (pc_Out != NULL) &amp;&amp; (*pc_Out != <span class="charliteral">'\0'</span>);
<a name="l00219"></a>00219                 pc_Out ++)
<a name="l00220"></a>00220         {
<a name="l00221"></a>00221             <span class="keywordtype">char</span> c_Out = *pc_Out;
<a name="l00222"></a>00222             <span class="keywordflow">switch</span> (*pc_Out)
<a name="l00223"></a>00223             {
<a name="l00224"></a>00224                 <span class="keywordflow">case</span> KEY_aacute:    c_Out = (<span class="keywordtype">char</span>) -96;   <span class="keywordflow">break</span>;
<a name="l00225"></a>00225                 <span class="keywordflow">case</span> KEY_agrave:    c_Out = (char) -123;  <span class="keywordflow">break</span>;
<a name="l00226"></a>00226                 <span class="keywordflow">case</span> KEY_auml:      c_Out = (char) -124;  <span class="keywordflow">break</span>;
<a name="l00227"></a>00227                 <span class="keywordflow">case</span> KEY_acirc:     c_Out = (char) -125;  <span class="keywordflow">break</span>;
<a name="l00228"></a>00228                 <span class="keywordflow">case</span> KEY_ccedil:    c_Out = (char) -121;  <span class="keywordflow">break</span>;
<a name="l00229"></a>00229                 <span class="keywordflow">case</span> KEY_eacute:    c_Out = (char) -126;  <span class="keywordflow">break</span>;
<a name="l00230"></a>00230                 <span class="keywordflow">case</span> KEY_egrave:    c_Out = (char) -118;  <span class="keywordflow">break</span>;
<a name="l00231"></a>00231                 <span class="keywordflow">case</span> KEY_euml:      c_Out = (char) -119;  <span class="keywordflow">break</span>;
<a name="l00232"></a>00232                 <span class="keywordflow">case</span> KEY_ecirc:     c_Out = (char) -120;  <span class="keywordflow">break</span>;
<a name="l00233"></a>00233                 <span class="keywordflow">case</span> KEY_iacute:    c_Out = (char) -95;   <span class="keywordflow">break</span>;
<a name="l00234"></a>00234                 <span class="keywordflow">case</span> KEY_igrave:    c_Out = (char) -115;  <span class="keywordflow">break</span>;
<a name="l00235"></a>00235                 <span class="keywordflow">case</span> KEY_iuml:      c_Out = (char) -117;  <span class="keywordflow">break</span>;
<a name="l00236"></a>00236                 <span class="keywordflow">case</span> KEY_icirc:     c_Out = (char) -116;  <span class="keywordflow">break</span>;
<a name="l00237"></a>00237                 <span class="keywordflow">case</span> KEY_oacute:    c_Out = (char) -94;   <span class="keywordflow">break</span>;
<a name="l00238"></a>00238                 <span class="keywordflow">case</span> KEY_ograve:    c_Out = (char) -107;  <span class="keywordflow">break</span>;
<a name="l00239"></a>00239                 <span class="keywordflow">case</span> KEY_ouml:      c_Out = (char) -108;  <span class="keywordflow">break</span>;
<a name="l00240"></a>00240                 <span class="keywordflow">case</span> KEY_ocirc:     c_Out = (char) -109;  <span class="keywordflow">break</span>;
<a name="l00241"></a>00241                 <span class="keywordflow">case</span> KEY_uacute:    c_Out = (char) -93;   <span class="keywordflow">break</span>;
<a name="l00242"></a>00242                 <span class="keywordflow">case</span> KEY_ugrave:    c_Out = (char) -105;  <span class="keywordflow">break</span>;
<a name="l00243"></a>00243                 <span class="keywordflow">case</span> KEY_uuml:      c_Out = (char) -127;  <span class="keywordflow">break</span>;
<a name="l00244"></a>00244                 <span class="keywordflow">case</span> KEY_ucirc:     c_Out = (char) -106;  <span class="keywordflow">break</span>;
<a name="l00245"></a>00245                 <span class="keywordflow">case</span> SQUARE:        c_Out = (char) -3;    <span class="keywordflow">break</span>;
<a name="l00246"></a>00246                 <span class="keywordflow">case</span> EURO:          c_Out = (char) -79;   <span class="keywordflow">break</span>;
<a name="l00247"></a>00247                 <span class="keywordflow">case</span> POUND:         c_Out = (char) -100;  <span class="keywordflow">break</span>;
<a name="l00248"></a>00248                 <span class="keywordflow">case</span> MICRO:         c_Out = (char) -26;   <span class="keywordflow">break</span>;
<a name="l00249"></a>00249                 <span class="keywordflow">case</span> PARAGRAPH:     c_Out = (char) -11;   <span class="keywordflow">break</span>;
<a name="l00250"></a>00250                 <span class="keywordflow">case</span> DEGREE:        c_Out = (char) -8;    <span class="keywordflow">break</span>;
<a name="l00251"></a>00251                 <span class="keywordflow">case</span> COPYRIGHT:     c_Out = (char) -72;   <span class="keywordflow">break</span>;
<a name="l00252"></a>00252                 <span class="keywordflow">case</span> -61:
<a name="l00253"></a>00253                 {
<a name="l00254"></a>00254                     <span class="comment">// Ecaped characters (from Java for instance).</span>
<a name="l00255"></a>00255                     pc_Out ++;
<a name="l00256"></a>00256                     <span class="keywordflow">if</span> ((pc_Out != NULL) &amp;&amp; (*pc_Out != <span class="charliteral">'\0'</span>))
<a name="l00257"></a>00257                     {
<a name="l00258"></a>00258                         <span class="keywordflow">switch</span> (*pc_Out)
<a name="l00259"></a>00259                         {
<a name="l00260"></a>00260                             <span class="keywordflow">case</span> -95:   c_Out = (<span class="keywordtype">char</span>) -96;   <span class="keywordflow">break</span>;  <span class="comment">// KEY_aacute</span>
<a name="l00261"></a>00261                             <span class="keywordflow">case</span> -96:   c_Out = (char) -123;  <span class="keywordflow">break</span>;  <span class="comment">// KEY_agrave</span>
<a name="l00262"></a>00262                             <span class="keywordflow">case</span> -92:   c_Out = (char) -124;  <span class="keywordflow">break</span>;  <span class="comment">// KEY_auml</span>
<a name="l00263"></a>00263                             <span class="keywordflow">case</span> -94:   c_Out = (char) -125;  <span class="keywordflow">break</span>;  <span class="comment">// KEY_acirc</span>
<a name="l00264"></a>00264                             <span class="keywordflow">case</span> -89:   c_Out = (char) -121;  <span class="keywordflow">break</span>;  <span class="comment">// KEY_ccedil</span>
<a name="l00265"></a>00265                             <span class="keywordflow">case</span> -87:   c_Out = (char) -126;  <span class="keywordflow">break</span>;  <span class="comment">// KEY_eacute</span>
<a name="l00266"></a>00266                             <span class="keywordflow">case</span> -88:   c_Out = (char) -118;  <span class="keywordflow">break</span>;  <span class="comment">// KEY_egrave</span>
<a name="l00267"></a>00267                             <span class="keywordflow">case</span> -85:   c_Out = (char) -119;  <span class="keywordflow">break</span>;  <span class="comment">// KEY_euml</span>
<a name="l00268"></a>00268                             <span class="keywordflow">case</span> -86:   c_Out = (char) -120;  <span class="keywordflow">break</span>;  <span class="comment">// KEY_ecirc</span>
<a name="l00269"></a>00269                             <span class="keywordflow">case</span> -83:   c_Out = (char) -95;   <span class="keywordflow">break</span>;  <span class="comment">// KEY_iacute</span>
<a name="l00270"></a>00270                             <span class="keywordflow">case</span> -84:   c_Out = (char) -115;  <span class="keywordflow">break</span>;  <span class="comment">// KEY_igrave</span>
<a name="l00271"></a>00271                             <span class="keywordflow">case</span> -81:   c_Out = (char) -117;  <span class="keywordflow">break</span>;  <span class="comment">// KEY_iuml</span>
<a name="l00272"></a>00272                             <span class="keywordflow">case</span> -82:   c_Out = (char) -116;  <span class="keywordflow">break</span>;  <span class="comment">// KEY_icirc</span>
<a name="l00273"></a>00273                             <span class="keywordflow">case</span> -77:   c_Out = (char) -94;   <span class="keywordflow">break</span>;  <span class="comment">// KEY_oacute</span>
<a name="l00274"></a>00274                             <span class="keywordflow">case</span> -78:   c_Out = (char) -107;  <span class="keywordflow">break</span>;  <span class="comment">// KEY_ograve</span>
<a name="l00275"></a>00275                             <span class="keywordflow">case</span> -74:   c_Out = (char) -108;  <span class="keywordflow">break</span>;  <span class="comment">// KEY_ouml</span>
<a name="l00276"></a>00276                             <span class="keywordflow">case</span> -76:   c_Out = (char) -109;  <span class="keywordflow">break</span>;  <span class="comment">// KEY_ocirc</span>
<a name="l00277"></a>00277                             <span class="keywordflow">case</span> -70:   c_Out = (char) -93;   <span class="keywordflow">break</span>;  <span class="comment">// KEY_uacute</span>
<a name="l00278"></a>00278                             <span class="keywordflow">case</span> -71:   c_Out = (char) -105;  <span class="keywordflow">break</span>;  <span class="comment">// KEY_ugrave</span>
<a name="l00279"></a>00279                             <span class="keywordflow">case</span> -68:   c_Out = (char) -127;  <span class="keywordflow">break</span>;  <span class="comment">// KEY_uuml</span>
<a name="l00280"></a>00280                             <span class="keywordflow">case</span> -69:   c_Out = (char) -106;  <span class="keywordflow">break</span>;  <span class="comment">// KEY_ucirc</span>
<a name="l00281"></a>00281                         }
<a name="l00282"></a>00282                     }
<a name="l00283"></a>00283                     <span class="keywordflow">break</span>;
<a name="l00284"></a>00284                 }
<a name="l00285"></a>00285             }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287             <span class="comment">// Append the buffer.</span>
<a name="l00288"></a>00288             <span class="keywordflow">if</span> (tk_Out.GetLength() &gt;= ui_BufferSize)
<a name="l00289"></a>00289             {
<a name="l00290"></a>00290                 <span class="comment">// If the buffer is full, display and reset before.</span>
<a name="l00291"></a>00291                 _cputs((<span class="keyword">const</span> <span class="keywordtype">char</span>*) tk_Out);
<a name="l00292"></a>00292                 tk_Out.Reset();
<a name="l00293"></a>00293             }
<a name="l00294"></a>00294             tk_Out.Append(c_Out);
<a name="l00295"></a>00295 
<a name="l00296"></a>00296             <span class="comment">// Additional trace.</span>
<a name="l00297"></a>00297             <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#99fe59fe9cb9e5183b245623c2a240a8">SafeTrace</a>(CLI_WIN_CONSOLE_OUT, *<span class="keyword">this</span>) &lt;&lt; <span class="stringliteral">"("</span> &lt;&lt; (int) c_Out &lt;&lt; <span class="stringliteral">")"</span>;
<a name="l00298"></a>00298         }
<a name="l00299"></a>00299         <span class="comment">// Final display of the buffer.</span>
<a name="l00300"></a>00300         _cputs((<span class="keyword">const</span> <span class="keywordtype">char</span>*) tk_Out);
<a name="l00301"></a>00301         tk_Out.Reset();
<a name="l00302"></a>00302 
<a name="l00303"></a>00303         <span class="comment">// Insure the cursor is visible (reposition in the same place).</span>
<a name="l00304"></a>00304         <span class="keywordflow">do</span>
<a name="l00305"></a>00305         {
<a name="l00306"></a>00306             HANDLE h_Console = ::GetWinConsoleHandle();
<a name="l00307"></a>00307             CONSOLE_SCREEN_BUFFER_INFO t_ScreenBufferInfo;
<a name="l00308"></a>00308             <span class="keywordflow">if</span> (! ::GetConsoleScreenBufferInfo(h_Console, &amp; t_ScreenBufferInfo))
<a name="l00309"></a>00309             {
<a name="l00310"></a>00310                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#99fe59fe9cb9e5183b245623c2a240a8">SafeTrace</a>(CLI_WIN_CONSOLE_OUT, *<span class="keyword">this</span>) &lt;&lt; <span class="stringliteral">"GetConsoleScreenBufferInfo(line="</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">") failed ("</span> &lt;&lt;<a class="code" href="classOutputDevice.html#1049ff5527f478db965a6629ebfd2f00"> ::GetLastError</a>() &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
<a name="l00311"></a>00311                 <span class="keywordflow">break</span>;
<a name="l00312"></a>00312             }
<a name="l00313"></a>00313             <span class="keywordflow">if</span> (! ::SetConsoleCursorPosition(h_Console, t_ScreenBufferInfo.dwCursorPosition))
<a name="l00314"></a>00314             {
<a name="l00315"></a>00315                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#99fe59fe9cb9e5183b245623c2a240a8">SafeTrace</a>(CLI_WIN_CONSOLE_OUT, *<span class="keyword">this</span>) &lt;&lt; <span class="stringliteral">"GetConsoleScreenBufferInfo(line="</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">") failed ("</span> &lt;&lt;<a class="code" href="classOutputDevice.html#1049ff5527f478db965a6629ebfd2f00"> ::GetLastError</a>() &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
<a name="l00316"></a>00316                 <span class="keywordflow">break</span>;
<a name="l00317"></a>00317             }
<a name="l00318"></a>00318         } <span class="keywordflow">while</span>(0);
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 <span class="keywordtype">void</span> <a class="code" href="classConsole.html#a9cf9804f26f522242932889e6e855ac">Console::Beep</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00323"></a>00323 <span class="keyword"></span>{
<a name="l00324"></a>00324     <a class="code" href="classOutputDevice.html#4b4cc34728972042f3a79e5e63178b7b">IODevice::Beep</a>();
<a name="l00325"></a>00325 }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327 <span class="keywordtype">void</span> <a class="code" href="classConsole.html#963ada5699c41613c8875cd7bdd7aa1b">Console::CleanScreen</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00328"></a>00328 <span class="keyword"></span>{
<a name="l00329"></a>00329     <span class="keywordflow">do</span>
<a name="l00330"></a>00330     {
<a name="l00331"></a>00331         <span class="comment">// Retrieve the handle of the console (use stdout).</span>
<a name="l00332"></a>00332         HANDLE h_Console = ::GetWinConsoleHandle();
<a name="l00333"></a>00333 
<a name="l00334"></a>00334         <span class="comment">// Get the number of character cells in the current buffer.</span>
<a name="l00335"></a>00335         CONSOLE_SCREEN_BUFFER_INFO t_ScreenBufferInfo;
<a name="l00336"></a>00336         <span class="keywordflow">if</span> (! ::GetConsoleScreenBufferInfo(h_Console, &amp; t_ScreenBufferInfo))
<a name="l00337"></a>00337         {
<a name="l00338"></a>00338             <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#99fe59fe9cb9e5183b245623c2a240a8">SafeTrace</a>(CLI_WIN_CONSOLE_OUT, *<span class="keyword">this</span>) &lt;&lt; <span class="stringliteral">"GetConsoleScreenBufferInfo(line="</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">") failed ("</span> &lt;&lt;<a class="code" href="classOutputDevice.html#1049ff5527f478db965a6629ebfd2f00"> ::GetLastError</a>() &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
<a name="l00339"></a>00339             <span class="keywordflow">break</span>;
<a name="l00340"></a>00340         }
<a name="l00341"></a>00341         <span class="keyword">const</span> DWORD dw_ConsoleSize = t_ScreenBufferInfo.dwSize.X * t_ScreenBufferInfo.dwSize.Y;
<a name="l00342"></a>00342 
<a name="l00343"></a>00343         <span class="comment">// Fill the entire screen with blanks.</span>
<a name="l00344"></a>00344         <span class="keyword">const</span> COORD t_ZeroCoord = { 0, 0 };
<a name="l00345"></a>00345         DWORD dw_CharsWritten = 0;
<a name="l00346"></a>00346         <span class="keywordflow">if</span> (! ::FillConsoleOutputCharacter(h_Console, (TCHAR) <span class="charliteral">' '</span>, dw_ConsoleSize, t_ZeroCoord, &amp; dw_CharsWritten))
<a name="l00347"></a>00347         {
<a name="l00348"></a>00348             <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#99fe59fe9cb9e5183b245623c2a240a8">SafeTrace</a>(CLI_WIN_CONSOLE_OUT, *<span class="keyword">this</span>) &lt;&lt; <span class="stringliteral">"FillConsoleOutputCharacter(line="</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">") failed ("</span> &lt;&lt;<a class="code" href="classOutputDevice.html#1049ff5527f478db965a6629ebfd2f00"> ::GetLastError</a>() &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
<a name="l00349"></a>00349             <span class="keywordflow">break</span>;
<a name="l00350"></a>00350         }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 <span class="comment">// This part of code seems a little bit strange to me,</span>
<a name="l00353"></a>00353 <span class="comment">// Whatever, it is advised by MSDN. Nevermind then.</span>
<a name="l00354"></a>00354         <span class="comment">// Get the current text attribute.</span>
<a name="l00355"></a>00355         <span class="keywordflow">if</span> (! ::GetConsoleScreenBufferInfo(h_Console, &amp; t_ScreenBufferInfo))
<a name="l00356"></a>00356         {
<a name="l00357"></a>00357             <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#99fe59fe9cb9e5183b245623c2a240a8">SafeTrace</a>(CLI_WIN_CONSOLE_OUT, *<span class="keyword">this</span>) &lt;&lt; <span class="stringliteral">"GetConsoleScreenBufferInfo(line="</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">") failed ("</span> &lt;&lt;<a class="code" href="classOutputDevice.html#1049ff5527f478db965a6629ebfd2f00"> ::GetLastError</a>() &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
<a name="l00358"></a>00358             <span class="keywordflow">break</span>;
<a name="l00359"></a>00359         }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361         <span class="comment">// Now set the buffer's attributes accordingly.</span>
<a name="l00362"></a>00362         <span class="keywordflow">if</span> (! ::FillConsoleOutputAttribute(h_Console, t_ScreenBufferInfo.wAttributes, dw_ConsoleSize, t_ZeroCoord, &amp; dw_CharsWritten))
<a name="l00363"></a>00363         {
<a name="l00364"></a>00364             <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#99fe59fe9cb9e5183b245623c2a240a8">SafeTrace</a>(CLI_WIN_CONSOLE_OUT, *<span class="keyword">this</span>) &lt;&lt; <span class="stringliteral">"FillConsoleOutputAttribute(line="</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">") failed ("</span> &lt;&lt;<a class="code" href="classOutputDevice.html#1049ff5527f478db965a6629ebfd2f00"> ::GetLastError</a>() &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
<a name="l00365"></a>00365             <span class="keywordflow">break</span>;
<a name="l00366"></a>00366         }
<a name="l00367"></a>00367 <span class="comment">// End of strange code</span>
<a name="l00368"></a>00368 
<a name="l00369"></a>00369         <span class="comment">// Put the cursor at (0, 0).</span>
<a name="l00370"></a>00370         <span class="keywordflow">if</span> (! ::SetConsoleCursorPosition(h_Console, t_ZeroCoord))
<a name="l00371"></a>00371         {
<a name="l00372"></a>00372             <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#99fe59fe9cb9e5183b245623c2a240a8">SafeTrace</a>(CLI_WIN_CONSOLE_OUT, *<span class="keyword">this</span>) &lt;&lt; <span class="stringliteral">"SetConsoleCursorPosition(line="</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">") failed ("</span> &lt;&lt;<a class="code" href="classOutputDevice.html#1049ff5527f478db965a6629ebfd2f00"> ::GetLastError</a>() &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
<a name="l00373"></a>00373             <span class="keywordflow">break</span>;
<a name="l00374"></a>00374         }
<a name="l00375"></a>00375 
<a name="l00376"></a>00376         <span class="comment">// Succesful return.</span>
<a name="l00377"></a>00377         <span class="keywordflow">return</span>;
<a name="l00378"></a>00378     } <span class="keywordflow">while</span>(0);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380     <span class="comment">// Fallback to default behaviour.</span>
<a name="l00381"></a>00381     <a class="code" href="classOutputDevice.html#04c4210231e603e0d398698885a9c5de">IODevice::CleanScreen</a>();
<a name="l00382"></a>00382 }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 <span class="keyword">const</span> <a class="code" href="classOutputDevice_1_1ScreenInfo.html">OutputDevice::ScreenInfo</a> <a class="code" href="classConsole.html#246d6e798d44b97ec8ec28495444f385">Console::GetScreenInfo</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00385"></a>00385 <span class="keyword"></span>{
<a name="l00386"></a>00386     <span class="keywordflow">do</span>
<a name="l00387"></a>00387     {
<a name="l00388"></a>00388         <span class="comment">// Retrieve the handle of the console (use stdout).</span>
<a name="l00389"></a>00389         HANDLE h_Console = ::GetWinConsoleHandle();
<a name="l00390"></a>00390 
<a name="l00391"></a>00391         <span class="comment">// Get the number of character cells in the current buffer.</span>
<a name="l00392"></a>00392         CONSOLE_SCREEN_BUFFER_INFO t_ScreenBufferInfo;
<a name="l00393"></a>00393         <span class="keywordflow">if</span> (! ::GetConsoleScreenBufferInfo(h_Console, &amp; t_ScreenBufferInfo))
<a name="l00394"></a>00394         {
<a name="l00395"></a>00395             <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#99fe59fe9cb9e5183b245623c2a240a8">SafeTrace</a>(CLI_WIN_CONSOLE_OUT, *<span class="keyword">this</span>) &lt;&lt; <span class="stringliteral">"GetConsoleScreenBufferInfo(line="</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">") failed ("</span> &lt;&lt;<a class="code" href="classOutputDevice.html#1049ff5527f478db965a6629ebfd2f00"> ::GetLastError</a>() &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
<a name="l00396"></a>00396             <span class="keywordflow">break</span>;
<a name="l00397"></a>00397         }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399         DWORD dw_Mode = 0;
<a name="l00400"></a>00400         <span class="keywordflow">if</span> (! ::GetConsoleMode(h_Console, &amp; dw_Mode))
<a name="l00401"></a>00401         {
<a name="l00402"></a>00402             <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9">GetTraces</a>().<a class="code" href="classTraces.html#99fe59fe9cb9e5183b245623c2a240a8">SafeTrace</a>(CLI_WIN_CONSOLE_OUT, *<span class="keyword">this</span>) &lt;&lt; <span class="stringliteral">"GetConsoleMode(line="</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">") failed ("</span> &lt;&lt;<a class="code" href="classOutputDevice.html#1049ff5527f478db965a6629ebfd2f00"> ::GetLastError</a>() &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
<a name="l00403"></a>00403             <span class="keywordflow">break</span>;
<a name="l00404"></a>00404         }
<a name="l00405"></a>00405 
<a name="l00406"></a>00406         <span class="comment">// Succesful return.</span>
<a name="l00407"></a>00407         <span class="keywordflow">return</span> ScreenInfo(
<a name="l00408"></a>00408             t_ScreenBufferInfo.srWindow.Right - t_ScreenBufferInfo.srWindow.Left + 1,
<a name="l00409"></a>00409             t_ScreenBufferInfo.srWindow.Bottom - t_ScreenBufferInfo.srWindow.Top + 1,
<a name="l00410"></a>00410             <span class="keyword">true</span>,                                       <span class="comment">// True Cls (if this line is reached, it means CleanScreen would succeed)</span>
<a name="l00411"></a>00411             (dw_Mode &amp; ENABLE_WRAP_AT_EOL_OUTPUT) != 0  <span class="comment">// Line wrapping</span>
<a name="l00412"></a>00412         );
<a name="l00413"></a>00413     } <span class="keywordflow">while</span>(0);
<a name="l00414"></a>00414 
<a name="l00415"></a>00415     <span class="comment">// Fallback to default behaviour.</span>
<a name="l00416"></a>00416     <span class="keywordflow">return</span> <a class="code" href="classOutputDevice.html#3cec03b49e12d20ee63f5ca9037f67da">IODevice::GetScreenInfo</a>();
<a name="l00417"></a>00417 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Dec 12 23:20:28 2011 for CLI by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
