<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>zlomekFS: version.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul>
</div>
<div class="nav">
<a class="el" href="dir_21c430ab3b7001ae39034eae6f7edf71.html">zfsd</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_ac94841c51e61ddc7acc56e12a771012.html">backup</a></div>
<h1>backup/version.c File Reference</h1>Functions for file versioning. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="backup_2system_8h-source.html">system.h</a>&quot;</code><br>
<code>#include &lt;errno.h&gt;</code><br>
<code>#include &lt;sys/types.h&gt;</code><br>
<code>#include &lt;sys/stat.h&gt;</code><br>
<code>#include &lt;unistd.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;time.h&gt;</code><br>
<code>#include &lt;libgen.h&gt;</code><br>
<code>#include &lt;syscall.h&gt;</code><br>
<code>#include &lt;dirent.h&gt;</code><br>
<code>#include &quot;<a class="el" href="backup_2fh_8h-source.html">fh.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="backup_2log_8h-source.html">log.h</a>&quot;</code><br>
<code>#include &quot;utime.h&quot;</code><br>
<code>#include &quot;<a class="el" href="backup_2dir_8h-source.html">dir.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="backup_2user-group_8h-source.html">user-group.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="backup_2memory_8h-source.html">memory.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="backup_2metadata_8h-source.html">metadata.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="backup_2version_8h-source.html">version.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="backup_2update_8h-source.html">update.h</a>&quot;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#429ab720a4dc9392cf60742312797ef5">DIRHTAB_HASH</a>(N)&nbsp;&nbsp;&nbsp;(crc32_string((N)-&gt;name))</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#878421eaec2cf39085c5b2e3f12ef885">GET_STAMP_PART</a>(BUF, L, PART, S, E, X)</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="hashtab_8h.html#fb05a131363b0de134535fc5f7b01dc0">hash_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#8fe159bd83bc1ed5630ef5b8bf79df21">dirhtab_hash</a> (const void *x)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Generate hash for dirtab item.  <a href="#8fe159bd83bc1ed5630ef5b8bf79df21"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#20f5626ce1db83d9e2928e6eef5b1d39">dirhtab_eq</a> (const void *x, const void *y)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Compare two dirtab items.  <a href="#20f5626ce1db83d9e2928e6eef5b1d39"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#df172a21133fe235583112f00a7e9add">dirhtab_del</a> (void *x)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete item from the dirtab hash table.  <a href="#df172a21133fe235583112f00a7e9add"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#60fd758a3b42263df6bdcc5acbcab6c0">version_create_dirhtab</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepare hash table before readdir.  <a href="#60fd758a3b42263df6bdcc5acbcab6c0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#1ec9543b68d1bd8fadbd12ef7eb8a41a">version_readdir_from_dirhtab</a> (<a class="el" href="structdir__list__def.html">dir_list</a> *list, <a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, int32_t cookie, <a class="el" href="structreaddir__data__def.html">readdir_data</a> *data, <a class="el" href="file_8h.html#21c41dfd55f14bdf17612a0db1329e40">filldir_f</a> filldir)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return versions during readdir.  <a href="#1ec9543b68d1bd8fadbd12ef7eb8a41a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#e83190f2888f0e8336d03440d85d63cc">version_readdir_fill_dirhtab</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, time_t stamp, long ino, char *name)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Store version during readdir.  <a href="#e83190f2888f0e8336d03440d85d63cc"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#d8ecf64e5909d7db552836d9cfccb2b3">version_build_interval_path</a> (<a class="el" href="structstring__def.html">string</a> *path, <a class="el" href="structinternal__fh__def.html">internal_fh</a> fh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create interval file name.  <a href="#d8ecf64e5909d7db552836d9cfccb2b3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#4df352ea352d9e9d714d1df7ebb1d21a">version_load_interval_tree</a> (<a class="el" href="structinternal__fh__def.html">internal_fh</a> fh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Load interval file.  <a href="#4df352ea352d9e9d714d1df7ebb1d21a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#7bf2874e1efd3d3ecf1062af630e25b9">version_save_interval_trees</a> (<a class="el" href="structinternal__fh__def.html">internal_fh</a> fh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write interval file.  <a href="#7bf2874e1efd3d3ecf1062af630e25b9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#0dce2b68fd0c66a4f4132b14f8695794">version_generate_filename</a> (char *path, <a class="el" href="structstring__def.html">string</a> *verpath)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Generate file version specifier.  <a href="#0dce2b68fd0c66a4f4132b14f8695794"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#949743388120751c0d579863072fd0e0">version_create_file_with_attr</a> (char *path, <a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, <a class="el" href="structvolume__def.html">volume</a> vol, bool with_size)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create version file.  <a href="#949743388120751c0d579863072fd0e0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#7641c0cd39322559b8b09468b766b1d8">version_create_file</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, <a class="el" href="structvolume__def.html">volume</a> vol)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Open version file.  <a href="#7641c0cd39322559b8b09468b766b1d8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#e10275ada93a6b3e09048e6fbf845b60">version_close_file</a> (<a class="el" href="structinternal__fh__def.html">internal_fh</a> fh, bool tidy)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Close version file.  <a href="#e10275ada93a6b3e09048e6fbf845b60"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#95521fdf0d0f9b2354aa7d2a6781a830">version_truncate_file</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, <a class="el" href="structvolume__def.html">volume</a> vol, char *path)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Perform file truncate with versioning.  <a href="#95521fdf0d0f9b2354aa7d2a6781a830"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#a458ef1d4b39cfe1ef2f950317ba2f53">version_unlink_file</a> (char *path)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Perform file unlink with versioning.  <a href="#a458ef1d4b39cfe1ef2f950317ba2f53"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#965711d5b59c765766f0bf9511a1f969">version_browse_dir</a> (char *path, char *name, time_t *stamp, uint32_t *ino, <a class="el" href="structvarray__def.html">varray</a> *v)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find version files for specified time stamp.  <a href="#965711d5b59c765766f0bf9511a1f969"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#a89560800011f5ee34c971ed4f11aa7f">version_find_version</a> (char *dir, <a class="el" href="structstring__def.html">string</a> *name, time_t stamp)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find first newer version.  <a href="#a89560800011f5ee34c971ed4f11aa7f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#c251b6d08a805666f18a2e3fb79d1c21">version_get_filename_stamp</a> (char *name, time_t *stamp, int *orgnamelen)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Parse version suffix (datetime format).  <a href="#c251b6d08a805666f18a2e3fb79d1c21"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#b95038ebcf476953b73394e94ebcb8b7">version_retr_stamp</a> (char *name, time_t *stamp)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return version time stamp (Unix time).  <a href="#b95038ebcf476953b73394e94ebcb8b7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#9f2cb81a7688d1c80dfa9bb716f9882b">version_is_directory</a> (<a class="el" href="structstring__def.html">string</a> *dst, char *dir, <a class="el" href="structstring__def.html">string</a> *name, time_t stamp, time_t *dirstamp, int orgnamelen)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if working with directory.  <a href="#9f2cb81a7688d1c80dfa9bb716f9882b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#3c7228eb8993b3f592c1cf5eadbea4f0">comp_version_items</a> (const void *i1, const void *i2)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Compare.  <a href="#3c7228eb8993b3f592c1cf5eadbea4f0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#22033f52d51e6198148b8ba0ea180db7">version_build_intervals</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, <a class="el" href="structvolume__def.html">volume</a> vol)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create list of intervals for a file version.  <a href="#22033f52d51e6198148b8ba0ea180db7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#83c80ca1109f9a7ee36533dbb424b396">version_read_old_data</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, uint64_t start, uint64_t end, char *buf)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read data from the version file. It uses intervals build during open.  <a href="#83c80ca1109f9a7ee36533dbb424b396"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#894feb0c415ebcec749917764296d069">version_rename_source</a> (char *path)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create version during rename.  <a href="#894feb0c415ebcec749917764296d069"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#5b49a2ab3eda266795ee3b0425f53f6a">version_unlink_version_file</a> (char *path)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete version file.  <a href="#5b49a2ab3eda266795ee3b0425f53f6a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#30cbb86ae0cee5ac735430605cb0cc77">version_retent_file</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dir, <a class="el" href="structvolume__def.html">volume</a> vol, char *name)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete version file.  <a href="#30cbb86ae0cee5ac735430605cb0cc77"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#48d0714f5009e4ef62020aae53a20634">version_copy_data</a> (int fd, int fdv, uint64_t offset, uint32_t length, <a class="el" href="structdata__buffer__def.html">data_buffer</a> *newdata)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Copy data into version file.  <a href="#48d0714f5009e4ef62020aae53a20634"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#36ab31eaf0448f4240d4ec7cdf9fe618">version_rmdir_versions</a> (char *path)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove all version files from a directory.  <a href="#36ab31eaf0448f4240d4ec7cdf9fe618"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="backup_2version_8c.html#2818bf4652385ca77a43f3b7c00828bd">version_apply_retention</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, <a class="el" href="structvolume__def.html">volume</a> vol)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Functions for file versioning. 
<p>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="429ab720a4dc9392cf60742312797ef5"></a><!-- doxytag: member="backup/version.c::DIRHTAB_HASH" ref="429ab720a4dc9392cf60742312797ef5" args="(N)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DIRHTAB_HASH          </td>
          <td>(</td>
          <td class="paramtype">N&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">&nbsp;&nbsp;&nbsp;(crc32_string((N)-&gt;name))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Hash function for file name. 
</div>
</div><p>
<a class="anchor" name="878421eaec2cf39085c5b2e3f12ef885"></a><!-- doxytag: member="backup/version.c::GET_STAMP_PART" ref="878421eaec2cf39085c5b2e3f12ef885" args="(BUF, L, PART, S, E, X)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GET_STAMP_PART          </td>
          <td>(</td>
          <td class="paramtype">BUF,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">L,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PART,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">S,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">E,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">X&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">if</span> (L &gt; S) \
    { \
      <span class="keywordflow">if</span> ((L &gt; E) &amp;&amp; (BUF[E] != <span class="charliteral">'-'</span>)) <a class="code" href="backup_2log_8h.html#13410c0460f46fd7ab15cbefc8c43060">RETURN_INT</a> (ENOENT); \
      buf[E] = <span class="charliteral">'\0'</span>; \
      PART = atoi (BUF + S) + X; \
    }
</pre></div>Return part of the timestamp string. 
</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="3c7228eb8993b3f592c1cf5eadbea4f0"></a><!-- doxytag: member="backup/version.c::comp_version_items" ref="3c7228eb8993b3f592c1cf5eadbea4f0" args="(const void *i1, const void *i2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int comp_version_items           </td>
          <td>(</td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>i1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>i2</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Compare. 
<p>
Compare two version items. Function is used by Q-sort in version_build_intervals.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>i1</em>&nbsp;</td><td>First item </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>i2</em>&nbsp;</td><td>Second item</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>or 1 depending on which item has lower time stamp</td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="structversion__item__def.html">version_item_def</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="df172a21133fe235583112f00a7e9add"></a><!-- doxytag: member="backup/version.c::dirhtab_del" ref="df172a21133fe235583112f00a7e9add" args="(void *x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirhtab_del           </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>x</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Delete item from the dirtab hash table. 
<p>
Delete item from the hash table.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>x</em>&nbsp;</td><td>Item to delete</td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd>dirtab_item_def </dd></dl>

</div>
</div><p>
<a class="anchor" name="20f5626ce1db83d9e2928e6eef5b1d39"></a><!-- doxytag: member="backup/version.c::dirhtab_eq" ref="20f5626ce1db83d9e2928e6eef5b1d39" args="(const void *x, const void *y)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirhtab_eq           </td>
          <td>(</td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>y</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Compare two dirtab items. 
<p>
Compare two dirtab items.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>x</em>&nbsp;</td><td>First item </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>y</em>&nbsp;</td><td>Second item</td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd>dirtab_item_def </dd></dl>

</div>
</div><p>
<a class="anchor" name="8fe159bd83bc1ed5630ef5b8bf79df21"></a><!-- doxytag: member="backup/version.c::dirhtab_hash" ref="8fe159bd83bc1ed5630ef5b8bf79df21" args="(const void *x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="hashtab_8h.html#fb05a131363b0de134535fc5f7b01dc0">hash_t</a> dirhtab_hash           </td>
          <td>(</td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>x</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Generate hash for dirtab item. 
<p>
Generate hash for dirtab item.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>x</em>&nbsp;</td><td>Item to hash</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hashed</em>&nbsp;</td><td>value</td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd>dirtab_item_def </dd></dl>

</div>
</div><p>
<a class="anchor" name="2818bf4652385ca77a43f3b7c00828bd"></a><!-- doxytag: member="backup/version.c::version_apply_retention" ref="2818bf4652385ca77a43f3b7c00828bd" args="(internal_dentry dentry, volume vol)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_apply_retention           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="965711d5b59c765766f0bf9511a1f969"></a><!-- doxytag: member="backup/version.c::version_browse_dir" ref="965711d5b59c765766f0bf9511a1f969" args="(char *path, char *name, time_t *stamp, uint32_t *ino, varray *v)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_browse_dir           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t *&nbsp;</td>
          <td class="paramname"> <em>stamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&nbsp;</td>
          <td class="paramname"> <em>ino</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvarray__def.html">varray</a> *&nbsp;</td>
          <td class="paramname"> <em>v</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Find version files for specified time stamp. 
<p>
Find version files that contain data for the specified time stamp, i.e. all newer version files that combined together cover the whole file.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>Complete path of the directory </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>Name of the file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>stamp</em>&nbsp;</td><td>Time stamp of the moment in time </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>ino</em>&nbsp;</td><td>Inode of the first newer version file </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>v</em>&nbsp;</td><td>varray filled with list of versions</td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="structversion__item__def.html">version_item_def</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="d8ecf64e5909d7db552836d9cfccb2b3"></a><!-- doxytag: member="backup/version.c::version_build_interval_path" ref="d8ecf64e5909d7db552836d9cfccb2b3" args="(string *path, internal_fh fh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void version_build_interval_path           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structstring__def.html">string</a> *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinternal__fh__def.html">internal_fh</a>&nbsp;</td>
          <td class="paramname"> <em>fh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create interval file name. 
<p>
Create interval file name.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>path</em>&nbsp;</td><td>Complete path of the interval file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fh</em>&nbsp;</td><td>Internal file handle </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="22033f52d51e6198148b8ba0ea180db7"></a><!-- doxytag: member="backup/version.c::version_build_intervals" ref="22033f52d51e6198148b8ba0ea180db7" args="(internal_dentry dentry, volume vol)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_build_intervals           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create list of intervals for a file version. 
<p>
Create list of intervals together with version files these intervals are stored in that create the whole content of a file version. List is created from interval files during file open. Result is stored in the internal file handle.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dentry</em>&nbsp;</td><td>Dentry of the file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>vol</em>&nbsp;</td><td>Volume the file in on </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="e10275ada93a6b3e09048e6fbf845b60"></a><!-- doxytag: member="backup/version.c::version_close_file" ref="e10275ada93a6b3e09048e6fbf845b60" args="(internal_fh fh, bool tidy)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_close_file           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__fh__def.html">internal_fh</a>&nbsp;</td>
          <td class="paramname"> <em>fh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>tidy</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Close version file. 
<p>
Close version file of the specified current file.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fh</em>&nbsp;</td><td>Internal file handle of the file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tidy</em>&nbsp;</td><td>Whether the function should make the version file sparse. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="48d0714f5009e4ef62020aae53a20634"></a><!-- doxytag: member="backup/version.c::version_copy_data" ref="48d0714f5009e4ef62020aae53a20634" args="(int fd, int fdv, uint64_t offset, uint32_t length, data_buffer *newdata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_copy_data           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fdv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdata__buffer__def.html">data_buffer</a> *&nbsp;</td>
          <td class="paramname"> <em>newdata</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Copy data into version file. 
<p>
Copy data from current file to version file. Copy only part of the file and only when it differs from the data to be written.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fd</em>&nbsp;</td><td>File descriptor of current file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fdv</em>&nbsp;</td><td>File descriptor of version file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>offset</em>&nbsp;</td><td>Start of data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>length</em>&nbsp;</td><td>Length of data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>newdata</em>&nbsp;</td><td>Buffer with data to be written (to compare it only, no write) </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="60fd758a3b42263df6bdcc5acbcab6c0"></a><!-- doxytag: member="backup/version.c::version_create_dirhtab" ref="60fd758a3b42263df6bdcc5acbcab6c0" args="(internal_dentry dentry)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void version_create_dirhtab           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Prepare hash table before readdir. 
<p>
Prepare hash table before readdir.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dentry</em>&nbsp;</td><td>Dentry of the directory </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="7641c0cd39322559b8b09468b766b1d8"></a><!-- doxytag: member="backup/version.c::version_create_file" ref="7641c0cd39322559b8b09468b766b1d8" args="(internal_dentry dentry, volume vol)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_create_file           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Open version file. 
<p>
Open version file for specified current file. If the appropriate version already exists, it is opened. New version file is created otherwise.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>denty</em>&nbsp;</td><td>Dentry of the file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>vol</em>&nbsp;</td><td>Volume of the file </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="949743388120751c0d579863072fd0e0"></a><!-- doxytag: member="backup/version.c::version_create_file_with_attr" ref="949743388120751c0d579863072fd0e0" args="(char *path, internal_dentry dentry, volume vol, bool with_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_create_file_with_attr           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>with_size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create version file. 
<p>
Create version file based on the current file attributes.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>Complete file path </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dentry</em>&nbsp;</td><td>Dentry of the file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>with_size</em>&nbsp;</td><td>Whether version file should be enlarged to the size of the current file </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="a89560800011f5ee34c971ed4f11aa7f"></a><!-- doxytag: member="backup/version.c::version_find_version" ref="a89560800011f5ee34c971ed4f11aa7f" args="(char *dir, string *name, time_t stamp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_find_version           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structstring__def.html">string</a> *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&nbsp;</td>
          <td class="paramname"> <em>stamp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Find first newer version. 
<p>
Find oldest version of the file that is newer than the specified time stamp.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dir</em>&nbsp;</td><td>Complete path of the directory </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>name</em>&nbsp;</td><td>File name; contains version suffix on return </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>stamp</em>&nbsp;</td><td>Time stamp </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="0dce2b68fd0c66a4f4132b14f8695794"></a><!-- doxytag: member="backup/version.c::version_generate_filename" ref="0dce2b68fd0c66a4f4132b14f8695794" args="(char *path, string *verpath)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_generate_filename           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structstring__def.html">string</a> *&nbsp;</td>
          <td class="paramname"> <em>verpath</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Generate file version specifier. 
<p>
Add a version suffix to the specified file path. Suffix is generated from the current time.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>Complete file path. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>verpath</em>&nbsp;</td><td>Complete file path including a version suffix. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="c251b6d08a805666f18a2e3fb79d1c21"></a><!-- doxytag: member="backup/version.c::version_get_filename_stamp" ref="c251b6d08a805666f18a2e3fb79d1c21" args="(char *name, time_t *stamp, int *orgnamelen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_get_filename_stamp           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t *&nbsp;</td>
          <td class="paramname"> <em>stamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>orgnamelen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Parse version suffix (datetime format). 
<p>
Parse time stamp version suffix from the file name. Function expects yyyy-mm-dd-hh-mm-ss format.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>File name with a version suffix </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>stamp</em>&nbsp;</td><td>Time stamp from the suffix </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>ornamelen</em>&nbsp;</td><td>Length of the file name without the version suffix</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ZFS_OK</em>&nbsp;</td><td>Version suffix was successfully parsed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ENOENT</em>&nbsp;</td><td>version suffix is not correct </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="9f2cb81a7688d1c80dfa9bb716f9882b"></a><!-- doxytag: member="backup/version.c::version_is_directory" ref="9f2cb81a7688d1c80dfa9bb716f9882b" args="(string *dst, char *dir, string *name, time_t stamp, time_t *dirstamp, int orgnamelen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_is_directory           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structstring__def.html">string</a> *&nbsp;</td>
          <td class="paramname"> <em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structstring__def.html">string</a> *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&nbsp;</td>
          <td class="paramname"> <em>stamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t *&nbsp;</td>
          <td class="paramname"> <em>dirstamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>orgnamelen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Check if working with directory. 
<p>
Check whether name is a directory.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>dst</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dir</em>&nbsp;</td><td>Parent directory name </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>name</em>&nbsp;</td><td>Child file/directory name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>stamp</em>&nbsp;</td><td>Time stamp applied to the parent directory </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ornamelen</em>&nbsp;</td><td>Length of the child file/directory name without the version suffix</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ZFS_OK</em>&nbsp;</td><td>Child is a directory; dst is filled in and name suffix is truncated </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ENOENT</em>&nbsp;</td><td>Child in not a directory </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="4df352ea352d9e9d714d1df7ebb1d21a"></a><!-- doxytag: member="backup/version.c::version_load_interval_tree" ref="4df352ea352d9e9d714d1df7ebb1d21a" args="(internal_fh fh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool version_load_interval_tree           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__fh__def.html">internal_fh</a>&nbsp;</td>
          <td class="paramname"> <em>fh</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Load interval file. 
<p>
Load interval file.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fh</em>&nbsp;</td><td>Internal file handle </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="83c80ca1109f9a7ee36533dbb424b396"></a><!-- doxytag: member="backup/version.c::version_read_old_data" ref="83c80ca1109f9a7ee36533dbb424b396" args="(internal_dentry dentry, uint64_t start, uint64_t end, char *buf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_read_old_data           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read data from the version file. It uses intervals build during open. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dentry</em>&nbsp;</td><td>Dentry of the file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>start</em>&nbsp;</td><td>Start of data interval </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>end</em>&nbsp;</td><td>End of data interval </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>buf</em>&nbsp;</td><td>Buffer to store the data</td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="version_8h.html#22033f52d51e6198148b8ba0ea180db7" title="Create list of intervals for a file version.">version_build_intervals</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="e83190f2888f0e8336d03440d85d63cc"></a><!-- doxytag: member="backup/version.c::version_readdir_fill_dirhtab" ref="e83190f2888f0e8336d03440d85d63cc" args="(internal_dentry dentry, time_t stamp, long ino, char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_readdir_fill_dirhtab           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&nbsp;</td>
          <td class="paramname"> <em>stamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&nbsp;</td>
          <td class="paramname"> <em>ino</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Store version during readdir. 
<p>
Store version file information into a hash table associated with the dentry. It is called during readdir to find newest version for every versioned file.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dentry</em>&nbsp;</td><td>Directory dentry </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>stamp</em>&nbsp;</td><td>Version time stamp </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ino</em>&nbsp;</td><td>Inode number of the version file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>File name </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="1ec9543b68d1bd8fadbd12ef7eb8a41a"></a><!-- doxytag: member="backup/version.c::version_readdir_from_dirhtab" ref="1ec9543b68d1bd8fadbd12ef7eb8a41a" args="(dir_list *list, internal_dentry dentry, int32_t cookie, readdir_data *data, filldir_f filldir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_readdir_from_dirhtab           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdir__list__def.html">dir_list</a> *&nbsp;</td>
          <td class="paramname"> <em>list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&nbsp;</td>
          <td class="paramname"> <em>cookie</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structreaddir__data__def.html">readdir_data</a> *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="file_8h.html#21c41dfd55f14bdf17612a0db1329e40">filldir_f</a>&nbsp;</td>
          <td class="paramname"> <em>filldir</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return versions during readdir. 
<p>
Return version file names for the hash table during readdir. Hash table is first filled in by version_readdir_fill_dirhtab. All parameters are taken from readdir call.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>list</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dentry</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cookie</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>filldir</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="version_8h.html#1ec9543b68d1bd8fadbd12ef7eb8a41a" title="Return versions during readdir.">version_readdir_from_dirhtab</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="894feb0c415ebcec749917764296d069"></a><!-- doxytag: member="backup/version.c::version_rename_source" ref="894feb0c415ebcec749917764296d069" args="(char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_rename_source           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create version during rename. 
<p>
Create version file during file rename.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>Complete path of the file </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="30cbb86ae0cee5ac735430605cb0cc77"></a><!-- doxytag: member="backup/version.c::version_retent_file" ref="30cbb86ae0cee5ac735430605cb0cc77" args="(internal_dentry dir, volume vol, char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool version_retent_file           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Delete version file. 
<p>
Delete version file and its respective interval file.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dir</em>&nbsp;</td><td>Dentry of the directory the file is in </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>vol</em>&nbsp;</td><td>Volume the file is on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>Name of the file </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="b95038ebcf476953b73394e94ebcb8b7"></a><!-- doxytag: member="backup/version.c::version_retr_stamp" ref="b95038ebcf476953b73394e94ebcb8b7" args="(char *name, time_t *stamp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_retr_stamp           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t *&nbsp;</td>
          <td class="paramname"> <em>stamp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return version time stamp (Unix time). 
<p>
Return time stamp from version file name. Function expects Unix time suffix.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>File name </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>stamp</em>&nbsp;</td><td>Time stamp value</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ZFS_OK</em>&nbsp;</td><td>Valid time stamp specified </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ENOENT</em>&nbsp;</td><td>Invalid time stamp </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="36ab31eaf0448f4240d4ec7cdf9fe618"></a><!-- doxytag: member="backup/version.c::version_rmdir_versions" ref="36ab31eaf0448f4240d4ec7cdf9fe618" args="(char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_rmdir_versions           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Remove all version files from a directory. 
<p>
Remove all version files from specified directory. This function is called from rmdir operations to make sure all files are deleted even version files are not displayed. Works correctly only if there are no other files but versions.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>Complete path to the directory </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="7bf2874e1efd3d3ecf1062af630e25b9"></a><!-- doxytag: member="backup/version.c::version_save_interval_trees" ref="7bf2874e1efd3d3ecf1062af630e25b9" args="(internal_fh fh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool version_save_interval_trees           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__fh__def.html">internal_fh</a>&nbsp;</td>
          <td class="paramname"> <em>fh</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Write interval file. 
<p>
Write interval file for the version associated with the current file.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fh</em>&nbsp;</td><td>Internal file handle </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="95521fdf0d0f9b2354aa7d2a6781a830"></a><!-- doxytag: member="backup/version.c::version_truncate_file" ref="95521fdf0d0f9b2354aa7d2a6781a830" args="(internal_dentry dentry, volume vol, char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_truncate_file           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Perform file truncate with versioning. 
<p>
Perform file truncate, i.e. rename current file to the version file and create new current file.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dentry</em>&nbsp;</td><td>Dentry of the file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>Complete path of the file </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="a458ef1d4b39cfe1ef2f950317ba2f53"></a><!-- doxytag: member="backup/version.c::version_unlink_file" ref="a458ef1d4b39cfe1ef2f950317ba2f53" args="(char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_unlink_file           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Perform file unlink with versioning. 
<p>
Perform file unlink, i.e. rename current file to the version file.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>Complete path of the file </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="5b49a2ab3eda266795ee3b0425f53f6a"></a><!-- doxytag: member="backup/version.c::version_unlink_version_file" ref="5b49a2ab3eda266795ee3b0425f53f6a" args="(char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_unlink_version_file           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Delete version file. 
<p>
Delete version file and its respective interval file.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>Complete path of the file </td></tr>
  </table>
</dl>

</div>
</div><p>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Aug 6 00:37:42 2010 for zlomekFS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
