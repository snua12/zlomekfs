<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>zlomekFS: volume.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul>
</div>
<div class="nav">
<a class="el" href="dir_21c430ab3b7001ae39034eae6f7edf71.html">zfsd</a></div>
<h1>volume.h</h1><a href="volume_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00004"></a>00004 <span class="comment">/* Copyright (C) 2003, 2004 Josef Zlomek</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">   This file is part of ZFS.</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">   ZFS is free software; you can redistribute it and/or modify it</span>
<a name="l00009"></a>00009 <span class="comment">   under the terms of the GNU General Public License as published by</span>
<a name="l00010"></a>00010 <span class="comment">   the Free Software Foundation; either version 2, or (at your option)</span>
<a name="l00011"></a>00011 <span class="comment">   any later version.</span>
<a name="l00012"></a>00012 <span class="comment"></span>
<a name="l00013"></a>00013 <span class="comment">   ZFS is distributed in the hope that it will be useful, but WITHOUT</span>
<a name="l00014"></a>00014 <span class="comment">   ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
<a name="l00015"></a>00015 <span class="comment">   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public</span>
<a name="l00016"></a>00016 <span class="comment">   License for more details.</span>
<a name="l00017"></a>00017 <span class="comment"></span>
<a name="l00018"></a>00018 <span class="comment">   You should have received a copy of the GNU General Public License along with</span>
<a name="l00019"></a>00019 <span class="comment">   ZFS; see the file COPYING.  If not, write to the Free Software Foundation,</span>
<a name="l00020"></a>00020 <span class="comment">   59 Temple Place - Suite 330, Boston, MA 02111-1307, USA;</span>
<a name="l00021"></a>00021 <span class="comment">   or download it from http://www.gnu.org/licenses/gpl.html */</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#ifndef VOLUME_H</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span><span class="preprocessor">#define VOLUME_H</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span>
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="system_8h.html" title="Environment definitions.">system.h</a>"</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;inttypes.h&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include "<a class="code" href="pthread-wrapper_8h.html" title="Wrappers for pthread_* functions and related data.">pthread-wrapper.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include "<a class="code" href="hashtab_8h.html" title="An expandable hash tables datatype.">hashtab.h</a>"</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include "<a class="code" href="hashfile_8h.html" title="An expandable hash table in a file.">hashfile.h</a>"</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include "<a class="code" href="fh_8h.html" title="File handle functions.">fh.h</a>"</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include "<a class="code" href="node_8h.html" title="Node functions.">node.h</a>"</span>
<a name="l00033"></a>00033 
<a name="l00035"></a><a class="code" href="volume_8h.html#6ad056ee4726ec77cf93c498119758c1">00035</a> <span class="preprocessor">#define MARK_VOLUME_DELETE(VOL) (VOL)-&gt;delete_p = true</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>
<a name="l00038"></a><a class="code" href="structvolume__def.html">00038</a> <span class="keyword">struct </span><a class="code" href="structvolume__def.html" title="Volume description.">volume_def</a>
<a name="l00039"></a>00039 {
<a name="l00040"></a>00040 <span class="preprocessor">#ifdef ENABLE_CHECKING</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>  <span class="keywordtype">long</span> unused0;
<a name="l00042"></a>00042   <span class="keywordtype">long</span> unused1;
<a name="l00043"></a>00043 <span class="preprocessor">#endif</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span>
<a name="l00045"></a><a class="code" href="structvolume__def.html#8e75260345b483294ff7d348b10c1042">00045</a>   pthread_mutex_t <a class="code" href="structvolume__def.html#8e75260345b483294ff7d348b10c1042">mutex</a>;
<a name="l00046"></a><a class="code" href="structvolume__def.html#96077d28f02a0db3ee47da6d43531595">00046</a>   uint32_t <a class="code" href="structvolume__def.html#96077d28f02a0db3ee47da6d43531595">id</a>;                  
<a name="l00047"></a><a class="code" href="structvolume__def.html#e212dcec0ea85681fb6bb7757ce9ba1c">00047</a>   <a class="code" href="structnode__def.html" title="Node description.">node</a> <a class="code" href="structvolume__def.html#e212dcec0ea85681fb6bb7757ce9ba1c">master</a>;                  
<a name="l00048"></a><a class="code" href="structvolume__def.html#528820942ebb161bd301e2495f07ca1c">00048</a>   <a class="code" href="structhtab__def.html" title="Hash table datatype.">htab_t</a> <a class="code" href="structvolume__def.html#528820942ebb161bd301e2495f07ca1c">slaves</a>;                
<a name="l00049"></a><a class="code" href="structvolume__def.html#b810ada25641e046cebeaf16fffe27cb">00049</a>   <span class="keywordtype">string</span> <a class="code" href="structvolume__def.html#b810ada25641e046cebeaf16fffe27cb">name</a>;                  
<a name="l00050"></a><a class="code" href="structvolume__def.html#6923e0c4dec2cc02fd1d934600c24053">00050</a>   <span class="keywordtype">string</span> <a class="code" href="structvolume__def.html#6923e0c4dec2cc02fd1d934600c24053">mountpoint</a>;            
<a name="l00052"></a><a class="code" href="structvolume__def.html#732cfabd492ac589e0d1d5ba28022149">00052</a>   <span class="keywordtype">bool</span> <a class="code" href="structvolume__def.html#732cfabd492ac589e0d1d5ba28022149">delete_p</a>;                
<a name="l00053"></a><a class="code" href="structvolume__def.html#0a697b29537a1890e624c3d10a1942d7">00053</a>   <span class="keywordtype">bool</span> <a class="code" href="structvolume__def.html#0a697b29537a1890e624c3d10a1942d7">marked</a>;                  
<a name="l00054"></a><a class="code" href="structvolume__def.html#1c9bce6573426af6d573374ccd8c858a">00054</a>   <span class="keywordtype">bool</span> <a class="code" href="structvolume__def.html#1c9bce6573426af6d573374ccd8c858a">is_copy</a>;                 
<a name="l00055"></a><a class="code" href="structvolume__def.html#e18946e2cfa778965f969145e17ccb3d">00055</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structvolume__def.html#e18946e2cfa778965f969145e17ccb3d">n_locked_fhs</a>;    
<a name="l00057"></a><a class="code" href="structvolume__def.html#11d8e4474a5415e62518b5a8e598918d">00057</a>   <span class="keywordtype">string</span> <a class="code" href="structvolume__def.html#11d8e4474a5415e62518b5a8e598918d">local_path</a>;            
<a name="l00058"></a><a class="code" href="structvolume__def.html#77f8d6c6dddea5bd14ff8c240991b10b">00058</a>   uint64_t <a class="code" href="structvolume__def.html#77f8d6c6dddea5bd14ff8c240991b10b">size_limit</a>;          
<a name="l00060"></a><a class="code" href="structvolume__def.html#eab57994c1549b0fe6c74461f2bb3573">00060</a>   uint32_t <a class="code" href="structvolume__def.html#eab57994c1549b0fe6c74461f2bb3573">last_conflict_ino</a>;   
<a name="l00062"></a><a class="code" href="structvolume__def.html#7b3333cbe48f17e982d2b83f965317ae">00062</a>   <a class="code" href="structinternal__dentry__def.html" title="Internal directory entry.">internal_dentry</a> <a class="code" href="structvolume__def.html#7b3333cbe48f17e982d2b83f965317ae">root_dentry</a>;  
<a name="l00063"></a><a class="code" href="structvolume__def.html#2349c53f0da1696d96c5ce2511d367da">00063</a>   <a class="code" href="structvirtual__dir__def.html" title="Virtual directory (element of mount tree).">virtual_dir</a> <a class="code" href="structvolume__def.html#2349c53f0da1696d96c5ce2511d367da">root_vd</a>;          
<a name="l00064"></a><a class="code" href="structvolume__def.html#a3f7afc5b4f88dd6d67eb7acdc727653">00064</a>   <a class="code" href="structhfile__def.html" title="Hash file datatype.">hfile_t</a> <a class="code" href="structmetadata__def.html" title="Metadata for file.">metadata</a>;             
<a name="l00065"></a><a class="code" href="structvolume__def.html#4f0da60372e5e6a2415ce796ffc938ec">00065</a>   <a class="code" href="structhfile__def.html" title="Hash file datatype.">hfile_t</a> <a class="code" href="structfh__mapping__def.html" title="File handle mapping.">fh_mapping</a>;           
<a name="l00067"></a>00067 };
<a name="l00068"></a>00068 
<a name="l00070"></a><a class="code" href="volume_8h.html#cd3f66bba58a2892c3ebd5cf5b692cbd">00070</a> <span class="preprocessor">#define VOLUME_ID_VIRTUAL 0     </span>
<a name="l00071"></a><a class="code" href="volume_8h.html#6b963ed32d973e3729592e4dd98e8717">00071</a> <span class="preprocessor">#define VOLUME_ID_CONFIG  1     </span>
<a name="l00074"></a><a class="code" href="volume_8h.html#8f66037240db64c3953ea93a17b8d488">00074</a> <span class="preprocessor">#define VOLUME_NO_LIMIT 0</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>
<a name="l00077"></a>00077 <span class="keyword">extern</span> pthread_mutex_t <a class="code" href="volume_8c.html#ab8b51fe27048d972cd06b1dec470875">volume_mutex</a>;
<a name="l00078"></a>00078 
<a name="l00080"></a>00080 <span class="keyword">extern</span> <a class="code" href="structvolume__def.html" title="Volume description.">volume</a> <a class="code" href="volume_8c.html#f44196fe505490754d836a290343758d">volume_lookup</a> (uint32_t <span class="keywordtype">id</span>);
<a name="l00081"></a>00081 <span class="keyword">extern</span> <a class="code" href="structvolume__def.html" title="Volume description.">volume</a> <a class="code" href="volume_8c.html#15a420ea311c052c2ff74466f77078c4">volume_lookup_nolock</a> (uint32_t <span class="keywordtype">id</span>);
<a name="l00082"></a>00082 <span class="keyword">extern</span> <a class="code" href="structvolume__def.html" title="Volume description.">volume</a> <a class="code" href="volume_8c.html#ad0913dbd2b64fc9c776d79cc730a2ff">volume_lookup_name</a> (<span class="keywordtype">string</span> *name);
<a name="l00083"></a>00083 <span class="keyword">extern</span> <a class="code" href="structvolume__def.html" title="Volume description.">volume</a> <a class="code" href="volume_8c.html#4409ba5284d5b5e8d95834c4f6e00da6">volume_create</a> (uint32_t <span class="keywordtype">id</span>);
<a name="l00084"></a>00084 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="volume_8c.html#dc4b39c1a76f36c1204acb3711fb845d">volume_delete</a> (<a class="code" href="structvolume__def.html" title="Volume description.">volume</a> vol);
<a name="l00085"></a>00085 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="volume_8c.html#9c55277aace6ada1895214c30641f579">volume_set_common_info</a> (<a class="code" href="structvolume__def.html" title="Volume description.">volume</a> vol, <span class="keywordtype">string</span> *name,
<a name="l00086"></a>00086                                     <span class="keywordtype">string</span> *mountpoint, <a class="code" href="structnode__def.html" title="Node description.">node</a> master);
<a name="l00087"></a>00087 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="volume_8c.html#05602bea4bbb2a7c7c33aa785d6ceafe">volume_set_common_info_wrapper</a> (<a class="code" href="structvolume__def.html" title="Volume description.">volume</a> vol, <span class="keywordtype">char</span> *name,
<a name="l00088"></a>00088                                             <span class="keywordtype">char</span> *mountpoint, <a class="code" href="structnode__def.html" title="Node description.">node</a> master);
<a name="l00089"></a>00089 <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="volume_8c.html#28057b4d94fe9d94733d0bea549835d9">volume_set_local_info</a> (<a class="code" href="structvolume__def.html" title="Volume description.">volume</a> *volp, <span class="keywordtype">string</span> *local_path,
<a name="l00090"></a>00090                                    uint64_t size_limit);
<a name="l00091"></a>00091 <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="volume_8c.html#8a10ec910d49b5316d2c5096c27314a6">volume_set_local_info_wrapper</a> (<a class="code" href="structvolume__def.html" title="Volume description.">volume</a> *volp, <span class="keywordtype">char</span> *local_path,
<a name="l00092"></a>00092                                            uint64_t size_limit);
<a name="l00093"></a>00093 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="volume_8c.html#a1310151f7efc01e28346cc656b5e15f">mark_all_volumes</a> (<span class="keywordtype">void</span>);
<a name="l00094"></a>00094 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="volume_8c.html#a48cbdbf2ea763c5424a8c10f02ff8dc">delete_dentries_of_marked_volumes</a> (<span class="keywordtype">void</span>);
<a name="l00095"></a>00095 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="volume_8c.html#fb4196ed458f962b411850e4f26c5aa2">destroy_marked_volume</a> (uint32_t vid);
<a name="l00096"></a>00096 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="volume_8c.html#20369883caf42604941821cb0568544d">destroy_marked_volumes</a> (<span class="keywordtype">void</span>);
<a name="l00097"></a>00097 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="volume_8c.html#b30ce0a069c7edf1d2277431c2dc8e19">destroy_all_volumes</a> (<span class="keywordtype">void</span>);
<a name="l00098"></a>00098 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="volume_8c.html#9314da618430ff531d3d6396007fc167">initialize_volume_c</a> (<span class="keywordtype">void</span>);
<a name="l00099"></a>00099 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="volume_8c.html#0fcb27c8d16afa1b86ef9f9acbe15df7">cleanup_volume_c</a> (<span class="keywordtype">void</span>);
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Fri Aug 6 00:39:37 2010 for zlomekFS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
