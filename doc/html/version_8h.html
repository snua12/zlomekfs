<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>zlomekFS: version.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul>
</div>
<div class="nav">
<a class="el" href="dir_21c430ab3b7001ae39034eae6f7edf71.html">zfsd</a></div>
<h1>version.h File Reference</h1>Functions for file versioning. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="system_8h-source.html">system.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="zfs-prot_8h-source.html">zfs-prot.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="fh_8h-source.html">fh.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="file_8h-source.html">file.h</a>&quot;</code><br>

<p>
<a href="version_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structversion__item__def.html">version_item_def</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdirhtab__item__def.html">dirhtab_item_def</a></td></tr>

<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#1b18a859c47030c4ea29984246f11efa">ZFS_VERSION_BLOCK_SIZE</a>&nbsp;&nbsp;&nbsp;ZFS_MAXDATA</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Maximum block size for versioning.  <a href="#1b18a859c47030c4ea29984246f11efa"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#6a1b855d7800ac7336b42bb44d8ebb19">VERSION_MAX_SPECIFIER_LENGTH</a>&nbsp;&nbsp;&nbsp;21</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#3eab6ad3cc9e15ddcf7fed54d96edbda">VERSION_NAME_SPECIFIER_C</a>&nbsp;&nbsp;&nbsp;'@'</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#a4807c80a15ce7cb56eeb076a936d38d">VERSION_NAME_SPECIFIER_S</a>&nbsp;&nbsp;&nbsp;&quot;@&quot;</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#c241fffff65e3440b1b833baec66a5c4">VERSION_TIMESTAMP</a>&nbsp;&nbsp;&nbsp;&quot;%Y-%m-%d-%H-%M-%S&quot;</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#d46ed4daf4d7ca3f4789c99add4008a3">VERSION_INTERVAL_FILE_ADD</a>&nbsp;&nbsp;&nbsp;&quot;.i&quot;</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#5d0215031a2408638f864160b7a3d2f1">VERSION_DISPLAY_FILE</a>&nbsp;&nbsp;&nbsp;&quot;.verdisplay&quot;</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#0164b8d92de599524e03ba764ee2ec2d">VERSION_LIST_VERSIONS_SUF</a>&nbsp;&nbsp;&nbsp;&quot;versions&quot;</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#db2e32b5e1cb272d3ca284b21945fd0e">VERSION_LIST_VERSIONS_STAMP</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#c5747e78b246c6d96e655fff4862c0a5">MARK_FILE_TRUNCATED</a>(FH)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#bedb51fd5214b8e5c04fac1d7570948d">UNMARK_FILE_TRUNCATED</a>(FH)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#de92c0dea7a8159b9c7f42ba96674e83">VERSION_FILENAME_P</a>(NAME)&nbsp;&nbsp;&nbsp;(strchr ((NAME), VERSION_NAME_SPECIFIER_C) != NULL)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#2e58a6ea69fadf4877d6a6be57dd9475">WAS_FILE_TRUNCATED</a>(FH)&nbsp;&nbsp;&nbsp;((FH)-&gt;file_truncated)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#2c8a57ebb07e0a714241ed16d08cd3c1">CLEAR_VERSION_ITEM</a>(I)</td></tr>

<tr><td colspan="2"><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef <a class="el" href="structversion__item__def.html">version_item_def</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#9eb2245c65ca8182b05d40a6e5109f61">version_item</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#60fd758a3b42263df6bdcc5acbcab6c0">version_create_dirhtab</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepare hash table before readdir.  <a href="#60fd758a3b42263df6bdcc5acbcab6c0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#1ec9543b68d1bd8fadbd12ef7eb8a41a">version_readdir_from_dirhtab</a> (<a class="el" href="structdir__list__def.html">dir_list</a> *list, <a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, int32_t cookie, <a class="el" href="structreaddir__data__def.html">readdir_data</a> *data, <a class="el" href="file_8h.html#21c41dfd55f14bdf17612a0db1329e40">filldir_f</a> filldir)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return versions during readdir.  <a href="#1ec9543b68d1bd8fadbd12ef7eb8a41a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#e83190f2888f0e8336d03440d85d63cc">version_readdir_fill_dirhtab</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, time_t stamp, long ino, char *name)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Store version during readdir.  <a href="#e83190f2888f0e8336d03440d85d63cc"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#4df352ea352d9e9d714d1df7ebb1d21a">version_load_interval_tree</a> (<a class="el" href="structinternal__fh__def.html">internal_fh</a> fh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Load interval file.  <a href="#4df352ea352d9e9d714d1df7ebb1d21a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#7bf2874e1efd3d3ecf1062af630e25b9">version_save_interval_trees</a> (<a class="el" href="structinternal__fh__def.html">internal_fh</a> fh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write interval file.  <a href="#7bf2874e1efd3d3ecf1062af630e25b9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#0dce2b68fd0c66a4f4132b14f8695794">version_generate_filename</a> (char *path, <a class="el" href="structstring__def.html">string</a> *verpath)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Generate file version specifier.  <a href="#0dce2b68fd0c66a4f4132b14f8695794"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#949743388120751c0d579863072fd0e0">version_create_file_with_attr</a> (char *path, <a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, <a class="el" href="structvolume__def.html">volume</a> vol, bool with_size)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create version file.  <a href="#949743388120751c0d579863072fd0e0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#7641c0cd39322559b8b09468b766b1d8">version_create_file</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, <a class="el" href="structvolume__def.html">volume</a> vol)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Open version file.  <a href="#7641c0cd39322559b8b09468b766b1d8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#e10275ada93a6b3e09048e6fbf845b60">version_close_file</a> (<a class="el" href="structinternal__fh__def.html">internal_fh</a> fh, bool tidy)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Close version file.  <a href="#e10275ada93a6b3e09048e6fbf845b60"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#95521fdf0d0f9b2354aa7d2a6781a830">version_truncate_file</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, <a class="el" href="structvolume__def.html">volume</a> vol, char *path)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Perform file truncate with versioning.  <a href="#95521fdf0d0f9b2354aa7d2a6781a830"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#a458ef1d4b39cfe1ef2f950317ba2f53">version_unlink_file</a> (char *path)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Perform file unlink with versioning.  <a href="#a458ef1d4b39cfe1ef2f950317ba2f53"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#a89560800011f5ee34c971ed4f11aa7f">version_find_version</a> (char *dir, <a class="el" href="structstring__def.html">string</a> *name, time_t stamp)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find first newer version.  <a href="#a89560800011f5ee34c971ed4f11aa7f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#c251b6d08a805666f18a2e3fb79d1c21">version_get_filename_stamp</a> (char *name, time_t *stamp, int *orgnamelen)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Parse version suffix (datetime format).  <a href="#c251b6d08a805666f18a2e3fb79d1c21"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#9f2cb81a7688d1c80dfa9bb716f9882b">version_is_directory</a> (<a class="el" href="structstring__def.html">string</a> *dst, char *dir, <a class="el" href="structstring__def.html">string</a> *name, time_t stamp, time_t *dirstamp, int orgnamelen)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if working with directory.  <a href="#9f2cb81a7688d1c80dfa9bb716f9882b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#22033f52d51e6198148b8ba0ea180db7">version_build_intervals</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, <a class="el" href="structvolume__def.html">volume</a> vol)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create list of intervals for a file version.  <a href="#22033f52d51e6198148b8ba0ea180db7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#83c80ca1109f9a7ee36533dbb424b396">version_read_old_data</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, uint64_t start, uint64_t end, char *buf)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read data from the version file. It uses intervals build during open.  <a href="#83c80ca1109f9a7ee36533dbb424b396"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#894feb0c415ebcec749917764296d069">version_rename_source</a> (char *path)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create version during rename.  <a href="#894feb0c415ebcec749917764296d069"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#5b49a2ab3eda266795ee3b0425f53f6a">version_unlink_version_file</a> (char *path)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete version file.  <a href="#5b49a2ab3eda266795ee3b0425f53f6a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#30cbb86ae0cee5ac735430605cb0cc77">version_retent_file</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dir, <a class="el" href="structvolume__def.html">volume</a> vol, char *name)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete version file.  <a href="#30cbb86ae0cee5ac735430605cb0cc77"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#48d0714f5009e4ef62020aae53a20634">version_copy_data</a> (int fd, int fdv, uint64_t offset, uint32_t length, <a class="el" href="structdata__buffer__def.html">data_buffer</a> *newdata)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Copy data into version file.  <a href="#48d0714f5009e4ef62020aae53a20634"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#36ab31eaf0448f4240d4ec7cdf9fe618">version_rmdir_versions</a> (char *path)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove all version files from a directory.  <a href="#36ab31eaf0448f4240d4ec7cdf9fe618"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="version_8h.html#2818bf4652385ca77a43f3b7c00828bd">version_apply_retention</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, <a class="el" href="structvolume__def.html">volume</a> vol)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Functions for file versioning. 
<p>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="2c8a57ebb07e0a714241ed16d08cd3c1"></a><!-- doxytag: member="version.h::CLEAR_VERSION_ITEM" ref="2c8a57ebb07e0a714241ed16d08cd3c1" args="(I)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CLEAR_VERSION_ITEM          </td>
          <td>(</td>
          <td class="paramtype">I&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Value:</b><div class="fragment"><pre class="fragment">{\
  I.stamp = 0; \
  <span class="keywordflow">if</span> (I.name) free (I.name); \
  I.name = NULL; \
  <span class="keywordflow">if</span> (I.path) free (I.path); \
  I.path = NULL; \
  <span class="keywordflow">if</span> (I.intervals) <a class="code" href="interval_8c.html#8fadb6e23eca2ab2cacf0d9ddaae6095">interval_tree_destroy</a> (I.intervals); \
  I.intervals = NULL; \
}
</pre></div>
</div>
</div><p>
<a class="anchor" name="c5747e78b246c6d96e655fff4862c0a5"></a><!-- doxytag: member="version.h::MARK_FILE_TRUNCATED" ref="c5747e78b246c6d96e655fff4862c0a5" args="(FH)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MARK_FILE_TRUNCATED          </td>
          <td>(</td>
          <td class="paramtype">FH&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Value:</b><div class="fragment"><pre class="fragment">({ \
    (FH)-&gt;file_truncated = <span class="keyword">true</span>; \
  })
</pre></div>Mark file as truncated. 
</div>
</div><p>
<a class="anchor" name="bedb51fd5214b8e5c04fac1d7570948d"></a><!-- doxytag: member="version.h::UNMARK_FILE_TRUNCATED" ref="bedb51fd5214b8e5c04fac1d7570948d" args="(FH)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define UNMARK_FILE_TRUNCATED          </td>
          <td>(</td>
          <td class="paramtype">FH&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Value:</b><div class="fragment"><pre class="fragment">({ \
    (FH)-&gt;file_truncated = <span class="keyword">false</span>; \
  })
</pre></div>Unmark file as truncated. 
</div>
</div><p>
<a class="anchor" name="5d0215031a2408638f864160b7a3d2f1"></a><!-- doxytag: member="version.h::VERSION_DISPLAY_FILE" ref="5d0215031a2408638f864160b7a3d2f1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VERSION_DISPLAY_FILE&nbsp;&nbsp;&nbsp;&quot;.verdisplay&quot;          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="de92c0dea7a8159b9c7f42ba96674e83"></a><!-- doxytag: member="version.h::VERSION_FILENAME_P" ref="de92c0dea7a8159b9c7f42ba96674e83" args="(NAME)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VERSION_FILENAME_P          </td>
          <td>(</td>
          <td class="paramtype">NAME&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">&nbsp;&nbsp;&nbsp;(strchr ((NAME), VERSION_NAME_SPECIFIER_C) != NULL)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
True when the NAME is a version file. 
</div>
</div><p>
<a class="anchor" name="d46ed4daf4d7ca3f4789c99add4008a3"></a><!-- doxytag: member="version.h::VERSION_INTERVAL_FILE_ADD" ref="d46ed4daf4d7ca3f4789c99add4008a3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VERSION_INTERVAL_FILE_ADD&nbsp;&nbsp;&nbsp;&quot;.i&quot;          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="db2e32b5e1cb272d3ca284b21945fd0e"></a><!-- doxytag: member="version.h::VERSION_LIST_VERSIONS_STAMP" ref="db2e32b5e1cb272d3ca284b21945fd0e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VERSION_LIST_VERSIONS_STAMP&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="0164b8d92de599524e03ba764ee2ec2d"></a><!-- doxytag: member="version.h::VERSION_LIST_VERSIONS_SUF" ref="0164b8d92de599524e03ba764ee2ec2d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VERSION_LIST_VERSIONS_SUF&nbsp;&nbsp;&nbsp;&quot;versions&quot;          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="6a1b855d7800ac7336b42bb44d8ebb19"></a><!-- doxytag: member="version.h::VERSION_MAX_SPECIFIER_LENGTH" ref="6a1b855d7800ac7336b42bb44d8ebb19" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VERSION_MAX_SPECIFIER_LENGTH&nbsp;&nbsp;&nbsp;21          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="3eab6ad3cc9e15ddcf7fed54d96edbda"></a><!-- doxytag: member="version.h::VERSION_NAME_SPECIFIER_C" ref="3eab6ad3cc9e15ddcf7fed54d96edbda" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VERSION_NAME_SPECIFIER_C&nbsp;&nbsp;&nbsp;'@'          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="a4807c80a15ce7cb56eeb076a936d38d"></a><!-- doxytag: member="version.h::VERSION_NAME_SPECIFIER_S" ref="a4807c80a15ce7cb56eeb076a936d38d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VERSION_NAME_SPECIFIER_S&nbsp;&nbsp;&nbsp;&quot;@&quot;          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="c241fffff65e3440b1b833baec66a5c4"></a><!-- doxytag: member="version.h::VERSION_TIMESTAMP" ref="c241fffff65e3440b1b833baec66a5c4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VERSION_TIMESTAMP&nbsp;&nbsp;&nbsp;&quot;%Y-%m-%d-%H-%M-%S&quot;          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="2e58a6ea69fadf4877d6a6be57dd9475"></a><!-- doxytag: member="version.h::WAS_FILE_TRUNCATED" ref="2e58a6ea69fadf4877d6a6be57dd9475" args="(FH)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WAS_FILE_TRUNCATED          </td>
          <td>(</td>
          <td class="paramtype">FH&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">&nbsp;&nbsp;&nbsp;((FH)-&gt;file_truncated)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Was file as truncated before opening? 
</div>
</div><p>
<a class="anchor" name="1b18a859c47030c4ea29984246f11efa"></a><!-- doxytag: member="version.h::ZFS_VERSION_BLOCK_SIZE" ref="1b18a859c47030c4ea29984246f11efa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ZFS_VERSION_BLOCK_SIZE&nbsp;&nbsp;&nbsp;ZFS_MAXDATA          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Maximum block size for versioning. 
<p>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="zfs-prot_8h.html#f31e6b0c0c7b511bdd267bd23ff2a9ab">ZFS_MAXDATA</a> </dd></dl>

</div>
</div><p>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="9eb2245c65ca8182b05d40a6e5109f61"></a><!-- doxytag: member="version.h::version_item" ref="9eb2245c65ca8182b05d40a6e5109f61" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structversion__item__def.html">version_item_def</a>  <a class="el" href="structversion__item__def.html">version_item</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="2818bf4652385ca77a43f3b7c00828bd"></a><!-- doxytag: member="version.h::version_apply_retention" ref="2818bf4652385ca77a43f3b7c00828bd" args="(internal_dentry dentry, volume vol)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_apply_retention           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="22033f52d51e6198148b8ba0ea180db7"></a><!-- doxytag: member="version.h::version_build_intervals" ref="22033f52d51e6198148b8ba0ea180db7" args="(internal_dentry dentry, volume vol)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_build_intervals           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create list of intervals for a file version. 
<p>
Create list of intervals together with version files these intervals are stored in that create the whole content of a file version. List is created from interval files during file open. Result is stored in the internal file handle.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dentry</em>&nbsp;</td><td>Dentry of the file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>vol</em>&nbsp;</td><td>Volume the file in on </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="e10275ada93a6b3e09048e6fbf845b60"></a><!-- doxytag: member="version.h::version_close_file" ref="e10275ada93a6b3e09048e6fbf845b60" args="(internal_fh fh, bool tidy)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_close_file           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__fh__def.html">internal_fh</a>&nbsp;</td>
          <td class="paramname"> <em>fh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>tidy</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Close version file. 
<p>
Close version file of the specified current file.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fh</em>&nbsp;</td><td>Internal file handle of the file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tidy</em>&nbsp;</td><td>Whether the function should make the version file sparse. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="48d0714f5009e4ef62020aae53a20634"></a><!-- doxytag: member="version.h::version_copy_data" ref="48d0714f5009e4ef62020aae53a20634" args="(int fd, int fdv, uint64_t offset, uint32_t length, data_buffer *newdata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_copy_data           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fdv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdata__buffer__def.html">data_buffer</a> *&nbsp;</td>
          <td class="paramname"> <em>newdata</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Copy data into version file. 
<p>
Copy data from current file to version file. Copy only part of the file and only when it differs from the data to be written.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fd</em>&nbsp;</td><td>File descriptor of current file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fdv</em>&nbsp;</td><td>File descriptor of version file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>offset</em>&nbsp;</td><td>Start of data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>length</em>&nbsp;</td><td>Length of data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>newdata</em>&nbsp;</td><td>Buffer with data to be written (to compare it only, no write) </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="60fd758a3b42263df6bdcc5acbcab6c0"></a><!-- doxytag: member="version.h::version_create_dirhtab" ref="60fd758a3b42263df6bdcc5acbcab6c0" args="(internal_dentry dentry)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void version_create_dirhtab           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Prepare hash table before readdir. 
<p>
Prepare hash table before readdir.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dentry</em>&nbsp;</td><td>Dentry of the directory </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="7641c0cd39322559b8b09468b766b1d8"></a><!-- doxytag: member="version.h::version_create_file" ref="7641c0cd39322559b8b09468b766b1d8" args="(internal_dentry dentry, volume vol)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_create_file           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Open version file. 
<p>
Open version file for specified current file. If the appropriate version already exists, it is opened. New version file is created otherwise.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>denty</em>&nbsp;</td><td>Dentry of the file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>vol</em>&nbsp;</td><td>Volume of the file </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="949743388120751c0d579863072fd0e0"></a><!-- doxytag: member="version.h::version_create_file_with_attr" ref="949743388120751c0d579863072fd0e0" args="(char *path, internal_dentry dentry, volume vol, bool with_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_create_file_with_attr           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>with_size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create version file. 
<p>
Create version file based on the current file attributes.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>Complete file path </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dentry</em>&nbsp;</td><td>Dentry of the file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>with_size</em>&nbsp;</td><td>Whether version file should be enlarged to the size of the current file </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="a89560800011f5ee34c971ed4f11aa7f"></a><!-- doxytag: member="version.h::version_find_version" ref="a89560800011f5ee34c971ed4f11aa7f" args="(char *dir, string *name, time_t stamp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_find_version           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structstring__def.html">string</a> *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&nbsp;</td>
          <td class="paramname"> <em>stamp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Find first newer version. 
<p>
Find oldest version of the file that is newer than the specified time stamp.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dir</em>&nbsp;</td><td>Complete path of the directory </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>name</em>&nbsp;</td><td>File name; contains version suffix on return </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>stamp</em>&nbsp;</td><td>Time stamp </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="0dce2b68fd0c66a4f4132b14f8695794"></a><!-- doxytag: member="version.h::version_generate_filename" ref="0dce2b68fd0c66a4f4132b14f8695794" args="(char *path, string *verpath)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_generate_filename           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structstring__def.html">string</a> *&nbsp;</td>
          <td class="paramname"> <em>verpath</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Generate file version specifier. 
<p>
Add a version suffix to the specified file path. Suffix is generated from the current time.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>Complete file path. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>verpath</em>&nbsp;</td><td>Complete file path including a version suffix. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="c251b6d08a805666f18a2e3fb79d1c21"></a><!-- doxytag: member="version.h::version_get_filename_stamp" ref="c251b6d08a805666f18a2e3fb79d1c21" args="(char *name, time_t *stamp, int *orgnamelen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_get_filename_stamp           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t *&nbsp;</td>
          <td class="paramname"> <em>stamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>orgnamelen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Parse version suffix (datetime format). 
<p>
Parse time stamp version suffix from the file name. Function expects yyyy-mm-dd-hh-mm-ss format.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>File name with a version suffix </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>stamp</em>&nbsp;</td><td>Time stamp from the suffix </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>ornamelen</em>&nbsp;</td><td>Length of the file name without the version suffix</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ZFS_OK</em>&nbsp;</td><td>Version suffix was successfully parsed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ENOENT</em>&nbsp;</td><td>version suffix is not correct </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="9f2cb81a7688d1c80dfa9bb716f9882b"></a><!-- doxytag: member="version.h::version_is_directory" ref="9f2cb81a7688d1c80dfa9bb716f9882b" args="(string *dst, char *dir, string *name, time_t stamp, time_t *dirstamp, int orgnamelen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_is_directory           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structstring__def.html">string</a> *&nbsp;</td>
          <td class="paramname"> <em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structstring__def.html">string</a> *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&nbsp;</td>
          <td class="paramname"> <em>stamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t *&nbsp;</td>
          <td class="paramname"> <em>dirstamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>orgnamelen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Check if working with directory. 
<p>
Check whether name is a directory.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>dst</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dir</em>&nbsp;</td><td>Parent directory name </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>name</em>&nbsp;</td><td>Child file/directory name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>stamp</em>&nbsp;</td><td>Time stamp applied to the parent directory </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ornamelen</em>&nbsp;</td><td>Length of the child file/directory name without the version suffix</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ZFS_OK</em>&nbsp;</td><td>Child is a directory; dst is filled in and name suffix is truncated </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ENOENT</em>&nbsp;</td><td>Child in not a directory </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="4df352ea352d9e9d714d1df7ebb1d21a"></a><!-- doxytag: member="version.h::version_load_interval_tree" ref="4df352ea352d9e9d714d1df7ebb1d21a" args="(internal_fh fh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool version_load_interval_tree           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__fh__def.html">internal_fh</a>&nbsp;</td>
          <td class="paramname"> <em>fh</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Load interval file. 
<p>
Load interval file.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fh</em>&nbsp;</td><td>Internal file handle </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="83c80ca1109f9a7ee36533dbb424b396"></a><!-- doxytag: member="version.h::version_read_old_data" ref="83c80ca1109f9a7ee36533dbb424b396" args="(internal_dentry dentry, uint64_t start, uint64_t end, char *buf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_read_old_data           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read data from the version file. It uses intervals build during open. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dentry</em>&nbsp;</td><td>Dentry of the file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>start</em>&nbsp;</td><td>Start of data interval </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>end</em>&nbsp;</td><td>End of data interval </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>buf</em>&nbsp;</td><td>Buffer to store the data</td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="version_8h.html#22033f52d51e6198148b8ba0ea180db7" title="Create list of intervals for a file version.">version_build_intervals</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="e83190f2888f0e8336d03440d85d63cc"></a><!-- doxytag: member="version.h::version_readdir_fill_dirhtab" ref="e83190f2888f0e8336d03440d85d63cc" args="(internal_dentry dentry, time_t stamp, long ino, char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_readdir_fill_dirhtab           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&nbsp;</td>
          <td class="paramname"> <em>stamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&nbsp;</td>
          <td class="paramname"> <em>ino</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Store version during readdir. 
<p>
Store version file information into a hash table associated with the dentry. It is called during readdir to find newest version for every versioned file.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dentry</em>&nbsp;</td><td>Directory dentry </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>stamp</em>&nbsp;</td><td>Version time stamp </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ino</em>&nbsp;</td><td>Inode number of the version file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>File name </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="1ec9543b68d1bd8fadbd12ef7eb8a41a"></a><!-- doxytag: member="version.h::version_readdir_from_dirhtab" ref="1ec9543b68d1bd8fadbd12ef7eb8a41a" args="(dir_list *list, internal_dentry dentry, int32_t cookie, readdir_data *data, filldir_f filldir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_readdir_from_dirhtab           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdir__list__def.html">dir_list</a> *&nbsp;</td>
          <td class="paramname"> <em>list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&nbsp;</td>
          <td class="paramname"> <em>cookie</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structreaddir__data__def.html">readdir_data</a> *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="file_8h.html#21c41dfd55f14bdf17612a0db1329e40">filldir_f</a>&nbsp;</td>
          <td class="paramname"> <em>filldir</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return versions during readdir. 
<p>
Return version file names for the hash table during readdir. Hash table is first filled in by version_readdir_fill_dirhtab. All parameters are taken from readdir call.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>list</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dentry</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cookie</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>filldir</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="version_8h.html#1ec9543b68d1bd8fadbd12ef7eb8a41a" title="Return versions during readdir.">version_readdir_from_dirhtab</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="894feb0c415ebcec749917764296d069"></a><!-- doxytag: member="version.h::version_rename_source" ref="894feb0c415ebcec749917764296d069" args="(char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_rename_source           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create version during rename. 
<p>
Create version file during file rename.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>Complete path of the file </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="30cbb86ae0cee5ac735430605cb0cc77"></a><!-- doxytag: member="version.h::version_retent_file" ref="30cbb86ae0cee5ac735430605cb0cc77" args="(internal_dentry dir, volume vol, char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool version_retent_file           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Delete version file. 
<p>
Delete version file and its respective interval file.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dir</em>&nbsp;</td><td>Dentry of the directory the file is in </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>vol</em>&nbsp;</td><td>Volume the file is on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>Name of the file </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="36ab31eaf0448f4240d4ec7cdf9fe618"></a><!-- doxytag: member="version.h::version_rmdir_versions" ref="36ab31eaf0448f4240d4ec7cdf9fe618" args="(char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_rmdir_versions           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Remove all version files from a directory. 
<p>
Remove all version files from specified directory. This function is called from rmdir operations to make sure all files are deleted even version files are not displayed. Works correctly only if there are no other files but versions.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>Complete path to the directory </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="7bf2874e1efd3d3ecf1062af630e25b9"></a><!-- doxytag: member="version.h::version_save_interval_trees" ref="7bf2874e1efd3d3ecf1062af630e25b9" args="(internal_fh fh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool version_save_interval_trees           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__fh__def.html">internal_fh</a>&nbsp;</td>
          <td class="paramname"> <em>fh</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Write interval file. 
<p>
Write interval file for the version associated with the current file.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fh</em>&nbsp;</td><td>Internal file handle </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="95521fdf0d0f9b2354aa7d2a6781a830"></a><!-- doxytag: member="version.h::version_truncate_file" ref="95521fdf0d0f9b2354aa7d2a6781a830" args="(internal_dentry dentry, volume vol, char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_truncate_file           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Perform file truncate with versioning. 
<p>
Perform file truncate, i.e. rename current file to the version file and create new current file.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dentry</em>&nbsp;</td><td>Dentry of the file </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>Complete path of the file </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="a458ef1d4b39cfe1ef2f950317ba2f53"></a><!-- doxytag: member="version.h::version_unlink_file" ref="a458ef1d4b39cfe1ef2f950317ba2f53" args="(char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_unlink_file           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Perform file unlink with versioning. 
<p>
Perform file unlink, i.e. rename current file to the version file.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>Complete path of the file </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="5b49a2ab3eda266795ee3b0425f53f6a"></a><!-- doxytag: member="version.h::version_unlink_version_file" ref="5b49a2ab3eda266795ee3b0425f53f6a" args="(char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t version_unlink_version_file           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Delete version file. 
<p>
Delete version file and its respective interval file.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>Complete path of the file </td></tr>
  </table>
</dl>

</div>
</div><p>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Aug 6 00:39:38 2010 for zlomekFS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
