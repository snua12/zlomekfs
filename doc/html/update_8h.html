<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>zlomekFS: update.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul>
</div>
<div class="nav">
<a class="el" href="dir_21c430ab3b7001ae39034eae6f7edf71.html">zfsd</a></div>
<h1>update.h File Reference</h1>Functions for updating and reintegrating files. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="system_8h-source.html">system.h</a>&quot;</code><br>
<code>#include &lt;inttypes.h&gt;</code><br>
<code>#include &quot;<a class="el" href="pthread-wrapper_8h-source.html">pthread-wrapper.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="varray_8h-source.html">varray.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="queue_8h-source.html">queue.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="thread_8h-source.html">thread.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="fh_8h-source.html">fh.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="cap_8h-source.html">cap.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="metadata_8h-source.html">metadata.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="zfs-prot_8h-source.html">zfs-prot.h</a>&quot;</code><br>

<p>
<a href="update_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#e14ab5bf63adaa2e8b112fc585004d1c">ZFS_UPDATED_BLOCK_SIZE</a>&nbsp;&nbsp;&nbsp;ZFS_MAXDATA</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Maximum block size for updating.  <a href="#e14ab5bf63adaa2e8b112fc585004d1c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#cb52b3f1073d3e81b62fbd569e4af4c5">ZFS_MODIFIED_BLOCK_SIZE</a>&nbsp;&nbsp;&nbsp;1024</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Maximum block size for reintegrating.  <a href="#cb52b3f1073d3e81b62fbd569e4af4c5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#4ee1026de0a6ec4670c67d687fd27b40">UPDATE_P</a>(DENTRY, ATTR)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check whether we should update a generic file.  <a href="#4ee1026de0a6ec4670c67d687fd27b40"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#2630c17ca8a44d638f8750a4217d5043">REINTEGRATE_P</a>(DENTRY, ATTR)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check whether we should reintegrate a generic file.  <a href="#2630c17ca8a44d638f8750a4217d5043"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#2a266a04159e641dbf9b073fe30c3b27">METADATA_SIZE_CHANGE_P</a>(ATTR1, ATTR2)&nbsp;&nbsp;&nbsp;(((ATTR1).type == FT_REG) &amp;&amp; ((ATTR1).size != (ATTR2).size))</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Are file sizes (for regular files) different?  <a href="#2a266a04159e641dbf9b073fe30c3b27"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#1da61dcc622d7188c533cb41a60e026e">METADATA_MASTER_VERSION_CHANGE_P</a>(DENTRY, ATTR)&nbsp;&nbsp;&nbsp;(((ATTR).type == FT_REG) &amp;&amp; ((DENTRY)-&gt;fh-&gt;meta.master_version != (ATTR).version))</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Did the master version (for regular files) change?  <a href="#1da61dcc622d7188c533cb41a60e026e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#7aabe7b3889817117c5aae75a3be6e7a">METADATA_ATTR_CHANGE_P</a>(META, ATTR)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Are metadata (mode, UID and GID) different in META and ATTR?  <a href="#7aabe7b3889817117c5aae75a3be6e7a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#d6e3397d3472faa9518123b238388fa0">METADATA_CHANGE_P</a>(DENTRY, ATTR)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Have local or remote metadata/attributes (mode, UID and GID, size and master version) changed?  <a href="#d6e3397d3472faa9518123b238388fa0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#30e082b021dce7ac4bf59c8fe51d523a">METADATA_ATTR_EQ_P</a>(ATTR1, ATTR2)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Are metadata/attributes (more, uid, guid, size) in attributes ATTR1 and ATTR2 equal?  <a href="#30e082b021dce7ac4bf59c8fe51d523a"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#070edc4f16621981f4a856c1dfd27b76">get_blocks_for_updating</a> (<a class="el" href="structinternal__fh__def.html">internal_fh</a> fh, uint64_t start, uint64_t end, <a class="el" href="structvarray__def.html">varray</a> *blocks)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Determine, which blocks in specified part of the file need to be updated.  <a href="#070edc4f16621981f4a856c1dfd27b76"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#03d0d58bd98ce17acc4958ca72fa5626">update_file_blocks</a> (<a class="el" href="structzfs__cap__def.html">zfs_cap</a> *cap, <a class="el" href="structvarray__def.html">varray</a> *blocks, bool modified, bool slow)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update blocks of local file according to remote file.  <a href="#03d0d58bd98ce17acc4958ca72fa5626"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#aea7cdd865f077cb639f4983e4f628e9">update_fh_if_needed</a> (<a class="el" href="structvolume__def.html">volume</a> *volp, <a class="el" href="structinternal__dentry__def.html">internal_dentry</a> *dentryp, <a class="el" href="structzfs__fh__def.html">zfs_fh</a> *fh, int what)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update generic file DENTRY with file handle FH on volume VOL if needed and wanted.  <a href="#aea7cdd865f077cb639f4983e4f628e9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#d51a0b4039b35ba2caeb35402d04c4c8">update_fh_if_needed_2</a> (<a class="el" href="structvolume__def.html">volume</a> *volp, <a class="el" href="structinternal__dentry__def.html">internal_dentry</a> *dentryp, <a class="el" href="structinternal__dentry__def.html">internal_dentry</a> *dentry2p, <a class="el" href="structzfs__fh__def.html">zfs_fh</a> *fh, <a class="el" href="structzfs__fh__def.html">zfs_fh</a> *fh2, int what)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update generic file DENTRY on volume VOL if needed.  <a href="#d51a0b4039b35ba2caeb35402d04c4c8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#be6f099b6a2fcc2abc9f8fecb5890202">update_cap_if_needed</a> (<a class="el" href="structinternal__cap__def.html">internal_cap</a> *icapp, <a class="el" href="structvolume__def.html">volume</a> *volp, <a class="el" href="structinternal__dentry__def.html">internal_dentry</a> *dentryp, <a class="el" href="structvirtual__dir__def.html">virtual_dir</a> *vdp, <a class="el" href="structzfs__cap__def.html">zfs_cap</a> *cap, bool put_cap, int what)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update generic file DENTRY on volume VOL associated with capability ICAP if needed.  <a href="#be6f099b6a2fcc2abc9f8fecb5890202"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#926f28e861dfa653d7f755dd1f17f652">delete_tree</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, <a class="el" href="structvolume__def.html">volume</a> vol, bool destroy_dentry, bool journal_p, bool move_to_shadow_p)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete file/subtree in place of file DENTRY on volume VOL.  <a href="#926f28e861dfa653d7f755dd1f17f652"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#dd5180f7532813987b3a4e7aab2c7324">delete_tree_name</a> (<a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dir, <a class="el" href="structstring__def.html">string</a> *name, <a class="el" href="structvolume__def.html">volume</a> vol, bool destroy_dentry, bool journal_p, bool move_to_shadow_p)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete file NAME in directory DIR on volume VOL.  <a href="#dd5180f7532813987b3a4e7aab2c7324"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#3d750f23c5ae2d66320c6f5cf96c5346">resolve_conflict_discard_local</a> (<a class="el" href="structzfs__fh__def.html">zfs_fh</a> *conflict_fh, <a class="el" href="structinternal__dentry__def.html">internal_dentry</a> local, <a class="el" href="structinternal__dentry__def.html">internal_dentry</a> remote, <a class="el" href="structvolume__def.html">volume</a> vol)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Discard changes to local file LOCAL which is in conflict with REMOTE on volume VOL.  <a href="#3d750f23c5ae2d66320c6f5cf96c5346"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#18bcb8f6f49657c49a5a34baa0c62ee3">resolve_conflict_discard_remote</a> (<a class="el" href="structzfs__fh__def.html">zfs_fh</a> *conflict_fh, <a class="el" href="structinternal__dentry__def.html">internal_dentry</a> local, <a class="el" href="structinternal__dentry__def.html">internal_dentry</a> remote, <a class="el" href="structvolume__def.html">volume</a> vol)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Discard changes to remote file REMOTE which is in conflict with LOCAL on volume VOL.  <a href="#18bcb8f6f49657c49a5a34baa0c62ee3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#d9a6c0040f592fdca647ae1c6134eeff">resolve_conflict_delete_local</a> (<a class="el" href="structdir__op__res__def.html">dir_op_res</a> *res, <a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dir, <a class="el" href="structzfs__fh__def.html">zfs_fh</a> *dir_fh, <a class="el" href="structstring__def.html">string</a> *name, <a class="el" href="structzfs__fh__def.html">zfs_fh</a> *local_fh, <a class="el" href="structzfs__fh__def.html">zfs_fh</a> *remote_fh, <a class="el" href="structvolume__def.html">volume</a> vol)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Resolve conflict by deleting local file.  <a href="#d9a6c0040f592fdca647ae1c6134eeff"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#9f56b919ffd4b001fcba2a5d52b443a4">resolve_conflict_delete_remote</a> (<a class="el" href="structvolume__def.html">volume</a> vol, <a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dir, <a class="el" href="structstring__def.html">string</a> *name, <a class="el" href="structzfs__fh__def.html">zfs_fh</a> *remote_fh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Resolve conflict by deleting remote file NAME with file handle REMOTE_FH in directory DIR on volume VOL.  <a href="#9f56b919ffd4b001fcba2a5d52b443a4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#3206db6ce423b4e20a7c1e2fb7711cdb">update</a> (<a class="el" href="structvolume__def.html">volume</a> vol, <a class="el" href="structinternal__dentry__def.html">internal_dentry</a> dentry, <a class="el" href="structzfs__fh__def.html">zfs_fh</a> *fh, <a class="el" href="structfattr__def.html">fattr</a> *attr, int how)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reintegrate or update generic file.  <a href="#3206db6ce423b4e20a7c1e2fb7711cdb"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#6e55fb2c33d8aba365ce6cf0592ae2fb">update_start</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the mutexes and queues for updating, and create the <a class="el" href="update_8h.html#042a22003c0b9b8c3d97d4bc07a4f98c" title="Pool of update threads.">update_pool</a>.  <a href="#6e55fb2c33d8aba365ce6cf0592ae2fb"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#19341698513037bdd134d627755ff3b7">update_cleanup</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destroy <a class="el" href="update_8h.html#042a22003c0b9b8c3d97d4bc07a4f98c" title="Pool of update threads.">update_pool</a> and cleanup the mutexes and queues for updating.  <a href="#19341698513037bdd134d627755ff3b7"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structqueue__def.html">queue</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#a148194f9fdacbf90ab1965422718cfc">update_queue</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Queue of file handles for updating or reintegrating.  <a href="#a148194f9fdacbf90ab1965422718cfc"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structthread__pool__def.html">thread_pool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update_8h.html#042a22003c0b9b8c3d97d4bc07a4f98c">update_pool</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pool of update threads.  <a href="#042a22003c0b9b8c3d97d4bc07a4f98c"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Functions for updating and reintegrating files. 
<p>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="7aabe7b3889817117c5aae75a3be6e7a"></a><!-- doxytag: member="update.h::METADATA_ATTR_CHANGE_P" ref="7aabe7b3889817117c5aae75a3be6e7a" args="(META, ATTR)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define METADATA_ATTR_CHANGE_P          </td>
          <td>(</td>
          <td class="paramtype">META,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ATTR&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Value:</b><div class="fragment"><pre class="fragment">((ATTR).mode != <a class="code" href="metadata_8h.html#015d31621627a1bf93ba2aaa94b3c2d6">GET_MODETYPE_MODE</a> ((META).modetype)                     \
   || (ATTR).uid != (META).uid                                          \
   || (ATTR).gid != (META).gid)
</pre></div>Are metadata (mode, UID and GID) different in META and ATTR? 
<p>

</div>
</div><p>
<a class="anchor" name="30e082b021dce7ac4bf59c8fe51d523a"></a><!-- doxytag: member="update.h::METADATA_ATTR_EQ_P" ref="30e082b021dce7ac4bf59c8fe51d523a" args="(ATTR1, ATTR2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define METADATA_ATTR_EQ_P          </td>
          <td>(</td>
          <td class="paramtype">ATTR1,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ATTR2&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Value:</b><div class="fragment"><pre class="fragment">((ATTR1).mode == (ATTR2).mode                                           \
   &amp;&amp; (ATTR1).uid == (ATTR2).uid                                        \
   &amp;&amp; (ATTR1).gid == (ATTR2).gid                                        \
   &amp;&amp; !<a class="code" href="update_8h.html#2a266a04159e641dbf9b073fe30c3b27" title="Are file sizes (for regular files) different?">METADATA_SIZE_CHANGE_P</a>(ATTR1, ATTR2))
</pre></div>Are metadata/attributes (more, uid, guid, size) in attributes ATTR1 and ATTR2 equal? 
<p>

</div>
</div><p>
<a class="anchor" name="d6e3397d3472faa9518123b238388fa0"></a><!-- doxytag: member="update.h::METADATA_CHANGE_P" ref="d6e3397d3472faa9518123b238388fa0" args="(DENTRY, ATTR)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define METADATA_CHANGE_P          </td>
          <td>(</td>
          <td class="paramtype">DENTRY,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ATTR&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Value:</b><div class="fragment"><pre class="fragment">(<a class="code" href="update_8h.html#7aabe7b3889817117c5aae75a3be6e7a" title="Are metadata (mode, UID and GID) different in META and ATTR?">METADATA_ATTR_CHANGE_P</a> ((DENTRY)-&gt;fh-&gt;meta, (DENTRY)-&gt;fh-&gt;attr)        \
   || <a class="code" href="update_8h.html#7aabe7b3889817117c5aae75a3be6e7a" title="Are metadata (mode, UID and GID) different in META and ATTR?">METADATA_ATTR_CHANGE_P</a> ((DENTRY)-&gt;fh-&gt;meta, ATTR)                 \
   || <a class="code" href="update_8h.html#2a266a04159e641dbf9b073fe30c3b27" title="Are file sizes (for regular files) different?">METADATA_SIZE_CHANGE_P</a> ((DENTRY)-&gt;fh-&gt;attr, ATTR)                 \
   || <a class="code" href="update_8h.html#1da61dcc622d7188c533cb41a60e026e" title="Did the master version (for regular files) change?">METADATA_MASTER_VERSION_CHANGE_P</a>(DENTRY, ATTR))
</pre></div>Have local or remote metadata/attributes (mode, UID and GID, size and master version) changed? 
<p>

</div>
</div><p>
<a class="anchor" name="1da61dcc622d7188c533cb41a60e026e"></a><!-- doxytag: member="update.h::METADATA_MASTER_VERSION_CHANGE_P" ref="1da61dcc622d7188c533cb41a60e026e" args="(DENTRY, ATTR)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define METADATA_MASTER_VERSION_CHANGE_P          </td>
          <td>(</td>
          <td class="paramtype">DENTRY,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ATTR&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">&nbsp;&nbsp;&nbsp;(((ATTR).type == FT_REG) &amp;&amp; ((DENTRY)-&gt;fh-&gt;meta.master_version != (ATTR).version))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Did the master version (for regular files) change? 
<p>

</div>
</div><p>
<a class="anchor" name="2a266a04159e641dbf9b073fe30c3b27"></a><!-- doxytag: member="update.h::METADATA_SIZE_CHANGE_P" ref="2a266a04159e641dbf9b073fe30c3b27" args="(ATTR1, ATTR2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define METADATA_SIZE_CHANGE_P          </td>
          <td>(</td>
          <td class="paramtype">ATTR1,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ATTR2&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">&nbsp;&nbsp;&nbsp;(((ATTR1).type == FT_REG) &amp;&amp; ((ATTR1).size != (ATTR2).size))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Are file sizes (for regular files) different? 
<p>

</div>
</div><p>
<a class="anchor" name="2630c17ca8a44d638f8750a4217d5043"></a><!-- doxytag: member="update.h::REINTEGRATE_P" ref="2630c17ca8a44d638f8750a4217d5043" args="(DENTRY, ATTR)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REINTEGRATE_P          </td>
          <td>(</td>
          <td class="paramtype">DENTRY,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ATTR&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Value:</b><div class="fragment"><pre class="fragment">((DENTRY)-&gt;fh-&gt;attr.type == <a class="code" href="zfs-prot_8h.html#14310baebb54dccf1e5234d70de030d54c066b95febbda4a85f3dca06a6f985a">FT_DIR</a>                                      \
   ? (DENTRY)-&gt;fh-&gt;attr.version &gt; (DENTRY)-&gt;fh-&gt;meta.master_version     \
   : ((ATTR).version == (DENTRY)-&gt;fh-&gt;meta.master_version               \
      &amp;&amp; (DENTRY)-&gt;fh-&gt;attr.version &gt; (DENTRY)-&gt;fh-&gt;meta.master_version))
</pre></div>Check whether we should reintegrate a generic file. 
<p>
Reintegrate a directory if the local version has changed since the last time we reintegrated the directory or it was not completely reintegrated. Reintegrate a regular file if remote file was not modified and local file was modified since we reintegrated it last time or it was not completely reintegrated.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>DENTRY</em>&nbsp;</td><td>The dentry of the file to be checked. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ATTR</em>&nbsp;</td><td>The remote attributes of the file. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="4ee1026de0a6ec4670c67d687fd27b40"></a><!-- doxytag: member="update.h::UPDATE_P" ref="4ee1026de0a6ec4670c67d687fd27b40" args="(DENTRY, ATTR)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define UPDATE_P          </td>
          <td>(</td>
          <td class="paramtype">DENTRY,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ATTR&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Value:</b><div class="fragment"><pre class="fragment">(!((DENTRY)-&gt;fh-&gt;meta.flags &amp; <a class="code" href="metadata_8h.html#aa0b32aa8b3bfdc86dc151fcd869b2d4">METADATA_COMPLETE</a>)                           \
   || ((DENTRY)-&gt;fh-&gt;attr.type == <a class="code" href="zfs-prot_8h.html#14310baebb54dccf1e5234d70de030d54c066b95febbda4a85f3dca06a6f985a">FT_DIR</a>                                   \
       ? (ATTR).version &gt; (DENTRY)-&gt;fh-&gt;meta.master_version                \
       : (((DENTRY)-&gt;fh-&gt;attr.version == (DENTRY)-&gt;fh-&gt;meta.master_version \
           &amp;&amp; (ATTR).version &gt; (DENTRY)-&gt;fh-&gt;meta.master_version))))
</pre></div>Check whether we should update a generic file. 
<p>
Update the generic file if it has not been completely updated yet, otherwise update a directory if the remote version has changed since the last time we updated the directory or update a regular file if local file was not modified and remote file was modified since we updated it last time.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>DENTRY</em>&nbsp;</td><td>The dentry of the file to be checked. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ATTR</em>&nbsp;</td><td>The remote attributes of the file. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="cb52b3f1073d3e81b62fbd569e4af4c5"></a><!-- doxytag: member="update.h::ZFS_MODIFIED_BLOCK_SIZE" ref="cb52b3f1073d3e81b62fbd569e4af4c5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ZFS_MODIFIED_BLOCK_SIZE&nbsp;&nbsp;&nbsp;1024          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Maximum block size for reintegrating. 
<p>

</div>
</div><p>
<a class="anchor" name="e14ab5bf63adaa2e8b112fc585004d1c"></a><!-- doxytag: member="update.h::ZFS_UPDATED_BLOCK_SIZE" ref="e14ab5bf63adaa2e8b112fc585004d1c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ZFS_UPDATED_BLOCK_SIZE&nbsp;&nbsp;&nbsp;ZFS_MAXDATA          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Maximum block size for updating. 
<p>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="zfs-prot_8h.html#f31e6b0c0c7b511bdd267bd23ff2a9ab">ZFS_MAXDATA</a> </dd></dl>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="926f28e861dfa653d7f755dd1f17f652"></a><!-- doxytag: member="update.h::delete_tree" ref="926f28e861dfa653d7f755dd1f17f652" args="(internal_dentry dentry, volume vol, bool destroy_dentry, bool journal_p, bool move_to_shadow_p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t delete_tree           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>destroy_dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>journal_p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>move_to_shadow_p</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Delete file/subtree in place of file DENTRY on volume VOL. 
<p>
Uses <a class="el" href="dir_8h.html#2a93962a13067e0eb1e411c1327414ef">recursive_unlink</a> to delete the desired path.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>journal_p</em>&nbsp;</td><td>Add a journal entries to appropriate journals. Passed to <a class="el" href="dir_8h.html#2a93962a13067e0eb1e411c1327414ef">recursive_unlink</a> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>move_to_shadow_p</em>&nbsp;</td><td>Passed to <a class="el" href="dir_8h.html#2a93962a13067e0eb1e411c1327414ef">recursive_unlink</a> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>destroy_dentry</em>&nbsp;</td><td>Passed to <a class="el" href="dir_8h.html#2a93962a13067e0eb1e411c1327414ef">recursive_unlink</a> </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="dd5180f7532813987b3a4e7aab2c7324"></a><!-- doxytag: member="update.h::delete_tree_name" ref="dd5180f7532813987b3a4e7aab2c7324" args="(internal_dentry dir, string *name, volume vol, bool destroy_dentry, bool journal_p, bool move_to_shadow_p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t delete_tree_name           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structstring__def.html">string</a> *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>destroy_dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>journal_p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>move_to_shadow_p</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Delete file NAME in directory DIR on volume VOL. 
<p>
Uses <a class="el" href="dir_8h.html#2a93962a13067e0eb1e411c1327414ef">recursive_unlink</a> to delete the desired path.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>journal_p</em>&nbsp;</td><td>Add a journal entries to appropriate journals. Passed to <a class="el" href="dir_8h.html#2a93962a13067e0eb1e411c1327414ef">recursive_unlink</a> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>move_to_shadow_p</em>&nbsp;</td><td>Passed to <a class="el" href="dir_8h.html#2a93962a13067e0eb1e411c1327414ef">recursive_unlink</a> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>destroy_dentry</em>&nbsp;</td><td>Passed to <a class="el" href="dir_8h.html#2a93962a13067e0eb1e411c1327414ef">recursive_unlink</a> </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="070edc4f16621981f4a856c1dfd27b76"></a><!-- doxytag: member="update.h::get_blocks_for_updating" ref="070edc4f16621981f4a856c1dfd27b76" args="(internal_fh fh, uint64_t start, uint64_t end, varray *blocks)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void get_blocks_for_updating           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__fh__def.html">internal_fh</a>&nbsp;</td>
          <td class="paramname"> <em>fh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvarray__def.html">varray</a> *&nbsp;</td>
          <td class="paramname"> <em>blocks</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Determine, which blocks in specified part of the file need to be updated. 
<p>
Get blocks of file FH from interval [START, END) which need to be updated and store them to BLOCKS. 
</div>
</div><p>
<a class="anchor" name="d9a6c0040f592fdca647ae1c6134eeff"></a><!-- doxytag: member="update.h::resolve_conflict_delete_local" ref="d9a6c0040f592fdca647ae1c6134eeff" args="(dir_op_res *res, internal_dentry dir, zfs_fh *dir_fh, string *name, zfs_fh *local_fh, zfs_fh *remote_fh, volume vol)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t resolve_conflict_delete_local           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdir__op__res__def.html">dir_op_res</a> *&nbsp;</td>
          <td class="paramname"> <em>res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structzfs__fh__def.html">zfs_fh</a> *&nbsp;</td>
          <td class="paramname"> <em>dir_fh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structstring__def.html">string</a> *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structzfs__fh__def.html">zfs_fh</a> *&nbsp;</td>
          <td class="paramname"> <em>local_fh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structzfs__fh__def.html">zfs_fh</a> *&nbsp;</td>
          <td class="paramname"> <em>remote_fh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Resolve conflict by deleting local file. 
<p>
Resolve conflict by deleting local file NAME with local file handle LOCAL_FH and remote file handle REMOTE_FH in directory DIR with file handle DIR_FH on volume VOL. Store the info about deleted file into RES. 
</div>
</div><p>
<a class="anchor" name="9f56b919ffd4b001fcba2a5d52b443a4"></a><!-- doxytag: member="update.h::resolve_conflict_delete_remote" ref="9f56b919ffd4b001fcba2a5d52b443a4" args="(volume vol, internal_dentry dir, string *name, zfs_fh *remote_fh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t resolve_conflict_delete_remote           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structstring__def.html">string</a> *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structzfs__fh__def.html">zfs_fh</a> *&nbsp;</td>
          <td class="paramname"> <em>remote_fh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Resolve conflict by deleting remote file NAME with file handle REMOTE_FH in directory DIR on volume VOL. 
<p>

</div>
</div><p>
<a class="anchor" name="3d750f23c5ae2d66320c6f5cf96c5346"></a><!-- doxytag: member="update.h::resolve_conflict_discard_local" ref="3d750f23c5ae2d66320c6f5cf96c5346" args="(zfs_fh *conflict_fh, internal_dentry local, internal_dentry remote, volume vol)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t resolve_conflict_discard_local           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structzfs__fh__def.html">zfs_fh</a> *&nbsp;</td>
          <td class="paramname"> <em>conflict_fh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>remote</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Discard changes to local file LOCAL which is in conflict with REMOTE on volume VOL. 
<p>
CONFLICT_FH is a file handle of the cnflict directory containing these two files. 
</div>
</div><p>
<a class="anchor" name="18bcb8f6f49657c49a5a34baa0c62ee3"></a><!-- doxytag: member="update.h::resolve_conflict_discard_remote" ref="18bcb8f6f49657c49a5a34baa0c62ee3" args="(zfs_fh *conflict_fh, internal_dentry local, internal_dentry remote, volume vol)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t resolve_conflict_discard_remote           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structzfs__fh__def.html">zfs_fh</a> *&nbsp;</td>
          <td class="paramname"> <em>conflict_fh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>remote</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Discard changes to remote file REMOTE which is in conflict with LOCAL on volume VOL. 
<p>
CONFLICT_FH is a file handle of the cnflict directory containing these two files. 
</div>
</div><p>
<a class="anchor" name="3206db6ce423b4e20a7c1e2fb7711cdb"></a><!-- doxytag: member="update.h::update" ref="3206db6ce423b4e20a7c1e2fb7711cdb" args="(volume vol, internal_dentry dentry, zfs_fh *fh, fattr *attr, int how)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t update           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a>&nbsp;</td>
          <td class="paramname"> <em>vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a>&nbsp;</td>
          <td class="paramname"> <em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structzfs__fh__def.html">zfs_fh</a> *&nbsp;</td>
          <td class="paramname"> <em>fh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfattr__def.html">fattr</a> *&nbsp;</td>
          <td class="paramname"> <em>attr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>how</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Reintegrate or update generic file. 
<p>
Reintegrate or update generic file DENTRY on volume VOL with file handle FH and remote file attributes ATTR.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>how</em>&nbsp;</td><td>What should be updated if needed. Bitwise-or combination of <a class="el" href="fh_8h.html#eca2f9dacee337a556efbcd6ec6b1706">IFH_UPDATE</a> for file/dir contents update, <a class="el" href="fh_8h.html#f241099b7d2ef2f0d2bb2bc8239e493b">IFH_REINTEGRATE</a> for reintegration and <a class="el" href="fh_8h.html#293ee415797bb76a692ead8a2d9f506e">IFH_METADATA</a> for metadata (mode, uid, gid), including file size and master version for regular files. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="be6f099b6a2fcc2abc9f8fecb5890202"></a><!-- doxytag: member="update.h::update_cap_if_needed" ref="be6f099b6a2fcc2abc9f8fecb5890202" args="(internal_cap *icapp, volume *volp, internal_dentry *dentryp, virtual_dir *vdp, zfs_cap *cap, bool put_cap, int what)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t update_cap_if_needed           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinternal__cap__def.html">internal_cap</a> *&nbsp;</td>
          <td class="paramname"> <em>icapp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a> *&nbsp;</td>
          <td class="paramname"> <em>volp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a> *&nbsp;</td>
          <td class="paramname"> <em>dentryp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvirtual__dir__def.html">virtual_dir</a> *&nbsp;</td>
          <td class="paramname"> <em>vdp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structzfs__cap__def.html">zfs_cap</a> *&nbsp;</td>
          <td class="paramname"> <em>cap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>put_cap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>what</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Update generic file DENTRY on volume VOL associated with capability ICAP if needed. 
<p>
Do WHAT we are asked to do. 
</div>
</div><p>
<a class="anchor" name="19341698513037bdd134d627755ff3b7"></a><!-- doxytag: member="update.h::update_cleanup" ref="19341698513037bdd134d627755ff3b7" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void update_cleanup           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Destroy <a class="el" href="update_8h.html#042a22003c0b9b8c3d97d4bc07a4f98c" title="Pool of update threads.">update_pool</a> and cleanup the mutexes and queues for updating. 
<p>

</div>
</div><p>
<a class="anchor" name="aea7cdd865f077cb639f4983e4f628e9"></a><!-- doxytag: member="update.h::update_fh_if_needed" ref="aea7cdd865f077cb639f4983e4f628e9" args="(volume *volp, internal_dentry *dentryp, zfs_fh *fh, int what)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t update_fh_if_needed           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a> *&nbsp;</td>
          <td class="paramname"> <em>volp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a> *&nbsp;</td>
          <td class="paramname"> <em>dentryp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structzfs__fh__def.html">zfs_fh</a> *&nbsp;</td>
          <td class="paramname"> <em>fh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>what</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Update generic file DENTRY with file handle FH on volume VOL if needed and wanted. 
<p>
Uses <a class="el" href="update_8c.html#8c3a739e65554ced54ed933826f6c123" title="Determine if and how the local file should be updated.">update_p()</a> to determine what should be updated and performs the intersetion of the result and WHAT via <a class="el" href="update_8c.html#3206db6ce423b4e20a7c1e2fb7711cdb" title="Reintegrate or update generic file.">update()</a>.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>what</em>&nbsp;</td><td>What should be updated if needed. Bitwise-or combination of <a class="el" href="fh_8h.html#eca2f9dacee337a556efbcd6ec6b1706">IFH_UPDATE</a> for file/dir contents update, <a class="el" href="fh_8h.html#f241099b7d2ef2f0d2bb2bc8239e493b">IFH_REINTEGRATE</a> for reintegration and <a class="el" href="fh_8h.html#293ee415797bb76a692ead8a2d9f506e">IFH_METADATA</a> for metadata (mode, uid, gid), including file size and master version for regular files. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="d51a0b4039b35ba2caeb35402d04c4c8"></a><!-- doxytag: member="update.h::update_fh_if_needed_2" ref="d51a0b4039b35ba2caeb35402d04c4c8" args="(volume *volp, internal_dentry *dentryp, internal_dentry *dentry2p, zfs_fh *fh, zfs_fh *fh2, int what)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t update_fh_if_needed_2           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structvolume__def.html">volume</a> *&nbsp;</td>
          <td class="paramname"> <em>volp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a> *&nbsp;</td>
          <td class="paramname"> <em>dentryp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinternal__dentry__def.html">internal_dentry</a> *&nbsp;</td>
          <td class="paramname"> <em>dentry2p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structzfs__fh__def.html">zfs_fh</a> *&nbsp;</td>
          <td class="paramname"> <em>fh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structzfs__fh__def.html">zfs_fh</a> *&nbsp;</td>
          <td class="paramname"> <em>fh2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>what</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Update generic file DENTRY on volume VOL if needed. 
<p>
DENTRY and DENTRY2 are locked before and after this macro. DENTRY2 might be deleted in update. Do WHAT we are asked to do. 
</div>
</div><p>
<a class="anchor" name="03d0d58bd98ce17acc4958ca72fa5626"></a><!-- doxytag: member="update.h::update_file_blocks" ref="03d0d58bd98ce17acc4958ca72fa5626" args="(zfs_cap *cap, varray *blocks, bool modified, bool slow)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t update_file_blocks           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structzfs__cap__def.html">zfs_cap</a> *&nbsp;</td>
          <td class="paramname"> <em>cap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvarray__def.html">varray</a> *&nbsp;</td>
          <td class="paramname"> <em>blocks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>modified</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>slow</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Update blocks of local file according to remote file. 
<p>
Prepares the md5sum arguments for <a class="el" href="update_8c.html#d3c97f646655d5e965e3c279cb38f922" title="Update parts of file from remote file.">update_file_blocks_1</a> and calls it.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cap</em>&nbsp;</td><td>Capability of the local file. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>blocks</em>&nbsp;</td><td>Blocks to be updated. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>modified</em>&nbsp;</td><td>Flag saying the local file has been modified. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>slow</em>&nbsp;</td><td>Just passed to <a class="el" href="update_8c.html#d3c97f646655d5e965e3c279cb38f922" title="Update parts of file from remote file.">update_file_blocks_1</a> </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="6e55fb2c33d8aba365ce6cf0592ae2fb"></a><!-- doxytag: member="update.h::update_start" ref="6e55fb2c33d8aba365ce6cf0592ae2fb" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool update_start           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialize the mutexes and queues for updating, and create the <a class="el" href="update_8h.html#042a22003c0b9b8c3d97d4bc07a4f98c" title="Pool of update threads.">update_pool</a>. 
<p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="042a22003c0b9b8c3d97d4bc07a4f98c"></a><!-- doxytag: member="update.h::update_pool" ref="042a22003c0b9b8c3d97d4bc07a4f98c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structthread__pool__def.html">thread_pool</a> <a class="el" href="update_8h.html#042a22003c0b9b8c3d97d4bc07a4f98c">update_pool</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Pool of update threads. 
<p>

</div>
</div><p>
<a class="anchor" name="a148194f9fdacbf90ab1965422718cfc"></a><!-- doxytag: member="update.h::update_queue" ref="a148194f9fdacbf90ab1965422718cfc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structqueue__def.html">queue</a> <a class="el" href="update_8h.html#a148194f9fdacbf90ab1965422718cfc">update_queue</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Queue of file handles for updating or reintegrating. 
<p>
Protected by <a class="el" href="update_8c.html#43a4cc01a3da1beb214263186d1c6225" title="Mutex for update_queue.">update_queue_mutex</a>. File handles are processed by threads in <a class="el" href="update_8h.html#042a22003c0b9b8c3d97d4bc07a4f98c" title="Pool of update threads.">update_pool</a> 
</div>
</div><p>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Aug 6 00:39:38 2010 for zlomekFS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
