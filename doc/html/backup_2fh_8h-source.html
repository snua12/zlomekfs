<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>zlomekFS: fh.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul>
</div>
<div class="nav">
<a class="el" href="dir_21c430ab3b7001ae39034eae6f7edf71.html">zfsd</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_ac94841c51e61ddc7acc56e12a771012.html">backup</a></div>
<h1>backup/fh.h</h1><a href="backup_2fh_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00004"></a>00004 <span class="comment">/* Copyright (C) 2003, 2004, 2010 Josef Zlomek, Rastislav Wartiak</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">   This file is part of ZFS.</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">   ZFS is free software; you can redistribute it and/or modify it</span>
<a name="l00009"></a>00009 <span class="comment">   under the terms of the GNU General Public License as published by</span>
<a name="l00010"></a>00010 <span class="comment">   the Free Software Foundation; either version 2, or (at your option)</span>
<a name="l00011"></a>00011 <span class="comment">   any later version.</span>
<a name="l00012"></a>00012 <span class="comment"></span>
<a name="l00013"></a>00013 <span class="comment">   ZFS is distributed in the hope that it will be useful, but WITHOUT</span>
<a name="l00014"></a>00014 <span class="comment">   ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
<a name="l00015"></a>00015 <span class="comment">   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public</span>
<a name="l00016"></a>00016 <span class="comment">   License for more details.</span>
<a name="l00017"></a>00017 <span class="comment"></span>
<a name="l00018"></a>00018 <span class="comment">   You should have received a copy of the GNU General Public License along with</span>
<a name="l00019"></a>00019 <span class="comment">   ZFS; see the file COPYING.  If not, write to the Free Software Foundation,</span>
<a name="l00020"></a>00020 <span class="comment">   59 Temple Place - Suite 330, Boston, MA 02111-1307, USA;</span>
<a name="l00021"></a>00021 <span class="comment">   or download it from http://www.gnu.org/licenses/gpl.html */</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#ifndef FH_H</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span><span class="preprocessor">#define FH_H</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span>
<a name="l00027"></a><a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">00027</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structvolume__def.html" title="Volume description.">volume_def</a> *<a class="code" href="structvolume__def.html" title="Volume description.">volume</a>;
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#include "<a class="code" href="backup_2system_8h.html" title="Environment definitions.">system.h</a>"</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;inttypes.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;time.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include "<a class="code" href="backup_2pthread-wrapper_8h.html" title="Wrappers for pthread_* functions and related data.">pthread-wrapper.h</a>"</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include "<a class="code" href="backup_2memory_8h.html" title="Memory management functions.">memory.h</a>"</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include "<a class="code" href="backup_2crc32_8h.html" title="Definitions for 32-bit CRC.">crc32.h</a>"</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include "<a class="code" href="backup_2hashtab_8h.html" title="An expandable hash tables datatype.">hashtab.h</a>"</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include "<a class="code" href="backup_2varray_8h.html" title="Variable-sized array datatype.">varray.h</a>"</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include "<a class="code" href="backup_2zfs-prot_8h.html" title="ZFS protocol.">zfs-prot.h</a>"</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include "<a class="code" href="backup_2util_8h.html" title="Helper functions.">util.h</a>"</span>
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="backup_2fh_8h.html#e3557cdf77e2a6c527c14cbde75bdfeb">00041</a> <span class="preprocessor">#define VIRTUAL_DEVICE 1        </span><span class="comment">/* Device number of device with virtual</span>
<a name="l00042"></a>00042 <span class="comment">                                   directories */</span>
<a name="l00043"></a><a class="code" href="backup_2fh_8h.html#6fefb99a279054362ece826744775d7d">00043</a> <span class="preprocessor">#define ROOT_INODE 1            </span><span class="comment">/* Inode number of the root dir of ZFS */</span>
<a name="l00044"></a>00044 
<a name="l00046"></a><a class="code" href="backup_2fh_8h.html#10c695978f398ac53caeb45e212222b5">00046</a> <span class="preprocessor">#define MAX_LOCKED_FILE_HANDLES 2</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>
<a name="l00049"></a><a class="code" href="backup_2fh_8h.html#618c1ab77921012a9745c6acd64336e2">00049</a> <span class="preprocessor">#define VIRTUAL_FH_P(FH) ((FH).vid == VOLUME_ID_VIRTUAL                 \</span>
<a name="l00050"></a>00050 <span class="preprocessor">                          &amp;&amp; (FH).sid == NODE_NONE)</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span>
<a name="l00054"></a><a class="code" href="backup_2fh_8h.html#356d00622b4f9aff79163b43964b67aa">00054</a> <span class="preprocessor">#define NON_EXIST_FH_P(FH) ((FH).vid == VOLUME_ID_VIRTUAL               \</span>
<a name="l00055"></a>00055 <span class="preprocessor">                            &amp;&amp; (FH).sid != NODE_NONE)</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>
<a name="l00058"></a><a class="code" href="backup_2fh_8h.html#bc929e1f0b7f521cf1b4557c081673ad">00058</a> <span class="preprocessor">#define CONFLICT_DIR_P(FH) ((FH).sid == NODE_NONE                       \</span>
<a name="l00059"></a>00059 <span class="preprocessor">                            &amp;&amp; (FH).vid != VOLUME_ID_VIRTUAL)</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span>
<a name="l00062"></a><a class="code" href="backup_2fh_8h.html#f0835cd1757d931aea9a45625bda1705">00062</a> <span class="preprocessor">#define REGULAR_FH_P(FH) ((FH).sid != NODE_NONE                         \</span>
<a name="l00063"></a>00063 <span class="preprocessor">                          &amp;&amp; (FH).vid != VOLUME_ID_VIRTUAL)</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span>
<a name="l00066"></a><a class="code" href="backup_2fh_8h.html#0ba787a6080e24635d7d35737c62b947">00066</a> <span class="preprocessor">#define LOCAL_VOLUME_ROOT_P(DENTRY)                                     \</span>
<a name="l00067"></a>00067 <span class="preprocessor">  ((DENTRY)-&gt;parent == NULL                                             \</span>
<a name="l00068"></a>00068 <span class="preprocessor">   || ((DENTRY)-&gt;parent-&gt;parent == NULL                                 \</span>
<a name="l00069"></a>00069 <span class="preprocessor">       &amp;&amp; CONFLICT_DIR_P ((DENTRY)-&gt;parent-&gt;fh-&gt;local_fh)))</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span>
<a name="l00074"></a><a class="code" href="backup_2fh_8h.html#80ac3e5d2fbf319e8147aa344e40a957">00074</a> <span class="preprocessor">#define SPECIAL_NAME_P(NAME, ALWAYS)                                    \</span>
<a name="l00075"></a>00075 <span class="preprocessor">  (strcmp ((NAME), ".zfs") == 0                                         \</span>
<a name="l00076"></a>00076 <span class="preprocessor">   || (strcmp ((NAME), ".shadow") == 0                                  \</span>
<a name="l00077"></a>00077 <span class="preprocessor">       &amp;&amp; ((ALWAYS) || !request_from_this_node ())))</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span>
<a name="l00082"></a><a class="code" href="backup_2fh_8h.html#84f5ace811b73705855225e53e89e38a">00082</a> <span class="preprocessor">#define SPECIAL_DIR_P(DIR, NAME, ALWAYS)                                \</span>
<a name="l00083"></a>00083 <span class="preprocessor">  (LOCAL_VOLUME_ROOT_P (DIR) &amp;&amp; SPECIAL_NAME_P ((NAME), (ALWAYS)))</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span>
<a name="l00086"></a><a class="code" href="backup_2fh_8h.html#3a7c2732eb68591a5a08e92d54942959">00086</a> <span class="preprocessor">#define zfs_fh_undefine(FH) (sizeof (FH) == sizeof (zfs_fh)             \</span>
<a name="l00087"></a>00087 <span class="preprocessor">                             ? memset (&amp;(FH), -1, sizeof (zfs_fh))      \</span>
<a name="l00088"></a>00088 <span class="preprocessor">                             : (abort (), (void *) 0))</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span>
<a name="l00091"></a><a class="code" href="backup_2fh_8h.html#45eda11fa1f69f58d21589cacb9f8524">00091</a> <span class="preprocessor">#define zfs_fh_undefined(FH) (bytecmp (&amp;(FH), -1, sizeof (zfs_fh)))</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>
<a name="l00094"></a><a class="code" href="backup_2fh_8h.html#eee8b8ae311510596a700ed184d7495d">00094</a> <span class="preprocessor">#define ZFS_FH_HASH(FH) (crc32_buffer ((FH), sizeof (zfs_fh)))</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span>
<a name="l00097"></a><a class="code" href="backup_2fh_8h.html#5ba9521b6a3f1ac6bdfcc70359eac2ae">00097</a> <span class="preprocessor">#define ZFS_FH_EQ(FH1, FH2) ((FH1).ino == (FH2).ino                     \</span>
<a name="l00098"></a>00098 <span class="preprocessor">                             &amp;&amp; (FH1).dev == (FH2).dev                  \</span>
<a name="l00099"></a>00099 <span class="preprocessor">                             &amp;&amp; (FH1).vid == (FH2).vid                  \</span>
<a name="l00100"></a>00100 <span class="preprocessor">                             &amp;&amp; (FH1).sid == (FH2).sid                  \</span>
<a name="l00101"></a>00101 <span class="preprocessor">                             &amp;&amp; (FH1).gen == (FH2).gen)</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span>
<a name="l00104"></a><a class="code" href="backup_2fh_8h.html#6ba569b2f54503f3debfa83db858a43d">00104</a> <span class="preprocessor">#define INTERNAL_DENTRY_HASH(D)                                         \</span>
<a name="l00105"></a>00105 <span class="preprocessor">  (ZFS_FH_HASH (&amp;(D)-&gt;fh-&gt;local_fh))</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span>
<a name="l00108"></a><a class="code" href="backup_2fh_8h.html#71ca08ee8e215859b964ca0bf5402a1a">00108</a> <span class="preprocessor">#define INTERNAL_DENTRY_HASH_NAME(D)                                    \</span>
<a name="l00109"></a>00109 <span class="preprocessor">  (crc32_update (crc32_buffer ((D)-&gt;name.str, (D)-&gt;name.len),           \</span>
<a name="l00110"></a>00110 <span class="preprocessor">                 &amp;(D)-&gt;parent-&gt;fh-&gt;local_fh, sizeof (zfs_fh)))</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span>
<a name="l00113"></a><a class="code" href="backup_2fh_8h.html#3a575e2d62433510248c737e544ead46">00113</a> <span class="preprocessor">#define INTERNAL_FH_HAS_LOCAL_PATH(FH)                                  \</span>
<a name="l00114"></a>00114 <span class="preprocessor">  ((FH)-&gt;local_fh.sid == this_node-&gt;id                                  \</span>
<a name="l00115"></a>00115 <span class="preprocessor">   &amp;&amp; (FH)-&gt;local_fh.vid != VOLUME_ID_VIRTUAL)</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span>
<a name="l00117"></a>00117 <span class="preprocessor">#ifdef VERSIONS</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span>
<a name="l00119"></a><a class="code" href="backup_2fh_8h.html#630f9515ffa050ce69b097cb3d9c7f29">00119</a> <span class="preprocessor">#define INTERNAL_FH_VERSION_OPEN(FH)          \</span>
<a name="l00120"></a>00120 <span class="preprocessor">  ((FH)-&gt;version_fd &gt; 0)</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00122"></a>00122 <span class="preprocessor"></span>
<a name="l00124"></a><a class="code" href="backup_2fh_8h.html#83bff87dfdf3d97dc7d9948c0355aa48">00124</a> <span class="preprocessor">#define LEVEL_UNLOCKED  0</span>
<a name="l00125"></a><a class="code" href="backup_2fh_8h.html#14129519c52c799a1cdb45647d2cd97a">00125</a> <span class="preprocessor"></span><span class="preprocessor">#define LEVEL_SHARED    1</span>
<a name="l00126"></a><a class="code" href="backup_2fh_8h.html#0e1cec557a08244fe6975c3cccd75f3e">00126</a> <span class="preprocessor"></span><span class="preprocessor">#define LEVEL_EXCLUSIVE 2</span>
<a name="l00127"></a>00127 <span class="preprocessor"></span>
<a name="l00129"></a><a class="code" href="backup_2fh_8h.html#13cc7e01096f904e62218994f9699cce">00129</a> <span class="preprocessor">#define CONFLICT_LOCAL_EXISTS   1</span>
<a name="l00130"></a><a class="code" href="backup_2fh_8h.html#4a6db5a1621b59ff4a7866c3bcfa5aa5">00130</a> <span class="preprocessor"></span><span class="preprocessor">#define CONFLICT_REMOTE_EXISTS  2</span>
<a name="l00131"></a><a class="code" href="backup_2fh_8h.html#73796db08e2af9c903842a91f5c8f655">00131</a> <span class="preprocessor"></span><span class="preprocessor">#define CONFLICT_BOTH_EXIST     (CONFLICT_LOCAL_EXISTS | CONFLICT_REMOTE_EXISTS)</span>
<a name="l00132"></a>00132 <span class="preprocessor"></span>
<a name="l00134"></a><a class="code" href="backup_2fh_8h.html#74fae3e6dfb05779e3168d9c9f1427e2">00134</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structinternal__fh__def.html" title="Internal information about file handle.">internal_fh_def</a> *<a class="code" href="structinternal__fh__def.html" title="Internal information about file handle.">internal_fh</a>;
<a name="l00135"></a><a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">00135</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structinternal__dentry__def.html" title="Internal directory entry.">internal_dentry_def</a> *<a class="code" href="structinternal__dentry__def.html" title="Internal directory entry.">internal_dentry</a>;
<a name="l00136"></a><a class="code" href="backup_2fh_8h.html#f5a7b3dc50ac942780765d4f924961aa">00136</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structvirtual__dir__def.html" title="Virtual directory (element of mount tree).">virtual_dir_def</a> *<a class="code" href="structvirtual__dir__def.html" title="Virtual directory (element of mount tree).">virtual_dir</a>;
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="preprocessor">#include "<a class="code" href="backup_2fibheap_8h.html" title="A Fibonacci heap datatype.">fibheap.h</a>"</span>
<a name="l00139"></a>00139 <span class="preprocessor">#include "<a class="code" href="backup_2interval_8h.html" title="Disjoint interval tree datatype.">interval.h</a>"</span>
<a name="l00140"></a>00140 <span class="preprocessor">#include "<a class="code" href="backup_2journal_8h.html" title="Journal datatype.">journal.h</a>"</span>
<a name="l00141"></a>00141 <span class="preprocessor">#include "<a class="code" href="backup_2volume_8h.html" title="Volume functions.">volume.h</a>"</span>
<a name="l00142"></a>00142 <span class="preprocessor">#include "<a class="code" href="backup_2cap_8h.html" title="Capability functions.">cap.h</a>"</span>
<a name="l00143"></a>00143 <span class="preprocessor">#include "<a class="code" href="backup_2metadata_8h.html" title="Metadata management functions.">metadata.h</a>"</span>
<a name="l00144"></a>00144 <span class="preprocessor">#include "<a class="code" href="backup_2version_8h.html" title="Functions for file versioning.">version.h</a>"</span>
<a name="l00145"></a>00145 
<a name="l00147"></a>00147 <span class="keyword">struct </span><a class="code" href="structinternal__fh__def.html" title="Internal information about file handle.">internal_fh_def</a>
<a name="l00148"></a>00148 {
<a name="l00149"></a>00149 <span class="preprocessor">#ifdef ENABLE_CHECKING</span>
<a name="l00150"></a>00150 <span class="preprocessor"></span>  <span class="keywordtype">long</span> unused0;
<a name="l00151"></a>00151   <span class="keywordtype">long</span> unused1;
<a name="l00152"></a>00152 <span class="preprocessor">#endif</span>
<a name="l00153"></a><a class="code" href="structinternal__fh__def.html#ac461353caef496ce9b1f6fa580352ef">00153</a> <span class="preprocessor"></span><span class="comment">//NOTE: why uses pthread_mutex, when have zfs_mutex?</span>
<a name="l00154"></a><a class="code" href="structinternal__fh__def.html#f96a0f0b272156c449239bb281ea76a4">00154</a>   pthread_mutex_t <a class="code" href="structinternal__fh__def.html#ac461353caef496ce9b1f6fa580352ef">mutex</a>;
<a name="l00155"></a>00155   pthread_cond_t <a class="code" href="structinternal__fh__def.html#f96a0f0b272156c449239bb281ea76a4">cond</a>;
<a name="l00156"></a>00156 
<a name="l00158"></a>00158   <a class="code" href="structzfs__fh__def.html">zfs_fh</a> <a class="code" href="structinternal__fh__def.html#522f5a91d111ac4c94c95dc087c573c1">local_fh</a>;
<a name="l00159"></a>00159 
<a name="l00161"></a>00161   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structinternal__fh__def.html#c39ba305447ba46f8637c2081f89f594">ndentries</a>;
<a name="l00162"></a>00162 
<a name="l00164"></a>00164   <a class="code" href="structfattr__def.html">fattr</a> <a class="code" href="structinternal__fh__def.html#58ee90571ad50b42ca44bad2f74cf6af">attr</a>;
<a name="l00165"></a>00165 
<a name="l00167"></a>00167   <a class="code" href="structmetadata__def.html" title="Metadata for file.">metadata</a> <a class="code" href="structinternal__fh__def.html#51c886550496c5e5064955bbbcfb57d5">meta</a>;
<a name="l00168"></a>00168 
<a name="l00170"></a>00170   <a class="code" href="structvarray__def.html" title="Variable-sized array.">varray</a> <a class="code" href="structinternal__fh__def.html#6c82f7bf71d51433d7188748a46dc132">subdentries</a>;
<a name="l00171"></a>00171 
<a name="l00173"></a>00173   <a class="code" href="structinternal__cap__def.html" title="In-memory capability structure.">internal_cap</a> <a class="code" href="structinternal__fh__def.html#53a71ea9ada73382ebca97227b1062bd">cap</a>;
<a name="l00174"></a>00174 
<a name="l00176"></a>00176   <a class="code" href="structinterval__tree__def.html" title="The interval tree.">interval_tree</a> <a class="code" href="structinternal__fh__def.html#232341bf07c2d3b7eb834dd95685a472">updated</a>;
<a name="l00177"></a>00177 
<a name="l00179"></a>00179   <a class="code" href="structinterval__tree__def.html" title="The interval tree.">interval_tree</a> <a class="code" href="structinternal__fh__def.html#1e721fb709ce786cc1623972aa7014c8">modified</a>;
<a name="l00180"></a>00180 
<a name="l00182"></a>00182   <a class="code" href="structjournal__def.html" title="Journal datatype.">journal_t</a> <a class="code" href="structinternal__fh__def.html#8e750a2b4249fdb713e653d1e41b25c8">journal</a>;
<a name="l00183"></a>00183 
<a name="l00185"></a>00185   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structinternal__fh__def.html#5ceb8a2bc2653dd90bf900deb54d2d3e">interval_tree_users</a>;
<a name="l00186"></a>00186 
<a name="l00188"></a>00188   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structinternal__fh__def.html#9a709fd23f2db51b5e020eadeb878f62">level</a>;
<a name="l00189"></a>00189 
<a name="l00191"></a>00191   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structinternal__fh__def.html#8e555cde60b7a908be21a8d247866e58">users</a>;
<a name="l00192"></a>00192 
<a name="l00194"></a>00194   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structinternal__fh__def.html#d7c012124fa3a02510e7f45acff3a417">id2assign</a>;
<a name="l00195"></a>00195 
<a name="l00197"></a>00197   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structinternal__fh__def.html#4a344501244c1e7878c1897524da5670">id2run</a>;
<a name="l00198"></a>00198 
<a name="l00200"></a>00200   <span class="keywordtype">int</span> <a class="code" href="structinternal__fh__def.html#e3b1ba9b56d9e49844ced211cc6fa954">fd</a>;
<a name="l00201"></a>00201 
<a name="l00203"></a>00203   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structinternal__fh__def.html#905b5add51f19286c14ee3290b92c282">generation</a>;
<a name="l00204"></a>00204 
<a name="l00206"></a>00206   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structinternal__fh__def.html#e15077e765f23a9405f1f2511fa51547">flags</a>;
<a name="l00207"></a>00207 
<a name="l00209"></a>00209   uint32_t <a class="code" href="structinternal__fh__def.html#fe62c1a8aad86ed97c6bca1fd4fa9a96">reintegrating_sid</a>;
<a name="l00210"></a>00210 
<a name="l00212"></a>00212   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structinternal__fh__def.html#0328a197ee9997d4de19b53876d9df7c">reintegrating_generation</a>;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 <span class="preprocessor">#ifdef VERSIONS</span>
<a name="l00215"></a><a class="code" href="structinternal__fh__def.html#692658093d8e406d0ffa6ab6c15f3e10">00215</a> <span class="preprocessor"></span>
<a name="l00216"></a>00216   <span class="keywordtype">int</span> <a class="code" href="structinternal__fh__def.html#692658093d8e406d0ffa6ab6c15f3e10">version_fd</a>;
<a name="l00217"></a>00217 
<a name="l00219"></a>00219   <span class="keywordtype">char</span> *<a class="code" href="structinternal__fh__def.html#5cb757a958f5c9681e2100431c34e460">version_path</a>;
<a name="l00220"></a>00220 
<a name="l00222"></a>00222   <span class="keywordtype">bool</span> <a class="code" href="structinternal__fh__def.html#0d71049ac9bd0f22c7dd8c0010dc3dee">file_truncated</a>;
<a name="l00223"></a>00223 
<a name="l00224"></a><a class="code" href="structinternal__fh__def.html#4c4379e70eaccd628ed28af209212be8">00224</a>   <span class="comment">/* File size when the file was opened.  */</span>
<a name="l00225"></a>00225   uint64_t <a class="code" href="structinternal__fh__def.html#4c4379e70eaccd628ed28af209212be8">marked_size</a>;
<a name="l00226"></a>00226 
<a name="l00228"></a>00228   <a class="code" href="structinterval__tree__def.html" title="The interval tree.">interval_tree</a> <a class="code" href="structinternal__fh__def.html#0ce6cc819155cbc876d0a76cc406f7cf">versioned</a>;
<a name="l00229"></a>00229 
<a name="l00231"></a>00231   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structinternal__fh__def.html#a6700005363d0b70215052897f56cef6">version_interval_tree_users</a>;
<a name="l00232"></a>00232 
<a name="l00233"></a><a class="code" href="structinternal__fh__def.html#7510c754c2c50939159c6d5e87125161">00233</a>   <span class="comment">/* List of intervals for open version file.  */</span>
<a name="l00234"></a><a class="code" href="structinternal__fh__def.html#141866f212af86c1146c53c0282ae1d2">00234</a>   <a class="code" href="structversion__item__def.html">version_item</a> *<a class="code" href="structinternal__fh__def.html#7510c754c2c50939159c6d5e87125161">version_list</a>;
<a name="l00235"></a>00235   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structinternal__fh__def.html#141866f212af86c1146c53c0282ae1d2">version_list_length</a>;
<a name="l00236"></a>00236 <span class="preprocessor">#endif</span>
<a name="l00237"></a>00237 <span class="preprocessor"></span>};
<a name="l00238"></a>00238 
<a name="l00240"></a><a class="code" href="backup_2fh_8h.html#f241099b7d2ef2f0d2bb2bc8239e493b">00240</a> <span class="preprocessor">#define IFH_UPDATE      1</span>
<a name="l00241"></a><a class="code" href="backup_2fh_8h.html#293ee415797bb76a692ead8a2d9f506e">00241</a> <span class="preprocessor"></span><span class="preprocessor">#define IFH_REINTEGRATE 2</span>
<a name="l00242"></a><a class="code" href="backup_2fh_8h.html#357e169f8564a9108fd58275cab53d18">00242</a> <span class="preprocessor"></span><span class="preprocessor">#define IFH_METADATA    4</span>
<a name="l00243"></a><a class="code" href="backup_2fh_8h.html#18cc368ffb4156c3ddbc325b60552f5e">00243</a> <span class="preprocessor"></span><span class="preprocessor">#define IFH_ALL_UPDATE  (IFH_UPDATE | IFH_REINTEGRATE | IFH_METADATA)</span>
<a name="l00244"></a><a class="code" href="backup_2fh_8h.html#05b16e73c3a4076656ae442084405d4e">00244</a> <span class="preprocessor"></span><span class="preprocessor">#define IFH_ENQUEUED    8</span>
<a name="l00245"></a>00245 <span class="preprocessor"></span><span class="preprocessor">#define IFH_REINTEGRATING 16</span>
<a name="l00246"></a>00246 <span class="preprocessor"></span>
<a name="l00248"></a>00248 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structlock__info__def.html" title="Information about locked dentries by current thread.">lock_info_def</a>
<a name="l00249"></a><a class="code" href="structlock__info__def.html#fb457cfd9e0336e90f14fb909902c84e">00249</a> {
<a name="l00250"></a><a class="code" href="structlock__info__def.html#d24a96cd7c2565ac0c84434738f462bb">00250</a>   <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> <a class="code" href="structlock__info__def.html#fb457cfd9e0336e90f14fb909902c84e">dentry</a>;       
<a name="l00251"></a>00251   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structlock__info__def.html#d24a96cd7c2565ac0c84434738f462bb">level</a>;           
<a name="l00252"></a>00252 } <a class="code" href="structlock__info__def.html" title="Information about locked dentries by current thread.">lock_info</a>;
<a name="l00253"></a>00253 
<a name="l00255"></a>00255 <span class="keyword">struct </span><a class="code" href="structinternal__dentry__def.html" title="Internal directory entry.">internal_dentry_def</a>
<a name="l00256"></a>00256 {
<a name="l00257"></a>00257   <span class="comment">/* Mutex is not needed here because we can use FH-&gt;MUTEX</span>
<a name="l00258"></a>00258 <span class="comment">     because FH is constant for each internal dentry.  */</span>
<a name="l00259"></a>00259 
<a name="l00261"></a>00261   <a class="code" href="backup_2fh_8h.html#74fae3e6dfb05779e3168d9c9f1427e2">internal_fh</a> <a class="code" href="structinternal__dentry__def.html#be71fb8ee72d512ea258ebeeb178cb56">fh</a>;
<a name="l00262"></a>00262 
<a name="l00264"></a>00264   <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> <a class="code" href="structinternal__dentry__def.html#df620926f4a088c8b59153422f0d78c7">parent</a>;
<a name="l00265"></a>00265 
<a name="l00267"></a>00267   <span class="keywordtype">string</span> <a class="code" href="structinternal__dentry__def.html#13cb45a52b885382ae9614f6bedd5f74">name</a>;
<a name="l00268"></a>00268 
<a name="l00271"></a>00271   <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> <a class="code" href="structinternal__dentry__def.html#51a1898f2daf0842a10f45eccd17379b">next</a>, <a class="code" href="structinternal__dentry__def.html#f7b991d323516cb94ead8f8af77355cf">prev</a>;
<a name="l00272"></a>00272 
<a name="l00274"></a>00274   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structinternal__dentry__def.html#a6ae732a72afd5151e5e2bfe901251af">dentry_index</a>;
<a name="l00275"></a>00275 
<a name="l00277"></a>00277   time_t <a class="code" href="structinternal__dentry__def.html#2dceb73ade779f70338eee178f46f9ef">last_use</a>;
<a name="l00278"></a>00278 
<a name="l00280"></a>00280   <a class="code" href="structfibnode__def.html" title="Node of Fibonacci heap.">fibnode</a> <a class="code" href="structinternal__dentry__def.html#3ac875ab0580f5638f96dab595e27d8a">heap_node</a>;
<a name="l00281"></a>00281 
<a name="l00283"></a>00283   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structinternal__dentry__def.html#2a167116871c322cff85ff2f2c207d86">users</a>;
<a name="l00284"></a>00284 
<a name="l00286"></a>00286   <span class="keywordtype">bool</span> <a class="code" href="structinternal__dentry__def.html#f7b62e878ba599e3a7db2df46ecd3c48">deleted</a>;
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 <span class="preprocessor">#ifdef VERSIONS</span>
<a name="l00289"></a><a class="code" href="structinternal__dentry__def.html#a50a5fab580f053ec26ecdeec0b075c3">00289</a> <span class="preprocessor"></span>
<a name="l00290"></a>00290   <span class="keywordtype">bool</span> <a class="code" href="structinternal__dentry__def.html#a50a5fab580f053ec26ecdeec0b075c3">version_file</a>;
<a name="l00291"></a>00291 
<a name="l00293"></a>00293   <span class="keywordtype">bool</span> <a class="code" href="structinternal__dentry__def.html#7b9b9f2ae9632cd7ea1463a3235fd3ac">new_file</a>;
<a name="l00294"></a>00294 
<a name="l00295"></a><a class="code" href="structinternal__dentry__def.html#1ad88ac4b0a1bcfcbcceefe17a70263c">00295</a>   <span class="comment">/* Directory version timestamp.  */</span>
<a name="l00296"></a>00296   time_t <a class="code" href="structinternal__dentry__def.html#1ad88ac4b0a1bcfcbcceefe17a70263c">dirstamp</a>;
<a name="l00297"></a>00297 
<a name="l00298"></a><a class="code" href="structinternal__dentry__def.html#c536c3e3a856ae4b47528927a6a65422">00298</a>   <span class="comment">/* Hash table for readdir with timestamp.  */</span>
<a name="l00299"></a>00299   <a class="code" href="structhtab__def.html" title="Hash table datatype.">htab_t</a> <a class="code" href="structinternal__dentry__def.html#c536c3e3a856ae4b47528927a6a65422">dirhtab</a>;
<a name="l00300"></a>00300 
<a name="l00301"></a><a class="code" href="structinternal__dentry__def.html#1eb472286496f146a97efd2c5e22fb33">00301</a>   <span class="comment">/* New version files in this directory?  */</span>
<a name="l00302"></a>00302   <span class="keywordtype">bool</span> <a class="code" href="structinternal__dentry__def.html#1eb472286496f146a97efd2c5e22fb33">version_dirty</a>;
<a name="l00303"></a>00303 <span class="preprocessor">#endif</span>
<a name="l00304"></a>00304 <span class="preprocessor"></span>};
<a name="l00305"></a>00305 
<a name="l00307"></a>00307 <span class="keyword">struct </span><a class="code" href="structvirtual__dir__def.html" title="Virtual directory (element of mount tree).">virtual_dir_def</a>
<a name="l00308"></a>00308 {
<a name="l00309"></a>00309 <span class="preprocessor">#ifdef ENABLE_CHECKING</span>
<a name="l00310"></a>00310 <span class="preprocessor"></span>  <span class="keywordtype">long</span> unused0;
<a name="l00311"></a>00311   <span class="keywordtype">long</span> unused1;
<a name="l00312"></a>00312 <span class="preprocessor">#endif</span>
<a name="l00313"></a>00313 <span class="preprocessor"></span>
<a name="l00315"></a>00315   pthread_mutex_t <a class="code" href="structvirtual__dir__def.html#22e94e5db32822fd644f535881ed1740">mutex</a>;
<a name="l00316"></a>00316 
<a name="l00318"></a>00318   <a class="code" href="structzfs__fh__def.html">zfs_fh</a> <a class="code" href="structvirtual__dir__def.html#c68675b847764e77a1dfd1e6ec6fb47b">fh</a>;
<a name="l00319"></a>00319 
<a name="l00321"></a>00321   <a class="code" href="backup_2fh_8h.html#f5a7b3dc50ac942780765d4f924961aa">virtual_dir</a> <a class="code" href="structvirtual__dir__def.html#eaee0aa0f3c44a8bef1fc9bad71b3d6c">parent</a>;
<a name="l00322"></a>00322 
<a name="l00324"></a>00324   <span class="keywordtype">string</span> <a class="code" href="structvirtual__dir__def.html#f50b717584501602ce75b4e57f2b8d9e">name</a>;
<a name="l00325"></a>00325 
<a name="l00327"></a>00327   <a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> <a class="code" href="structvirtual__dir__def.html#a9515e5fd712792796f72bb613a95772">vol</a>;
<a name="l00328"></a>00328 
<a name="l00330"></a>00330   <a class="code" href="structinternal__cap__def.html" title="In-memory capability structure.">internal_cap</a> <a class="code" href="structvirtual__dir__def.html#43b86edc7be2059adcc9ac042991a678">cap</a>;
<a name="l00331"></a>00331 
<a name="l00333"></a>00333   <a class="code" href="structfattr__def.html">fattr</a> <a class="code" href="structvirtual__dir__def.html#78cc11821ffefdaec1adae2eeed21876">attr</a>;
<a name="l00334"></a>00334 
<a name="l00336"></a>00336   <a class="code" href="structvarray__def.html" title="Variable-sized array.">varray</a> <a class="code" href="structvirtual__dir__def.html#c35533107b278953e14c23a75d1151c5">subdirs</a>;
<a name="l00337"></a>00337 
<a name="l00339"></a>00339   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structvirtual__dir__def.html#8396779229f85a556ff53e14d62895fd">subdir_index</a>;
<a name="l00340"></a>00340 
<a name="l00342"></a>00342   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structvirtual__dir__def.html#b04b0b4932008ca85298379f9eec2403">n_mountpoints</a>;
<a name="l00343"></a>00343 
<a name="l00345"></a>00345   <span class="keywordtype">bool</span> <a class="code" href="structvirtual__dir__def.html#1eb08f1f02c91d57fe5cab6e415af2ad">busy</a>;
<a name="l00346"></a>00346 
<a name="l00348"></a>00348   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structvirtual__dir__def.html#244aba44af9c4943a8d6813f2c3c252e">users</a>;
<a name="l00349"></a>00349 
<a name="l00351"></a>00351   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structvirtual__dir__def.html#6baddb37d84f82675d3e23f1231e855c">deleted</a>;
<a name="l00352"></a>00352 };
<a name="l00353"></a>00353 
<a name="l00355"></a>00355 <span class="keyword">extern</span> <a class="code" href="structzfs__fh__def.html">zfs_fh</a> <a class="code" href="backup_2fh_8c.html#aeaeb70a4389345c638f589b8357cb45">root_fh</a>;
<a name="l00356"></a>00356 
<a name="l00358"></a>00358 <span class="keyword">extern</span> <a class="code" href="structzfs__fh__def.html">zfs_fh</a> <a class="code" href="backup_2fh_8c.html#09f04f0b6d113df8eba9e2e215fa2b04">undefined_fh</a>;
<a name="l00359"></a>00359 
<a name="l00361"></a>00361 <span class="keyword">extern</span> <a class="code" href="structhtab__def.html" title="Hash table datatype.">htab_t</a> <a class="code" href="backup_2fh_8c.html#50e9c7e5731f9c1ddd313dea77cff407">dentry_htab</a>;
<a name="l00362"></a>00362 
<a name="l00364"></a>00364 <span class="keyword">extern</span> <a class="code" href="structhtab__def.html" title="Hash table datatype.">htab_t</a> <a class="code" href="backup_2fh_8c.html#abf7a9cb87e4416067ef118ff1948e27">vd_htab</a>;
<a name="l00365"></a>00365 
<a name="l00367"></a>00367 <span class="keyword">extern</span> pthread_mutex_t <a class="code" href="backup_2fh_8c.html#6107d9eff35f5714a36635dcaa3198a2">fh_mutex</a>;
<a name="l00368"></a>00368 
<a name="l00370"></a>00370 <span class="keyword">extern</span> pthread_t <a class="code" href="backup_2fh_8c.html#f82c0c931b261e7dd78e0511fd95e7a7">cleanup_dentry_thread</a>;
<a name="l00371"></a>00371 
<a name="l00373"></a>00373 <span class="keyword">extern</span> pthread_mutex_t <a class="code" href="backup_2fh_8c.html#14d4f0f064daf73042171a677db1d0e1">cleanup_dentry_thread_in_syscall</a>;
<a name="l00374"></a>00374 
<a name="l00375"></a>00375 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#a48729af296248e632b8f240ac13be70">set_lock_info</a> (<a class="code" href="structlock__info__def.html" title="Information about locked dentries by current thread.">lock_info</a> *li);
<a name="l00376"></a>00376 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#7832f918945215af7cd2de05fc6604a2">set_owned</a> (<a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> dentry, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> level);
<a name="l00377"></a>00377 <span class="keyword">extern</span> int32_t <a class="code" href="backup_2fh_8c.html#56dd89ef05da03bb82b7ff2d02a3fae7">zfs_fh_lookup</a> (<a class="code" href="structzfs__fh__def.html">zfs_fh</a> *fh, <a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> *volp,
<a name="l00378"></a>00378                               <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> *dentryp, <a class="code" href="backup_2fh_8h.html#f5a7b3dc50ac942780765d4f924961aa">virtual_dir</a> *vdp,
<a name="l00379"></a>00379                               <span class="keywordtype">bool</span> delete_volume_p);
<a name="l00380"></a>00380 <span class="keyword">extern</span> int32_t <a class="code" href="backup_2fh_8c.html#4369b087b71e1339cff3184f4863590b">zfs_fh_lookup_nolock</a> (<a class="code" href="structzfs__fh__def.html">zfs_fh</a> *fh, <a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> *volp,
<a name="l00381"></a>00381                                      <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> *dentryp,
<a name="l00382"></a>00382                                      <a class="code" href="backup_2fh_8h.html#f5a7b3dc50ac942780765d4f924961aa">virtual_dir</a> *vdp, <span class="keywordtype">bool</span> delete_volume_p);
<a name="l00383"></a>00383 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#d4f866d0e859ea5b309a0316c9ba82e6">acquire_dentry</a> (<a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> dentry);
<a name="l00384"></a>00384 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#dba0f21d712309394992dba07fac7f02">release_dentry</a> (<a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> dentry);
<a name="l00385"></a>00385 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> <a class="code" href="backup_2fh_8c.html#090008bde0f42c0a0d0c7a3aad5f01ff">get_dentry</a> (<a class="code" href="structzfs__fh__def.html">zfs_fh</a> *local_fh, <a class="code" href="structzfs__fh__def.html">zfs_fh</a> *master_fh,
<a name="l00386"></a>00386                                    <a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> vol, <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> dir,
<a name="l00387"></a>00387                                    <span class="keywordtype">string</span> *name, <a class="code" href="structfattr__def.html">fattr</a> *attr, <a class="code" href="structmetadata__def.html" title="Metadata for file.">metadata</a> *meta);
<a name="l00388"></a>00388 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#98b93d3a61d62abf54b63d0ad69cee63">delete_dentry</a> (<a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> *volp, <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> *dirp, <span class="keywordtype">string</span> *name,
<a name="l00389"></a>00389                            <a class="code" href="structzfs__fh__def.html">zfs_fh</a> *dir_fh);
<a name="l00390"></a>00390 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#f5a7b3dc50ac942780765d4f924961aa">virtual_dir</a> <a class="code" href="backup_2fh_8c.html#eaa5c46027cebc0eff43f4c7d3bfcc86">vd_lookup</a> (<a class="code" href="structzfs__fh__def.html">zfs_fh</a> *fh);
<a name="l00391"></a>00391 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#f5a7b3dc50ac942780765d4f924961aa">virtual_dir</a> <a class="code" href="backup_2fh_8c.html#f995be6e56b3a839133217f0cc3ef181">vd_lookup_name_dirstamp</a> (<a class="code" href="backup_2fh_8h.html#f5a7b3dc50ac942780765d4f924961aa">virtual_dir</a> parent, <span class="keywordtype">string</span> *name, time_t *dirstamp);
<a name="l00392"></a>00392 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#f5a7b3dc50ac942780765d4f924961aa">virtual_dir</a> <a class="code" href="backup_2fh_8c.html#c14e8d0673bcce8f066e26f32a6059ce">vd_lookup_name</a> (<a class="code" href="backup_2fh_8h.html#f5a7b3dc50ac942780765d4f924961aa">virtual_dir</a> parent, <span class="keywordtype">string</span> *name);
<a name="l00393"></a>00393 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> <a class="code" href="backup_2fh_8c.html#8cb3cbb2d678f4c5dd957860bef32010">dentry_lookup</a> (<a class="code" href="structzfs__fh__def.html">zfs_fh</a> *fh);
<a name="l00394"></a>00394 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> <a class="code" href="backup_2fh_8c.html#2314960b1bbbccdc9f5de556cba01ee5">dentry_lookup_name</a> (<a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> vol, <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> parent,
<a name="l00395"></a>00395                                            <span class="keywordtype">string</span> *name);
<a name="l00396"></a>00396 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> <a class="code" href="backup_2fh_8c.html#f01bb3357770c86fde4bbc8b2046a557">dentry_lookup_path</a> (<a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> vol, <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> start,
<a name="l00397"></a>00397                                            <span class="keywordtype">string</span> *path);
<a name="l00398"></a>00398 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> <a class="code" href="backup_2fh_8c.html#7deec7e5a0d5cfec15604654622c5261">dentry_lookup_local_path</a> (<a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> vol,
<a name="l00399"></a>00399                                                  <span class="keywordtype">string</span> *local_path);
<a name="l00400"></a>00400 <span class="keyword">extern</span> int32_t <a class="code" href="backup_2fh_8c.html#50a8ee91cf7279f7980d3274be239c38">internal_dentry_lock</a> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> level, <a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> *volp,
<a name="l00401"></a>00401                                      <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> *dentryp, <a class="code" href="structzfs__fh__def.html">zfs_fh</a> *tmp_fh);
<a name="l00402"></a>00402 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#25399c7c011c8db17106e51083bfe291">internal_dentry_unlock</a> (<a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> vol, <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> dentry);
<a name="l00403"></a>00403 <span class="keyword">extern</span> int32_t <a class="code" href="backup_2fh_8c.html#da95c07b441d3eb404b765d35b06d266">internal_dentry_lock2</a> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> level1, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> level2,
<a name="l00404"></a>00404                                       <a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> *volp, <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> *dentry1p,
<a name="l00405"></a>00405                                       <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> *dentry2p,
<a name="l00406"></a>00406                                       <a class="code" href="structzfs__fh__def.html">zfs_fh</a> *tmp_fh1, <a class="code" href="structzfs__fh__def.html">zfs_fh</a> *tmp_fh2);
<a name="l00407"></a>00407 <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="backup_2fh_8c.html#004bcac5a4521260bca2e2af84972285">set_master_fh</a> (<a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> vol, <a class="code" href="backup_2fh_8h.html#74fae3e6dfb05779e3168d9c9f1427e2">internal_fh</a> fh, <a class="code" href="structzfs__fh__def.html">zfs_fh</a> *master_fh);
<a name="l00408"></a>00408 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#d66e60c73dc9dad2c65d272496d9cd30">print_fh_htab</a> (FILE *f);
<a name="l00409"></a>00409 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#36831320b72fcaf2ca2b169fbe126bf4">debug_fh_htab</a> (<span class="keywordtype">void</span>);
<a name="l00410"></a>00410 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#25d627140eb6e87241af8459e1ec8ac8">print_subdentries</a> (FILE *f, <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> dentry);
<a name="l00411"></a>00411 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#0b5dd761ac09bd1c3e46ebab554c23d3">debug_subdentries</a> (<a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> dentry);
<a name="l00412"></a>00412 
<a name="l00413"></a>00413 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> <a class="code" href="backup_2fh_8c.html#1e87a910684e1ba16db95f10db510d93">internal_dentry_create_ns</a> (<a class="code" href="structzfs__fh__def.html">zfs_fh</a> *local_fh, <a class="code" href="structzfs__fh__def.html">zfs_fh</a> *master_fh, <a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> vol,
<a name="l00414"></a>00414                                                <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> parent, <span class="keywordtype">string</span> *name, <a class="code" href="structfattr__def.html">fattr</a> *attr,
<a name="l00415"></a>00415                                                <a class="code" href="structmetadata__def.html" title="Metadata for file.">metadata</a> *meta, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> level);
<a name="l00416"></a>00416 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> <a class="code" href="backup_2fh_8c.html#7bfcf103cc9a1ffe0478066b25cf0535">internal_dentry_link</a> (<a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> orig,
<a name="l00417"></a>00417                                              <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> parent,
<a name="l00418"></a>00418                                              <span class="keywordtype">string</span> *name);
<a name="l00419"></a>00419 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#53d039d599e7fe36af4474e9186ddeea">internal_dentry_move</a> (<a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> *from_dirp, <span class="keywordtype">string</span> *from_name,
<a name="l00420"></a>00420                                   <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> *to_dirp, <span class="keywordtype">string</span> *to_name,
<a name="l00421"></a>00421                                   <a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> *volp, <a class="code" href="structzfs__fh__def.html">zfs_fh</a> *from_fh, <a class="code" href="structzfs__fh__def.html">zfs_fh</a> *to_fh);
<a name="l00422"></a>00422 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#7a37ecd8655e55cacfdefafc3c346559">internal_dentry_destroy</a> (<a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> dentry,
<a name="l00423"></a>00423                                      <span class="keywordtype">bool</span> clear_volume_root, <span class="keywordtype">bool</span> invalidate,
<a name="l00424"></a>00424                                      <span class="keywordtype">bool</span> volume_root_p);
<a name="l00425"></a>00425 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> <a class="code" href="backup_2fh_8c.html#175d40b2a7407b9f9937c30a4a5640f9">create_conflict</a> (<a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> vol, <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> dir,
<a name="l00426"></a>00426                                         <span class="keywordtype">string</span> *name, <a class="code" href="structzfs__fh__def.html">zfs_fh</a> *local_fh,
<a name="l00427"></a>00427                                         <a class="code" href="structfattr__def.html">fattr</a> *attr);
<a name="l00428"></a>00428 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> <a class="code" href="backup_2fh_8c.html#12fcabe197197159092dfb7e5a943e15">add_file_to_conflict_dir</a> (<a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> vol,
<a name="l00429"></a>00429                                                  <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> conflict,
<a name="l00430"></a>00430                                                  <span class="keywordtype">bool</span> exists, <a class="code" href="structzfs__fh__def.html">zfs_fh</a> *fh,
<a name="l00431"></a>00431                                                  <a class="code" href="structfattr__def.html">fattr</a> *attr, <a class="code" href="structmetadata__def.html" title="Metadata for file.">metadata</a> *meta);
<a name="l00432"></a>00432 <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="backup_2fh_8c.html#85cabd83c7f7d5629cfe8ea0c7da612b">try_resolve_conflict</a> (<a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> vol, <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> conflict);
<a name="l00433"></a>00433 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> <a class="code" href="backup_2fh_8c.html#b5baf7233d31eac450ce2da650d38a85">conflict_local_dentry</a> (<a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> conflict);
<a name="l00434"></a>00434 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> <a class="code" href="backup_2fh_8c.html#b679b32ae12335a0a19fab427730a97e">conflict_remote_dentry</a> (<a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> conflict);
<a name="l00435"></a>00435 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> <a class="code" href="backup_2fh_8c.html#55f852506029a7b69002e96b359881b8">conflict_other_dentry</a> (<a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> conflict,
<a name="l00436"></a>00436                                               <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> dentry);
<a name="l00437"></a>00437 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#fc78ab179298144b9f2f500110659c7d">cancel_conflict</a> (<a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> vol, <a class="code" href="backup_2fh_8h.html#4326b09466330e1f334da8c5c2627a85">internal_dentry</a> conflict);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#f5a7b3dc50ac942780765d4f924961aa">virtual_dir</a> <a class="code" href="backup_2fh_8c.html#7a251cf9ea14d69dcc4987c1fc0ccee8">virtual_dir_create</a> (<a class="code" href="backup_2fh_8h.html#f5a7b3dc50ac942780765d4f924961aa">virtual_dir</a> parent, <span class="keyword">const</span> <span class="keywordtype">char</span> *name);
<a name="l00440"></a>00440 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#16f9091ef5a42f2dc51d052efd3204e9">virtual_dir_destroy</a> (<a class="code" href="backup_2fh_8h.html#f5a7b3dc50ac942780765d4f924961aa">virtual_dir</a> vd);
<a name="l00441"></a>00441 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#f5a7b3dc50ac942780765d4f924961aa">virtual_dir</a> <a class="code" href="backup_2fh_8c.html#1c2d9fd002758c3a3a569819f1deb9b7">virtual_root_create</a> (<span class="keywordtype">void</span>);
<a name="l00442"></a>00442 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#29061344fcbe91649692f59872c1d9e6">virtual_root_destroy</a> (<a class="code" href="backup_2fh_8h.html#f5a7b3dc50ac942780765d4f924961aa">virtual_dir</a> <a class="code" href="backup_2fh_8c.html#e4cac4bc0c5fa65508b79428d7395b36">root</a>);
<a name="l00443"></a>00443 <span class="keyword">extern</span> <a class="code" href="backup_2fh_8h.html#f5a7b3dc50ac942780765d4f924961aa">virtual_dir</a> <a class="code" href="backup_2fh_8c.html#2d82dccda4a8638279877471dea475fe">virtual_mountpoint_create</a> (<a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> vol);
<a name="l00444"></a>00444 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#b000229493a3fc66db907254aa7d8c09">virtual_mountpoint_destroy</a> (<a class="code" href="backup_2fh_8h.html#23b8f8d0235e1d23f4244a5bd6742523">volume</a> vol);
<a name="l00445"></a>00445 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#e73623d02e39544a31a39aa06761acd7">virtual_dir_set_fattr</a> (<a class="code" href="backup_2fh_8h.html#f5a7b3dc50ac942780765d4f924961aa">virtual_dir</a> vd);
<a name="l00446"></a>00446 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#709d39f9778814c3335adc4939343cee">print_virtual_tree</a> (FILE *f);
<a name="l00447"></a>00447 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#482816e87ac2a79cd4219eb86dd439e6">debug_virtual_tree</a> (<span class="keywordtype">void</span>);
<a name="l00448"></a>00448 
<a name="l00449"></a>00449 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#6c9c424d261a183cdf4bbe0e724b564a">initialize_fh_c</a> (<span class="keywordtype">void</span>);
<a name="l00450"></a>00450 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="backup_2fh_8c.html#debe6f14d598f841f48955be99ebac0a">cleanup_fh_c</a> (<span class="keywordtype">void</span>);
<a name="l00451"></a>00451 
<a name="l00452"></a>00452 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Fri Aug 6 00:37:39 2010 for zlomekFS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
